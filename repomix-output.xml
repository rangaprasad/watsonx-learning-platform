This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
app/
  api/
    analyze-video/
      route.ts
    execute/
      route.ts
    extract-transcript/
      route.ts
    practice-points/
      [videoId]/
        route.ts
  labs/
    [labId]/
      page.tsx
    watsonx-first-call/
      page.tsx
    page.tsx
  pricing/
    page.tsx
  globals.css
  layout.tsx
  page.tsx
code-executor/
  deploy-app.sh
  deploy-e2e.sh
  deploy.sh
  Dockerfile
  execute.py
  README.md
  requirements.txt
  server.py
  test-input.json
  test-local.sh
components/
  LabRunner-backup.tsx
  LabRunner.tsx
  Navigation.tsx
lib/
  static-practice-points.ts
mnt/
  user-data/
    outputs/
      deploy-video-sync.sh
      VIDEO_SYNC_DEPLOYMENT_GUIDE.md
public/
  .gitkeep
.env.example
.gitignore
api-analyze-video-route.ts
api-extract-transcript-route.ts
api-practice-points-route.ts
content-youtube-sync.js
deploy-final.sh
deploy-learning-platform.sh
deploy-production.sh
deploy-video-sync.sh
deploy.sh
DEPLOYMENT_GUIDE.md
DEPLOYMENT_REFERENCE.md
diagnose-registry.sh
Dockerfile.prod
fix-deployment.sh
LabRunner-sync.tsx
labs-labId-page-sync.tsx
next-env.d.ts
next.config.js
overlay-sync.css
package.json
postcss.config.js
PROJECT_SUMMARY.md
quick-fix.sh
README.md
tailwind.config.js
tsconfig.json
VIDEO_SYNC_DEPLOYMENT_GUIDE.md
VIDEO_SYNC_SUMMARY.md
WEEK1_CODE_EXECUTION_PLAN.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/api/analyze-video/route.ts">
import { NextResponse } from 'next/server';
import { YoutubeTranscript } from 'youtube-transcript';

// Helper to get IBM IAM Token
async function getIamToken(apiKey: string) {
  const response = await fetch('https://iam.cloud.ibm.com/identity/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: `grant_type=urn:ibm:params:oauth:grant-type:apikey&apikey=${apiKey}`,
  });
  const data = await response.json();
  return data.access_token;
}

export async function POST(req: Request) {
  try {
    const { videoId } = await req.json();

    // 1. Fetch Transcript from YouTube
    const transcriptArray = await YoutubeTranscript.fetchTranscript(videoId);
    const textSnippet = transcriptArray.map(t => t.text).join(' ').substring(0, 4500);

    // 2. Auth with IBM watsonx.ai
    const iamToken = await getIamToken(process.env.WATSONX_APIKEY!);

    // 3. Request Lab Generation from IBM Granite
    const payload = {
      input: `[INST] <<SYS>>
You are a Computer Science Tutor. Analyze the transcript and identify 3 practice points. 
Return ONLY valid JSON in this format:
{ "practicePoints": [{ "timestamp": 300, "topic": "Variables", "description": "Short summary", "suggestedLab": { "title": "Lab 1", "starterCode": "x = 5\\nprint(x)" } }] }
<</SYS>>
Transcript: ${textSnippet} [/INST]`,
      parameters: { decoding_method: "greedy", max_new_tokens: 1000 },
      project_id: process.env.WATSONX_PROJECT_ID
    };

    const aiResponse = await fetch(`${process.env.WATSONX_URL}/ml/v1/text/generation?version=2023-05-29`, {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${iamToken}`, 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    const result = await aiResponse.json();
    const generatedText = result.results[0].generated_text;
    
    // Parse JSON from AI response
    const cleanJson = JSON.parse(generatedText.substring(generatedText.indexOf('{'), generatedText.lastIndexOf('}') + 1));
    return NextResponse.json(cleanJson);

  } catch (error) {
    console.error("üß† Brain Error:", error);
    return NextResponse.json({ error: "watsonx analysis failed" }, { status: 500 });
  }
}
</file>

<file path="app/api/extract-transcript/route.ts">
import { NextResponse } from 'next/server';

/**
 * Extract YouTube Transcript API
 * 
 * This endpoint extracts transcripts from YouTube videos using the 
 * youtube-transcript package.
 * 
 * POST /api/extract-transcript
 * Body: { videoId: string }
 * 
 * Returns: { videoId, title, duration, transcript: [{text, start, duration}] }
 */

// We'll use the youtube-transcript package
// Install: npm install youtube-transcript

interface TranscriptSegment {
  text: string;
  start: number;
  duration: number;
}

interface TranscriptResponse {
  videoId: string;
  title: string;
  duration: number;
  transcript: TranscriptSegment[];
  language: string;
}

export async function POST(request: Request) {
  try {
    const { videoId } = await request.json();

    if (!videoId) {
      return NextResponse.json(
        { error: 'videoId is required' },
        { status: 400 }
      );
    }

    // Import the youtube-transcript package dynamically
    const { YoutubeTranscript } = await import('youtube-transcript');

    // Fetch transcript
    const transcript = await YoutubeTranscript.fetchTranscript(videoId);

    // Get video metadata (we'll use a simple fetch to YouTube)
    const videoInfo = await getVideoMetadata(videoId);

    const response: TranscriptResponse = {
      videoId,
      title: videoInfo.title,
      duration: videoInfo.duration,
      transcript: transcript.map((segment: any) => ({
        text: segment.text,
        start: segment.offset / 1000, // Convert to seconds
        duration: segment.duration / 1000
      })),
      language: 'en'
    };

    return NextResponse.json(response);

  } catch (error) {
    console.error('Transcript extraction error:', error);
    
    return NextResponse.json(
      { 
        error: 'Failed to extract transcript',
        details: error instanceof Error ? error.message : 'Unknown error'
      },
      { status: 500 }
    );
  }
}

/**
 * Get video metadata from YouTube
 * Uses oEmbed API (no API key required!)
 */
async function getVideoMetadata(videoId: string) {
  try {
    const oembedUrl = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`;
    const response = await fetch(oembedUrl);
    const data = await response.json();

    return {
      title: data.title,
      author: data.author_name,
      duration: 0 // oEmbed doesn't provide duration, we'll estimate from transcript
    };
  } catch (error) {
    return {
      title: 'Unknown',
      author: 'Unknown',
      duration: 0
    };
  }
}
</file>

<file path="app/api/practice-points/[videoId]/route.ts">
import { NextResponse } from 'next/server';
import { STATIC_PRACTICE_POINTS, getStaticPracticePoints } from '@/lib/static-practice-points';

/**
 * Get Practice Points for Video
 * 
 * This endpoint tries to extract and analyze transcripts,
 * but falls back to static practice points if that fails.
 * 
 * GET /api/practice-points/[videoId]
 */

interface PracticePoint {
  timestamp: number;
  endTimestamp: number;
  topic: string;
  description: string;
  suggestedLab: {
    title: string;
    starterCode: string;
    difficulty: 'beginner' | 'intermediate' | 'advanced';
    estimatedTime: number;
  };
}

interface PracticePointsResponse {
  videoId: string;
  title: string;
  duration: number;
  practicePoints: PracticePoint[];
  cached: boolean;
  source?: 'static' | 'ai' | 'cached';
}

// In-memory cache
const cache = new Map<string, PracticePointsResponse>();

export async function GET(
  request: Request,
  { params }: { params: { videoId: string } }
) {
  try {
    const { videoId } = params;

    // Check cache first
    if (cache.has(videoId)) {
      const cachedData = cache.get(videoId)!;
      return NextResponse.json({ ...cachedData, cached: true });
    }

    // Try static practice points first (instant, reliable)
    const staticPoints = getStaticPracticePoints(videoId);
    if (staticPoints) {
      const response = { ...staticPoints, cached: false, source: 'static' as const };
      cache.set(videoId, response);
      return NextResponse.json(response);
    }

    // Try transcript extraction + AI analysis
    try {
      const transcriptResponse = await fetch(
        `${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000'}/api/extract-transcript`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ videoId })
        }
      );

      if (transcriptResponse.ok) {
        const transcriptData = await transcriptResponse.json();

        // Only proceed if we got a transcript
        if (transcriptData.transcript && transcriptData.transcript.length > 0) {
          const analysisResponse = await fetch(
            `${process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000'}/api/analyze-video`,
            {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                videoId,
                transcript: transcriptData.transcript,
                title: transcriptData.title
              })
            }
          );

          if (analysisResponse.ok) {
            const analysisData = await analysisResponse.json();

            const response: PracticePointsResponse = {
              videoId,
              title: transcriptData.title,
              duration: transcriptData.duration,
              practicePoints: analysisData.practicePoints,
              cached: false,
              source: 'ai'
            };

            cache.set(videoId, response);
            return NextResponse.json(response);
          }
        }
      }
    } catch (error) {
      console.error('AI analysis failed:', error);
    }

    // Fallback: Return generic practice point
    const fallbackResponse: PracticePointsResponse = {
      videoId,
      title: 'Tutorial Video',
      duration: 600,
      practicePoints: [
        {
          timestamp: 180,
          endTimestamp: 300,
          topic: 'Getting Started',
          description: 'Practice what you learned in this tutorial.',
          suggestedLab: {
            title: 'Your First AI API Call',
            starterCode: `import os\n\n# TODO: Write your code here\n\nprint("Ready to practice!")`,
            difficulty: 'beginner',
            estimatedTime: 15
          }
        }
      ],
      cached: false,
      source: 'static'
    };

    return NextResponse.json(fallbackResponse);

  } catch (error) {
    console.error('Practice points error:', error);
    
    // Even on error, return valid structure
    return NextResponse.json(
      { 
        videoId: params.videoId,
        title: 'Unknown',
        duration: 0,
        practicePoints: [],
        cached: false,
        error: error instanceof Error ? error.message : 'Unknown error'
      },
      { status: 200 }
    );
  }
}
</file>

<file path="code-executor/deploy-e2e.sh">
#!/bin/bash
# 1. Set your credentials (Run these in your terminal first!)
# export WATSONX_APIKEY="your_key"
# export WATSONX_PROJECT_ID="your_project"

# 2. Build and Push
NAMESPACE="ranga" # Change to your namespace
IMAGE="icr.io/$NAMESPACE/code-executor:latest"

docker build --platform linux/amd64 -t code-executor .
docker tag code-executor $IMAGE
docker push $IMAGE

# 3. Create Secrets (The Fix for NoCredentialsError)
ibmcloud ce secret create --name ibm-creds \
  --from-literal "WATSONX_APIKEY=$WATSONX_APIKEY" \
  --from-literal "WATSONX_PROJECT_ID=$WATSONX_PROJECT_ID" \
  --from-literal "WATSONX_URL=https://us-south.ml.cloud.ibm.com" 2>/dev/null || \
ibmcloud ce secret update --name ibm-creds \
  --from-literal "WATSONX_APIKEY=$WATSONX_APIKEY"

# 4. Deploy as App
ibmcloud ce app create --name executor-app --image $IMAGE \
  --env-from-secret ibm-creds --port 8080 --min-scale 1
</file>

<file path="lib/static-practice-points.ts">
/**
 * Static Practice Points Fallback
 * 
 * Use these when YouTube transcript extraction fails.
 * Pre-analyzed practice points for popular videos.
 */

export const STATIC_PRACTICE_POINTS: Record<string, any> = {
  // New video: https://www.youtube.com/watch?v=eWRfhZUzrAc
  'eWRfhZUzrAc': {
    videoId: 'eWRfhZUzrAc',
    title: 'AI/ML Tutorial',
    duration: 1200,
    practicePoints: [
      {
        timestamp: 120,
        endTimestamp: 240,
        topic: 'Getting Started with AI APIs',
        description: 'Learn how to set up and make your first AI API call.',
        suggestedLab: {
          title: 'Your First AI API Call',
          starterCode: `import os\n\n# TODO: Initialize your AI client\n\n# TODO: Make your first API call\n\nprint("API call successful!")`,
          difficulty: 'beginner' as const,
          estimatedTime: 15
        }
      },
      {
        timestamp: 300,
        endTimestamp: 420,
        topic: 'Working with Prompts',
        description: 'Understand how to craft effective prompts and handle responses.',
        suggestedLab: {
          title: 'Build Your First Chatbot',
          starterCode: `# TODO: Create a prompt\nprompt = "___"\n\n# TODO: Send to AI model\n\n# TODO: Display response`,
          difficulty: 'intermediate' as const,
          estimatedTime: 20
        }
      },
      {
        timestamp: 600,
        endTimestamp: 720,
        topic: 'Advanced AI Patterns',
        description: 'Explore advanced techniques like context management and error handling.',
        suggestedLab: {
          title: 'Advanced AI Patterns',
          starterCode: `# TODO: Implement context management\n# TODO: Add error handling\n# TODO: Optimize for production`,
          difficulty: 'advanced' as const,
          estimatedTime: 25
        }
      }
    ]
  },

  // AWS Bedrock Tutorial
  'iOdFUJiB0Zc': {
    videoId: 'iOdFUJiB0Zc',
    title: 'Getting Started with AWS Bedrock',
    duration: 945,
    practicePoints: [
      {
        timestamp: 180,
        endTimestamp: 300,
        topic: 'Setting up AWS Bedrock Client',
        description: 'Learn how to initialize the boto3 client and set up credentials for AWS Bedrock.',
        suggestedLab: {
          title: 'Your First Bedrock API Call',
          starterCode: `import boto3\n\n# TODO: Initialize bedrock client\nbedrock = None\n\nprint("Client initialized!")`,
          difficulty: 'beginner' as const,
          estimatedTime: 15
        }
      },
      {
        timestamp: 360,
        endTimestamp: 480,
        topic: 'Making Your First API Call',
        description: 'Demonstrate how to call the invoke_model API with a simple prompt and handle the response.',
        suggestedLab: {
          title: 'Build a Simple Chatbot',
          starterCode: `import boto3\nimport json\n\nbedrock = boto3.client('bedrock-runtime')\n\n# TODO: Create request and call API`,
          difficulty: 'intermediate' as const,
          estimatedTime: 20
        }
      },
      {
        timestamp: 600,
        endTimestamp: 720,
        topic: 'Advanced Response Handling',
        description: 'Parse and process the JSON response from Bedrock, including error handling.',
        suggestedLab: {
          title: 'Advanced RAG Patterns',
          starterCode: `# TODO: Implement response parsing\n# TODO: Add error handling`,
          difficulty: 'advanced' as const,
          estimatedTime: 25
        }
      }
    ]
  },

  // watsonx.ai Tutorial  
  'xyz123example': {
    videoId: 'xyz123example',
    title: 'IBM watsonx.ai Getting Started',
    duration: 720,
    practicePoints: [
      {
        timestamp: 120,
        endTimestamp: 240,
        topic: 'Initializing watsonx.ai Model',
        description: 'Set up credentials and initialize your first foundation model.',
        suggestedLab: {
          title: 'Your First watsonx.ai Call',
          starterCode: `import os\nfrom ibm_watsonx_ai.foundation_models import Model\n\n# TODO: Initialize model`,
          difficulty: 'beginner' as const,
          estimatedTime: 15
        }
      }
    ]
  }
};

/**
 * Get static practice points for a video
 */
export function getStaticPracticePoints(videoId: string) {
  return STATIC_PRACTICE_POINTS[videoId] || null;
}
</file>

<file path="mnt/user-data/outputs/deploy-video-sync.sh">
#!/bin/bash

##############################################################################
# GenAI Labs - Video-Lab Sync Feature Deployment Script
# 
# This script automates the deployment of the video-lab synchronization feature
# 
# Usage:
#   chmod +x deploy-video-sync.sh
#   ./deploy-video-sync.sh
##############################################################################

set -e  # Exit on error

echo "üöÄ GenAI Labs - Video-Lab Sync Deployment"
echo "=========================================="
echo ""

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo -e "${RED}‚ùå Error: package.json not found. Are you in the watsonx-learning-platform directory?${NC}"
    exit 1
fi

echo -e "${BLUE}üìã Step 1: Checking dependencies...${NC}"

# Check if required files exist in Downloads
FILES_TO_COPY=(
    "api-extract-transcript-route.ts"
    "api-analyze-video-route.ts"
    "api-practice-points-route.ts"
    "content-youtube-sync.js"
    "overlay-sync.css"
    "labs-labId-page-sync.tsx"
    "LabRunner-sync.tsx"
)

MISSING_FILES=()
for file in "${FILES_TO_COPY[@]}"; do
    if [ ! -f "$HOME/Downloads/$file" ]; then
        MISSING_FILES+=("$file")
    fi
done

if [ ${#MISSING_FILES[@]} -gt 0 ]; then
    echo -e "${RED}‚ùå Missing files in ~/Downloads:${NC}"
    for file in "${MISSING_FILES[@]}"; do
        echo "   - $file"
    done
    echo ""
    echo "Please download all required files first!"
    exit 1
fi

echo -e "${GREEN}‚úÖ All required files found!${NC}"
echo ""

# Confirm with user
echo -e "${YELLOW}‚ö†Ô∏è  This will modify your existing files. Continue? (y/n)${NC}"
read -r response
if [[ ! "$response" =~ ^[Yy]$ ]]; then
    echo "Deployment cancelled."
    exit 0
fi

echo ""
echo -e "${BLUE}üì¶ Step 2: Creating backups...${NC}"

# Create backup directory
BACKUP_DIR="backups/video-sync-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"

# Backup existing files
if [ -f "app/labs/[labId]/page.tsx" ]; then
    cp "app/labs/[labId]/page.tsx" "$BACKUP_DIR/page.tsx.backup"
    echo "   ‚úì Backed up app/labs/[labId]/page.tsx"
fi

if [ -f "components/LabRunner.tsx" ]; then
    cp "components/LabRunner.tsx" "$BACKUP_DIR/LabRunner.tsx.backup"
    echo "   ‚úì Backed up components/LabRunner.tsx"
fi

echo -e "${GREEN}‚úÖ Backups created in $BACKUP_DIR${NC}"
echo ""

echo -e "${BLUE}üìÇ Step 3: Creating API directories...${NC}"

mkdir -p app/api/extract-transcript
mkdir -p app/api/analyze-video
mkdir -p "app/api/practice-points/[videoId]"

echo "   ‚úì Created app/api/extract-transcript"
echo "   ‚úì Created app/api/analyze-video"
echo "   ‚úì Created app/api/practice-points/[videoId]"
echo ""

echo -e "${BLUE}üì• Step 4: Copying API route files...${NC}"

cp "$HOME/Downloads/api-extract-transcript-route.ts" "app/api/extract-transcript/route.ts"
echo "   ‚úì app/api/extract-transcript/route.ts"

cp "$HOME/Downloads/api-analyze-video-route.ts" "app/api/analyze-video/route.ts"
echo "   ‚úì app/api/analyze-video/route.ts"

cp "$HOME/Downloads/api-practice-points-route.ts" "app/api/practice-points/[videoId]/route.ts"
echo "   ‚úì app/api/practice-points/[videoId]/route.ts"

echo -e "${GREEN}‚úÖ API routes installed!${NC}"
echo ""

echo -e "${BLUE}üì• Step 5: Updating platform components...${NC}"

cp "$HOME/Downloads/labs-labId-page-sync.tsx" "app/labs/[labId]/page.tsx"
echo "   ‚úì app/labs/[labId]/page.tsx"

cp "$HOME/Downloads/LabRunner-sync.tsx" "components/LabRunner.tsx"
echo "   ‚úì components/LabRunner.tsx"

echo -e "${GREEN}‚úÖ Platform components updated!${NC}"
echo ""

echo -e "${BLUE}üì• Step 6: Updating Chrome extension...${NC}"

# Check if extension directory exists
EXTENSION_DIR="../genai-labs-extension"
if [ -d "$EXTENSION_DIR" ]; then
    cd "$EXTENSION_DIR"
    
    # Backup
    cp "content-youtube.js" "content-youtube.backup.js" 2>/dev/null || true
    cp "overlay.css" "overlay.backup.css" 2>/dev/null || true
    
    # Copy new files
    cp "$HOME/Downloads/content-youtube-sync.js" "content-youtube.js"
    echo "   ‚úì content-youtube.js"
    
    cp "$HOME/Downloads/overlay-sync.css" "overlay.css"
    echo "   ‚úì overlay.css"
    
    cd - > /dev/null
    echo -e "${GREEN}‚úÖ Extension updated!${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  Extension directory not found at $EXTENSION_DIR${NC}"
    echo "   You'll need to update it manually."
fi
echo ""

echo -e "${BLUE}üì¶ Step 7: Installing npm dependencies...${NC}"

# Check if dependencies are already installed
if ! grep -q "youtube-transcript" package.json; then
    echo "   Installing youtube-transcript..."
    npm install youtube-transcript --save
fi

if ! grep -q "@anthropic-ai/sdk" package.json; then
    echo "   Installing @anthropic-ai/sdk..."
    npm install @anthropic-ai/sdk --save
fi

echo -e "${GREEN}‚úÖ Dependencies installed!${NC}"
echo ""

echo -e "${BLUE}üîê Step 8: Checking environment variables...${NC}"

ENV_FILE=".env.local"
MISSING_VARS=()

if [ ! -f "$ENV_FILE" ]; then
    echo "   Creating .env.local..."
    touch "$ENV_FILE"
fi

if ! grep -q "ANTHROPIC_API_KEY" "$ENV_FILE"; then
    MISSING_VARS+=("ANTHROPIC_API_KEY")
fi

if ! grep -q "NEXT_PUBLIC_API_URL" "$ENV_FILE"; then
    MISSING_VARS+=("NEXT_PUBLIC_API_URL")
fi

if [ ${#MISSING_VARS[@]} -gt 0 ]; then
    echo -e "${YELLOW}‚ö†Ô∏è  Missing environment variables:${NC}"
    for var in "${MISSING_VARS[@]}"; do
        echo "   - $var"
    done
    echo ""
    echo "Please add these to .env.local:"
    echo ""
    echo "ANTHROPIC_API_KEY=your-anthropic-api-key"
    echo "NEXT_PUBLIC_API_URL=https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud"
    echo ""
else
    echo -e "${GREEN}‚úÖ Environment variables configured!${NC}"
fi
echo ""

echo -e "${BLUE}üß™ Step 9: Testing locally...${NC}"
echo ""
echo "Starting development server..."
echo "Visit http://localhost:3000 to test"
echo ""
echo -e "${YELLOW}Press Ctrl+C when ready to deploy to production${NC}"
echo ""

# Start dev server
npm run dev &
DEV_PID=$!

# Wait for user to press Ctrl+C
trap "kill $DEV_PID 2>/dev/null; exit 0" SIGINT

wait $DEV_PID

echo ""
echo -e "${GREEN}‚úÖ Deployment script complete!${NC}"
echo ""
echo "Next steps:"
echo "1. Test locally at http://localhost:3000"
echo "2. Deploy to production:"
echo ""
echo "   docker build --platform linux/amd64 -f Dockerfile.prod -t genai-learning-platform:latest ."
echo "   docker tag genai-learning-platform:latest icr.io/ranga/genai-learning-platform:latest"
echo "   docker push icr.io/ranga/genai-learning-platform:latest"
echo "   ibmcloud ce app update --name genai-learning-platform --image icr.io/ranga/genai-learning-platform:latest"
echo ""
echo "3. Update Chrome extension:"
echo "   - Go to chrome://extensions"
echo "   - Click 'Reload' on GenAI Labs"
echo ""
echo -e "${BLUE}üéâ Happy coding!${NC}"
</file>

<file path="mnt/user-data/outputs/VIDEO_SYNC_DEPLOYMENT_GUIDE.md">
# Video-Lab Sync Feature - Deployment Guide

## üéØ What We're Adding

This guide will help you deploy the **video-lab synchronization feature** - the killer feature that makes GenAI Labs truly magical!

**What it does:**
- Extracts YouTube transcripts with timestamps
- Uses AI to identify practice moments
- Shows notifications at perfect times
- Opens labs with context from the video
- Tracks section progress
- Allows resuming video after practice

---

## üì¶ Files to Add

### 1. Backend API Routes

**Location:** `app/api/`

```bash
cd ~/Code/work/star-edtech/watsonx-learning-platform

# Create API directories
mkdir -p app/api/extract-transcript
mkdir -p app/api/analyze-video
mkdir -p app/api/practice-points/[videoId]

# Copy API route files
cp ~/Downloads/api-extract-transcript-route.ts app/api/extract-transcript/route.ts
cp ~/Downloads/api-analyze-video-route.ts app/api/analyze-video/route.ts
cp ~/Downloads/api-practice-points-route.ts app/api/practice-points/[videoId]/route.ts
```

---

### 2. Updated Lab Page

**Location:** `app/labs/[labId]/page.tsx`

```bash
# Backup current lab page
cp app/labs/[labId]/page.tsx app/labs/[labId]/page-backup.tsx

# Copy new timestamp-aware lab page
cp ~/Downloads/labs-labId-page-sync.tsx app/labs/[labId]/page.tsx
```

---

### 3. Enhanced LabRunner Component

**Location:** `components/LabRunner.tsx`

```bash
# Backup current LabRunner
cp components/LabRunner.tsx components/LabRunner-backup.tsx

# Copy enhanced LabRunner
cp ~/Downloads/LabRunner-sync.tsx components/LabRunner.tsx
```

---

### 4. Chrome Extension Updates

**Location:** `../genai-labs-extension/`

```bash
cd ../genai-labs-extension

# Backup current files
cp content-youtube.js content-youtube-backup.js
cp overlay.css overlay-backup.css

# Copy updated files
cp ~/Downloads/content-youtube-sync.js content-youtube.js
cp ~/Downloads/overlay-sync.css overlay.css
```

---

## üìö Required Dependencies

### Next.js Platform

Add these packages:

```bash
cd ~/Code/work/star-edtech/watsonx-learning-platform

# Install YouTube transcript API
npm install youtube-transcript

# Anthropic SDK (for AI analysis)
npm install @anthropic-ai/sdk
```

Update `package.json`:
```json
{
  "dependencies": {
    "youtube-transcript": "^1.0.6",
    "@anthropic-ai/sdk": "^0.10.2",
    ...existing dependencies
  }
}
```

---

## üîê Environment Variables

Add to `.env.local`:

```bash
# Anthropic API key for video analysis
ANTHROPIC_API_KEY=your-anthropic-api-key

# Platform URL for API calls
NEXT_PUBLIC_API_URL=https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud
```

**Get Anthropic API Key:**
1. Go to: https://console.anthropic.com/
2. Create API key
3. Copy to `.env.local`

---

## üöÄ Deployment Steps

### Step 1: Test Locally

```bash
cd ~/Code/work/star-edtech/watsonx-learning-platform

# Install dependencies
npm install

# Run locally
npm run dev

# Test in browser: http://localhost:3000
```

**Test the APIs:**

```bash
# Test transcript extraction
curl -X POST http://localhost:3000/api/extract-transcript \
  -H 'Content-Type: application/json' \
  -d '{"videoId": "iOdFUJiB0Zc"}'

# Should return transcript with timestamps
```

---

### Step 2: Deploy to IBM Cloud

```bash
# Build production image
docker build --platform linux/amd64 -f Dockerfile.prod -t genai-learning-platform:latest .

# Tag for IBM Cloud
docker tag genai-learning-platform:latest icr.io/ranga/genai-learning-platform:latest

# Push to registry
docker push icr.io/ranga/genai-learning-platform:latest

# Update app with environment variables
ibmcloud ce project select -n genai-learning-platform

ibmcloud ce app update \
  --name genai-learning-platform \
  --image icr.io/ranga/genai-learning-platform:latest \
  --env ANTHROPIC_API_KEY="your-key-here" \
  --env NEXT_PUBLIC_API_URL="https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud"
```

---

### Step 3: Update Chrome Extension

```bash
cd ../genai-labs-extension

# Extension is ready to test locally
# Go to chrome://extensions
# Click "Reload" on GenAI Labs extension
```

**Test extension:**
1. Go to YouTube: https://www.youtube.com/watch?v=iOdFUJiB0Zc
2. Wait for overlay to load
3. Should see "Analyzing video..." then practice count
4. Play video and wait for notifications

---

## üß™ Testing Checklist

### Backend APIs

- [ ] GET `/api/practice-points/iOdFUJiB0Zc` returns practice points
- [ ] POST `/api/extract-transcript` returns transcript
- [ ] POST `/api/analyze-video` returns AI analysis
- [ ] APIs return cached results on second call

### Extension

- [ ] Overlay appears on AI/ML videos
- [ ] Practice count displays correctly
- [ ] Video monitoring starts automatically
- [ ] Notifications appear at timestamps
- [ ] "Start Lab" button opens correct lab

### Lab Pages

- [ ] Labs open with timestamp parameter
- [ ] Correct section loads based on timestamp
- [ ] Progress bar shows section number
- [ ] "Continue Video" button works
- [ ] Code execution still works

---

## üêõ Troubleshooting

### Issue: "youtube-transcript" fails

**Cause:** YouTube blocking transcript API

**Solution 1:** Use fallback static practice points
```javascript
// In content-youtube-sync.js
function getStaticPracticePoints() {
  return [
    {
      timestamp: 300,
      topic: "Getting Started",
      suggestedLab: { title: "Your First API Call", difficulty: "beginner" }
    }
  ];
}
```

**Solution 2:** Pre-extract transcripts and store in database

---

### Issue: Anthropic API rate limits

**Cause:** Too many analysis requests

**Solution:** Cache results aggressively
```typescript
// Already implemented in api-practice-points-route.ts
const cache = new Map<string, PracticePointsResponse>();
```

---

### Issue: Extension notifications not appearing

**Debug:**
1. Open browser console (F12)
2. Check for errors
3. Verify `practicePoints` array loaded
4. Check video element exists

**Fix:**
```javascript
// In console:
console.log(practicePoints); // Should show array
console.log(document.querySelector('video')); // Should show video element
```

---

## üìä Monitoring & Analytics

### Add Event Tracking (Optional)

```typescript
// In content-youtube-sync.js
function trackEvent(eventName: string, data: any) {
  // Send to your analytics
  fetch('https://your-analytics.com/track', {
    method: 'POST',
    body: JSON.stringify({ event: eventName, ...data })
  });
}

// Track notification shown
trackEvent('practice_notification_shown', {
  videoId,
  timestamp: point.timestamp,
  topic: point.topic
});

// Track lab started
trackEvent('lab_started', {
  videoId,
  labId,
  timestamp
});
```

---

## üéØ Success Metrics

After deployment, track:

**Engagement:**
- % of users who click "Start Lab" from notification
- Average time from notification to lab start
- Completion rate per section

**Usage:**
- Videos analyzed per day
- Practice points generated
- Labs opened from video context

**Performance:**
- API response times
- Cache hit rate
- Extension load time

---

## üöÄ Going Live

### Pre-Launch Checklist

- [ ] Test on 5+ different videos
- [ ] Verify all practice notifications work
- [ ] Confirm labs load with correct sections
- [ ] Check API performance under load
- [ ] Test extension on different browsers
- [ ] Prepare demo video for launch

### Launch Day

1. **Social Media Posts:**
   - "We just made learning AI 10x more effective"
   - Share demo video showing video ‚Üí notification ‚Üí lab flow
   - Highlight the "aha moment"

2. **Product Hunt:**
   - Title: "GenAI Labs - Practice While You Watch AI Tutorials"
   - Tagline: "Interactive coding labs that appear at the perfect moment in YouTube tutorials"
   - Demo video showing seamless sync

3. **Hacker News:**
   - Show HN: Real-time practice labs for AI/ML YouTube tutorials
   - Explain the technical challenge of video-lab sync

---

## üìà Future Enhancements

**Week 3 Ideas:**

1. **Bi-Directional Sync**
   - Lab completion triggers video resume
   - Video pause triggers lab suggestion

2. **Multi-Video Paths**
   - Create learning paths across multiple videos
   - Track progress across entire course

3. **Collaborative Features**
   - See how many people are on same section
   - Share code snippets
   - Ask questions to AI tutor

4. **Mobile Support**
   - iOS/Android apps
   - Practice on phone while watching on TV

---

## üéâ You're Ready!

Once deployed, you'll have the **killer feature** that makes GenAI Labs unique!

**The flow:**
```
User watches YouTube ‚Üí 
Notification at 5:23 ‚Üí 
Click "Start Lab" ‚Üí 
Lab opens with exact code from video ‚Üí 
User practices ‚Üí 
Click "Continue Video" ‚Üí 
Seamless learning! üöÄ
```

---

**Questions?** Review the code files or test each component individually!
</file>

<file path="api-analyze-video-route.ts">
import { NextResponse } from 'next/server';
import Anthropic from '@anthropic-ai/sdk';

/**
 * AI Practice Point Detection API
 * 
 * Analyzes a video transcript and identifies moments where students should practice.
 * Uses Claude to understand context and suggest labs.
 * 
 * POST /api/analyze-video
 * Body: { 
 *   videoId: string,
 *   transcript: [{text, start, duration}],
 *   title: string
 * }
 * 
 * Returns: { 
 *   practicePoints: [{timestamp, topic, description, suggestedLab}]
 * }
 */

interface TranscriptSegment {
  text: string;
  start: number;
  duration: number;
}

interface PracticePoint {
  timestamp: number;
  endTimestamp: number;
  topic: string;
  description: string;
  suggestedLab: {
    title: string;
    starterCode: string;
    difficulty: 'beginner' | 'intermediate' | 'advanced';
    estimatedTime: number;
  };
}

interface AnalysisResponse {
  videoId: string;
  practicePoints: PracticePoint[];
}

export async function POST(request: Request) {
  try {
    const { videoId, transcript, title } = await request.json();

    if (!videoId || !transcript || !Array.isArray(transcript)) {
      return NextResponse.json(
        { error: 'videoId and transcript are required' },
        { status: 400 }
      );
    }

    // Initialize Anthropic client
    const anthropic = new Anthropic({
      apiKey: process.env.ANTHROPIC_API_KEY,
    });

    // Convert transcript to readable format for Claude
    const transcriptText = formatTranscriptForAnalysis(transcript);

    // Create the analysis prompt
    const prompt = createAnalysisPrompt(title, transcriptText);

    // Call Claude for analysis
    const message = await anthropic.messages.create({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 4000,
      messages: [
        {
          role: 'user',
          content: prompt
        }
      ]
    });

    // Parse Claude's response
    const responseText = message.content[0].type === 'text' 
      ? message.content[0].text 
      : '';

    const practicePoints = parseClaudeResponse(responseText);

    const response: AnalysisResponse = {
      videoId,
      practicePoints
    };

    return NextResponse.json(response);

  } catch (error) {
    console.error('Video analysis error:', error);
    
    return NextResponse.json(
      { 
        error: 'Failed to analyze video',
        details: error instanceof Error ? error.message : 'Unknown error'
      },
      { status: 500 }
    );
  }
}

/**
 * Format transcript for Claude analysis
 */
function formatTranscriptForAnalysis(transcript: TranscriptSegment[]): string {
  return transcript.map(segment => {
    const timestamp = formatTimestamp(segment.start);
    return `[${timestamp}] ${segment.text}`;
  }).join('\n');
}

/**
 * Format seconds to MM:SS
 */
function formatTimestamp(seconds: number): string {
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

/**
 * Create the analysis prompt for Claude
 */
function createAnalysisPrompt(videoTitle: string, transcript: string): string {
  return `You are analyzing a coding tutorial video to identify moments where students should practice what they're learning.

VIDEO TITLE: ${videoTitle}

TRANSCRIPT (with timestamps):
${transcript}

TASK: Identify all moments where the instructor demonstrates code or explains a concept that students should practice hands-on.

For each practice moment, provide:
1. Start timestamp (in seconds)
2. End timestamp (in seconds)
3. Topic being taught (concise, specific)
4. Description (1-2 sentences explaining what the instructor shows)
5. Suggested lab exercise:
   - Title (engaging, specific)
   - Starter code (Python code with TODO comments)
   - Difficulty level (beginner/intermediate/advanced)
   - Estimated time in minutes

GUIDELINES:
- Only identify moments where CODE is being demonstrated
- Focus on practical, hands-on opportunities
- Starter code should have clear TODO comments
- Be specific about what to practice
- Typical tutorial has 3-5 practice points

Return ONLY valid JSON in this format:
{
  "practicePoints": [
    {
      "timestamp": 323,
      "endTimestamp": 445,
      "topic": "Making your first Bedrock API call",
      "description": "Instructor demonstrates how to initialize boto3 client and call invoke_model with a simple prompt.",
      "suggestedLab": {
        "title": "Your First Bedrock API Call",
        "starterCode": "import boto3\\n\\n# TODO: Initialize bedrock client\\n\\n# TODO: Create request body\\n\\n# TODO: Call invoke_model",
        "difficulty": "beginner",
        "estimatedTime": 15
      }
    }
  ]
}`;
}

/**
 * Parse Claude's JSON response
 */
function parseClaudeResponse(response: string): PracticePoint[] {
  try {
    // Extract JSON from markdown code blocks if present
    const jsonMatch = response.match(/```json\n([\s\S]*?)\n```/) || 
                      response.match(/```\n([\s\S]*?)\n```/);
    
    const jsonStr = jsonMatch ? jsonMatch[1] : response;
    
    const parsed = JSON.parse(jsonStr);
    
    return parsed.practicePoints || [];
  } catch (error) {
    console.error('Failed to parse Claude response:', error);
    return [];
  }
}
</file>

<file path="api-extract-transcript-route.ts">
import { NextResponse } from 'next/server';

/**
 * Extract YouTube Transcript API
 * 
 * This endpoint extracts transcripts from YouTube videos using the 
 * youtube-transcript package.
 * 
 * POST /api/extract-transcript
 * Body: { videoId: string }
 * 
 * Returns: { videoId, title, duration, transcript: [{text, start, duration}] }
 */

// We'll use the youtube-transcript package
// Install: npm install youtube-transcript

interface TranscriptSegment {
  text: string;
  start: number;
  duration: number;
}

interface TranscriptResponse {
  videoId: string;
  title: string;
  duration: number;
  transcript: TranscriptSegment[];
  language: string;
}

export async function POST(request: Request) {
  try {
    const { videoId } = await request.json();

    if (!videoId) {
      return NextResponse.json(
        { error: 'videoId is required' },
        { status: 400 }
      );
    }

    // Import the youtube-transcript package dynamically
    const { YoutubeTranscript } = await import('youtube-transcript');

    // Fetch transcript
    const transcript = await YoutubeTranscript.fetchTranscript(videoId);

    // Get video metadata (we'll use a simple fetch to YouTube)
    const videoInfo = await getVideoMetadata(videoId);

    const response: TranscriptResponse = {
      videoId,
      title: videoInfo.title,
      duration: videoInfo.duration,
      transcript: transcript.map((segment: any) => ({
        text: segment.text,
        start: segment.offset / 1000, // Convert to seconds
        duration: segment.duration / 1000
      })),
      language: 'en'
    };

    return NextResponse.json(response);

  } catch (error) {
    console.error('Transcript extraction error:', error);
    
    return NextResponse.json(
      { 
        error: 'Failed to extract transcript',
        details: error instanceof Error ? error.message : 'Unknown error'
      },
      { status: 500 }
    );
  }
}

/**
 * Get video metadata from YouTube
 * Uses oEmbed API (no API key required!)
 */
async function getVideoMetadata(videoId: string) {
  try {
    const oembedUrl = `https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`;
    const response = await fetch(oembedUrl);
    const data = await response.json();

    return {
      title: data.title,
      author: data.author_name,
      duration: 0 // oEmbed doesn't provide duration, we'll estimate from transcript
    };
  } catch (error) {
    return {
      title: 'Unknown',
      author: 'Unknown',
      duration: 0
    };
  }
}
</file>

<file path="api-practice-points-route.ts">
import { NextResponse } from 'next/server';

/**
 * Get Practice Points for Video
 * 
 * This is the main endpoint the Chrome extension will call.
 * It combines transcript extraction and AI analysis into one call.
 * 
 * GET /api/practice-points/[videoId]
 * 
 * Returns: { 
 *   videoId,
 *   title,
 *   practicePoints: [{timestamp, topic, description, suggestedLab}],
 *   cached: boolean
 * }
 */

interface PracticePoint {
  timestamp: number;
  endTimestamp: number;
  topic: string;
  description: string;
  suggestedLab: {
    title: string;
    starterCode: string;
    difficulty: 'beginner' | 'intermediate' | 'advanced';
    estimatedTime: number;
  };
}

interface PracticePointsResponse {
  videoId: string;
  title: string;
  duration: number;
  practicePoints: PracticePoint[];
  cached: boolean;
}

// In-memory cache (in production, use Redis or database)
const cache = new Map<string, PracticePointsResponse>();

export async function GET(
  request: Request,
  { params }: { params: { videoId: string } }
) {
  try {
    const { videoId } = params;

    // Check cache first
    if (cache.has(videoId)) {
      const cachedData = cache.get(videoId)!;
      return NextResponse.json({ ...cachedData, cached: true });
    }

    // Step 1: Extract transcript
    const transcriptResponse = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/api/extract-transcript`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ videoId })
      }
    );

    if (!transcriptResponse.ok) {
      throw new Error('Failed to extract transcript');
    }

    const transcriptData = await transcriptResponse.json();

    // Step 2: Analyze with AI
    const analysisResponse = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/api/analyze-video`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          videoId,
          transcript: transcriptData.transcript,
          title: transcriptData.title
        })
      }
    );

    if (!analysisResponse.ok) {
      throw new Error('Failed to analyze video');
    }

    const analysisData = await analysisResponse.json();

    // Combine results
    const response: PracticePointsResponse = {
      videoId,
      title: transcriptData.title,
      duration: transcriptData.duration,
      practicePoints: analysisData.practicePoints,
      cached: false
    };

    // Cache the result
    cache.set(videoId, response);

    return NextResponse.json(response);

  } catch (error) {
    console.error('Practice points error:', error);
    
    // Return empty practice points on error (graceful degradation)
    return NextResponse.json(
      { 
        videoId: params.videoId,
        title: 'Unknown',
        duration: 0,
        practicePoints: [],
        cached: false,
        error: error instanceof Error ? error.message : 'Unknown error'
      },
      { status: 200 } // Still return 200 so extension doesn't break
    );
  }
}
</file>

<file path="content-youtube-sync.js">
/**
 * Content Script for YouTube - Video-Lab Synchronization
 * 
 * This script:
 * 1. Detects AI/ML tutorial videos
 * 2. Loads practice points from API
 * 3. Monitors video playback
 * 4. Shows practice notifications at right timestamps
 * 5. Opens labs with timestamp context
 */

// Configuration
const PLATFORM_URL = 'https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud';
const CHECK_INTERVAL = 1000; // Check every second

// State
let videoId = null;
let practicePoints = [];
let lastTimestamp = 0;
let shownNotifications = new Set();
let isMonitoring = false;

// Initialize when page loads
console.log('GenAI Labs: Content script loaded');
init();

function init() {
  // Get video ID from URL
  videoId = getVideoId();
  
  if (!videoId) {
    console.log('GenAI Labs: No video ID found');
    return;
  }

  console.log('GenAI Labs: Video detected:', videoId);

  // Check if this is an AI/ML tutorial
  if (isAIMLVideo()) {
    console.log('GenAI Labs: AI/ML tutorial detected');
    loadPracticePoints();
    showOverlay();
    startVideoMonitoring();
  }
}

/**
 * Get YouTube video ID from URL
 */
function getVideoId() {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get('v');
}

/**
 * Check if video is about AI/ML
 */
function isAIMLVideo() {
  const title = document.querySelector('h1.ytd-video-primary-info-renderer')?.textContent || '';
  const description = document.querySelector('#description')?.textContent || '';
  const combined = (title + ' ' + description).toLowerCase();

  const keywords = [
    'ai', 'artificial intelligence', 'machine learning', 'ml',
    'deep learning', 'neural network', 'llm', 'gpt', 'chatbot',
    'bedrock', 'watsonx', 'openai', 'anthropic', 'claude',
    'langchain', 'vector database', 'embedding', 'rag',
    'prompt engineering', 'fine-tuning', 'generative ai'
  ];

  return keywords.some(keyword => combined.includes(keyword));
}

/**
 * Load practice points from API
 */
async function loadPracticePoints() {
  try {
    console.log('GenAI Labs: Loading practice points...');
    
    const response = await fetch(`${PLATFORM_URL}/api/practice-points/${videoId}`);
    const data = await response.json();

    practicePoints = data.practicePoints || [];
    
    console.log(`GenAI Labs: Loaded ${practicePoints.length} practice points`);
    
    // Update overlay with count
    updateOverlayCount(practicePoints.length);

  } catch (error) {
    console.error('GenAI Labs: Failed to load practice points:', error);
    // Fallback to static labs
    practicePoints = getStaticPracticePoints();
  }
}

/**
 * Fallback static practice points (for videos we haven't analyzed yet)
 */
function getStaticPracticePoints() {
  return [
    {
      timestamp: 180, // 3 minutes
      topic: "Getting Started",
      suggestedLab: {
        title: "Your First AI API Call",
        difficulty: "beginner"
      }
    }
  ];
}

/**
 * Start monitoring video playback
 */
function startVideoMonitoring() {
  if (isMonitoring) return;
  
  isMonitoring = true;
  console.log('GenAI Labs: Starting video monitoring');

  setInterval(() => {
    const video = document.querySelector('video');
    if (!video) return;

    const currentTime = Math.floor(video.currentTime);
    
    // Check if we've crossed a practice point threshold
    checkForPracticePoint(currentTime);
    
    lastTimestamp = currentTime;
  }, CHECK_INTERVAL);
}

/**
 * Check if current timestamp matches a practice point
 */
function checkForPracticePoint(currentTime) {
  const matchingPoint = practicePoints.find(point => {
    const isInWindow = currentTime >= point.timestamp && 
                       currentTime < point.timestamp + 10; // 10 second window
    const justCrossed = lastTimestamp < point.timestamp;
    const notShown = !shownNotifications.has(point.timestamp);
    
    return isInWindow && justCrossed && notShown;
  });

  if (matchingPoint) {
    showPracticeNotification(matchingPoint);
    shownNotifications.add(matchingPoint.timestamp);
  }
}

/**
 * Show practice notification
 */
function showPracticeNotification(point) {
  console.log('GenAI Labs: Showing practice notification for', point.topic);

  // Remove existing notification if any
  const existing = document.querySelector('.genai-practice-notification');
  if (existing) existing.remove();

  // Create notification element
  const notification = document.createElement('div');
  notification.className = 'genai-practice-notification';
  notification.innerHTML = `
    <div class="genai-notification-content">
      <div class="genai-notification-icon">üí°</div>
      <div class="genai-notification-text">
        <h4>Ready to Practice!</h4>
        <p class="genai-notification-topic">${point.topic}</p>
        <p class="genai-notification-subtitle">The instructor just showed this - try it yourself now!</p>
      </div>
      <div class="genai-notification-actions">
        <button class="genai-btn-primary" data-timestamp="${point.timestamp}">
          Start Lab
        </button>
        <button class="genai-btn-secondary">
          Later
        </button>
      </div>
    </div>
  `;

  // Add event listeners
  notification.querySelector('.genai-btn-primary').addEventListener('click', () => {
    startLabAtTimestamp(point);
    notification.remove();
  });

  notification.querySelector('.genai-btn-secondary').addEventListener('click', () => {
    notification.remove();
  });

  // Add to page
  document.body.appendChild(notification);

  // Auto-dismiss after 15 seconds
  setTimeout(() => {
    if (notification.parentNode) {
      notification.remove();
    }
  }, 15000);

  // Animate in
  setTimeout(() => notification.classList.add('show'), 100);
}

/**
 * Open lab at specific timestamp
 */
function startLabAtTimestamp(point) {
  console.log('GenAI Labs: Starting lab at timestamp', point.timestamp);

  // Determine lab ID based on topic (fallback to generic lab)
  const labId = determineLabId(point);

  // Build lab URL with context
  const labUrl = `${PLATFORM_URL}/labs/${labId}?videoId=${videoId}&timestamp=${point.timestamp}&topic=${encodeURIComponent(point.topic)}`;

  // Try to trigger Picture-in-Picture mode
  const video = document.querySelector('video');
  if (video && video.requestPictureInPicture && document.pictureInPictureEnabled) {
    video.requestPictureInPicture().catch(err => {
      console.log('GenAI Labs: PiP not available:', err);
    });
  }

  // Open lab in new tab
  window.open(labUrl, '_blank');
}

/**
 * Determine which lab to open based on topic
 */
function determineLabId(point) {
  const topic = point.topic.toLowerCase();
  const title = point.suggestedLab?.title?.toLowerCase() || '';
  
  // Match keywords to lab IDs
  if (topic.includes('bedrock') || title.includes('bedrock')) {
    return 'your-first-bedrock-api-call';
  } else if (topic.includes('watsonx') || title.includes('watsonx')) {
    return 'watsonx-first-call';
  } else if (topic.includes('chatbot') || title.includes('chatbot')) {
    return 'build-a-simple-chatbot';
  } else if (topic.includes('rag') || title.includes('rag')) {
    return 'advanced-rag-patterns';
  }
  
  // Default to bedrock lab
  return 'your-first-bedrock-api-call';
}

/**
 * Show initial overlay
 */
function showOverlay() {
  // Same overlay code as before, but with practice count
  const overlay = document.createElement('div');
  overlay.className = 'genai-overlay';
  overlay.innerHTML = `
    <div class="genai-header">
      <div class="genai-icon">üß™</div>
      <h3>GenAI Labs</h3>
      <span class="genai-practice-badge" id="genai-practice-count">
        Loading...
      </span>
    </div>
    <p class="genai-subtitle">Practice What You're Learning!</p>
    <div class="genai-labs-list" id="genai-labs-list">
      <div class="genai-loading">Analyzing video...</div>
    </div>
  `;

  document.body.appendChild(overlay);
}

/**
 * Update overlay with practice point count
 */
function updateOverlayCount(count) {
  const badge = document.getElementById('genai-practice-count');
  if (badge) {
    badge.textContent = `${count} practice ${count === 1 ? 'opportunity' : 'opportunities'}`;
  }

  // Update labs list
  const labsList = document.getElementById('genai-labs-list');
  if (labsList && practicePoints.length > 0) {
    labsList.innerHTML = practicePoints.map((point, index) => {
      const timestamp = formatTimestamp(point.timestamp);
      return `
        <div class="genai-lab-card">
          <div class="genai-lab-header">
            <span class="genai-lab-number">${index + 1}</span>
            <span class="genai-lab-badge genai-lab-badge-${point.suggestedLab.difficulty}">
              ${point.suggestedLab.difficulty}
            </span>
          </div>
          <h4 class="genai-lab-title">${point.suggestedLab.title}</h4>
          <p class="genai-lab-topic">${point.topic}</p>
          <p class="genai-lab-time">
            <span class="genai-time-badge">‚è±Ô∏è ${point.suggestedLab.estimatedTime} min</span>
            <span class="genai-timestamp-badge">üìç ${timestamp}</span>
          </p>
          <button class="genai-lab-start-btn" data-index="${index}">
            Start Lab ‚Üí
          </button>
        </div>
      `;
    }).join('');

    // Add click handlers
    labsList.querySelectorAll('.genai-lab-start-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const index = parseInt(e.target.dataset.index);
        startLabAtTimestamp(practicePoints[index]);
      });
    });
  }
}

/**
 * Format timestamp (seconds to MM:SS)
 */
function formatTimestamp(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// Listen for URL changes (YouTube SPA navigation)
let lastUrl = location.href;
new MutationObserver(() => {
  const url = location.href;
  if (url !== lastUrl) {
    lastUrl = url;
    // Reset and reinitialize
    videoId = null;
    practicePoints = [];
    shownNotifications.clear();
    isMonitoring = false;
    init();
  }
}).observe(document, { subtree: true, childList: true });
</file>

<file path="deploy-video-sync.sh">
#!/bin/bash

##############################################################################
# GenAI Labs - Video-Lab Sync Feature Deployment Script
# 
# This script automates the deployment of the video-lab synchronization feature
# 
# Usage:
#   chmod +x deploy-video-sync.sh
#   ./deploy-video-sync.sh
##############################################################################

set -e  # Exit on error

echo "üöÄ GenAI Labs - Video-Lab Sync Deployment"
echo "=========================================="
echo ""

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo -e "${RED}‚ùå Error: package.json not found. Are you in the watsonx-learning-platform directory?${NC}"
    exit 1
fi

echo -e "${BLUE}üìã Step 1: Checking dependencies...${NC}"

# Check if required files exist in Downloads
FILES_TO_COPY=(
    "api-extract-transcript-route.ts"
    "api-analyze-video-route.ts"
    "api-practice-points-route.ts"
    "content-youtube-sync.js"
    "overlay-sync.css"
    "labs-labId-page-sync.tsx"
    "LabRunner-sync.tsx"
)

MISSING_FILES=()
for file in "${FILES_TO_COPY[@]}"; do
    if [ ! -f "$HOME/Downloads/$file" ]; then
        MISSING_FILES+=("$file")
    fi
done

if [ ${#MISSING_FILES[@]} -gt 0 ]; then
    echo -e "${RED}‚ùå Missing files in ~/Downloads:${NC}"
    for file in "${MISSING_FILES[@]}"; do
        echo "   - $file"
    done
    echo ""
    echo "Please download all required files first!"
    exit 1
fi

echo -e "${GREEN}‚úÖ All required files found!${NC}"
echo ""

# Confirm with user
echo -e "${YELLOW}‚ö†Ô∏è  This will modify your existing files. Continue? (y/n)${NC}"
read -r response
if [[ ! "$response" =~ ^[Yy]$ ]]; then
    echo "Deployment cancelled."
    exit 0
fi

echo ""
echo -e "${BLUE}üì¶ Step 2: Creating backups...${NC}"

# Create backup directory
BACKUP_DIR="backups/video-sync-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"

# Backup existing files
if [ -f "app/labs/[labId]/page.tsx" ]; then
    cp "app/labs/[labId]/page.tsx" "$BACKUP_DIR/page.tsx.backup"
    echo "   ‚úì Backed up app/labs/[labId]/page.tsx"
fi

if [ -f "components/LabRunner.tsx" ]; then
    cp "components/LabRunner.tsx" "$BACKUP_DIR/LabRunner.tsx.backup"
    echo "   ‚úì Backed up components/LabRunner.tsx"
fi

echo -e "${GREEN}‚úÖ Backups created in $BACKUP_DIR${NC}"
echo ""

echo -e "${BLUE}üìÇ Step 3: Creating API directories...${NC}"

mkdir -p app/api/extract-transcript
mkdir -p app/api/analyze-video
mkdir -p "app/api/practice-points/[videoId]"

echo "   ‚úì Created app/api/extract-transcript"
echo "   ‚úì Created app/api/analyze-video"
echo "   ‚úì Created app/api/practice-points/[videoId]"
echo ""

echo -e "${BLUE}üì• Step 4: Copying API route files...${NC}"

cp "$HOME/Downloads/api-extract-transcript-route.ts" "app/api/extract-transcript/route.ts"
echo "   ‚úì app/api/extract-transcript/route.ts"

cp "$HOME/Downloads/api-analyze-video-route.ts" "app/api/analyze-video/route.ts"
echo "   ‚úì app/api/analyze-video/route.ts"

cp "$HOME/Downloads/api-practice-points-route.ts" "app/api/practice-points/[videoId]/route.ts"
echo "   ‚úì app/api/practice-points/[videoId]/route.ts"

echo -e "${GREEN}‚úÖ API routes installed!${NC}"
echo ""

echo -e "${BLUE}üì• Step 5: Updating platform components...${NC}"

cp "$HOME/Downloads/labs-labId-page-sync.tsx" "app/labs/[labId]/page.tsx"
echo "   ‚úì app/labs/[labId]/page.tsx"

cp "$HOME/Downloads/LabRunner-sync.tsx" "components/LabRunner.tsx"
echo "   ‚úì components/LabRunner.tsx"

echo -e "${GREEN}‚úÖ Platform components updated!${NC}"
echo ""

echo -e "${BLUE}üì• Step 6: Updating Chrome extension...${NC}"

# Check if extension directory exists
EXTENSION_DIR="../genai-labs-extension"
if [ -d "$EXTENSION_DIR" ]; then
    cd "$EXTENSION_DIR"
    
    # Backup
    cp "content-youtube.js" "content-youtube.backup.js" 2>/dev/null || true
    cp "overlay.css" "overlay.backup.css" 2>/dev/null || true
    
    # Copy new files
    cp "$HOME/Downloads/content-youtube-sync.js" "content-youtube.js"
    echo "   ‚úì content-youtube.js"
    
    cp "$HOME/Downloads/overlay-sync.css" "overlay.css"
    echo "   ‚úì overlay.css"
    
    cd - > /dev/null
    echo -e "${GREEN}‚úÖ Extension updated!${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  Extension directory not found at $EXTENSION_DIR${NC}"
    echo "   You'll need to update it manually."
fi
echo ""

echo -e "${BLUE}üì¶ Step 7: Installing npm dependencies...${NC}"

# Check if dependencies are already installed
if ! grep -q "youtube-transcript" package.json; then
    echo "   Installing youtube-transcript..."
    npm install youtube-transcript --save
fi

if ! grep -q "@anthropic-ai/sdk" package.json; then
    echo "   Installing @anthropic-ai/sdk..."
    npm install @anthropic-ai/sdk --save
fi

echo -e "${GREEN}‚úÖ Dependencies installed!${NC}"
echo ""

echo -e "${BLUE}üîê Step 8: Checking environment variables...${NC}"

ENV_FILE=".env.local"
MISSING_VARS=()

if [ ! -f "$ENV_FILE" ]; then
    echo "   Creating .env.local..."
    touch "$ENV_FILE"
fi

if ! grep -q "ANTHROPIC_API_KEY" "$ENV_FILE"; then
    MISSING_VARS+=("ANTHROPIC_API_KEY")
fi

if ! grep -q "NEXT_PUBLIC_API_URL" "$ENV_FILE"; then
    MISSING_VARS+=("NEXT_PUBLIC_API_URL")
fi

if [ ${#MISSING_VARS[@]} -gt 0 ]; then
    echo -e "${YELLOW}‚ö†Ô∏è  Missing environment variables:${NC}"
    for var in "${MISSING_VARS[@]}"; do
        echo "   - $var"
    done
    echo ""
    echo "Please add these to .env.local:"
    echo ""
    echo "ANTHROPIC_API_KEY=your-anthropic-api-key"
    echo "NEXT_PUBLIC_API_URL=https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud"
    echo ""
else
    echo -e "${GREEN}‚úÖ Environment variables configured!${NC}"
fi
echo ""

echo -e "${BLUE}üß™ Step 9: Testing locally...${NC}"
echo ""
echo "Starting development server..."
echo "Visit http://localhost:3000 to test"
echo ""
echo -e "${YELLOW}Press Ctrl+C when ready to deploy to production${NC}"
echo ""

# Start dev server
npm run dev &
DEV_PID=$!

# Wait for user to press Ctrl+C
trap "kill $DEV_PID 2>/dev/null; exit 0" SIGINT

wait $DEV_PID

echo ""
echo -e "${GREEN}‚úÖ Deployment script complete!${NC}"
echo ""
echo "Next steps:"
echo "1. Test locally at http://localhost:3000"
echo "2. Deploy to production:"
echo ""
echo "   docker build --platform linux/amd64 -f Dockerfile.prod -t genai-learning-platform:latest ."
echo "   docker tag genai-learning-platform:latest icr.io/ranga/genai-learning-platform:latest"
echo "   docker push icr.io/ranga/genai-learning-platform:latest"
echo "   ibmcloud ce app update --name genai-learning-platform --image icr.io/ranga/genai-learning-platform:latest"
echo ""
echo "3. Update Chrome extension:"
echo "   - Go to chrome://extensions"
echo "   - Click 'Reload' on GenAI Labs"
echo ""
echo -e "${BLUE}üéâ Happy coding!${NC}"
</file>

<file path="LabRunner-sync.tsx">
/**
 * Enhanced LabRunner Component
 * 
 * Includes:
 * - Video context display
 * - Section progress
 * - Continue video button
 * - Timestamp awareness
 */

'use client'

import { useState } from 'react'
import Editor from '@monaco-editor/react'
import { Play, RotateCcw, Lightbulb, CheckCircle, XCircle, Loader2, Video, ArrowRight } from 'lucide-react'

interface LabRunnerProps {
  labData: {
    id: string
    title: string
    fullTitle?: string
    difficulty: string
    description: string
    starterCode: string
    platform: 'watsonx' | 'bedrock'
    videoId?: string | null
    timestamp?: number
    topic?: string | null
    sectionNumber?: number
    totalSections?: number
  }
}

export default function LabRunner({ labData }: LabRunnerProps) {
  const [code, setCode] = useState(labData.starterCode)
  const [output, setOutput] = useState('')
  const [validationResult, setValidationResult] = useState<any>(null)
  const [isRunning, setIsRunning] = useState(false)
  const [showHint, setShowHint] = useState(false)

  const hasVideoContext = !!labData.videoId

  const handleRunCode = async () => {
    setIsRunning(true)
    setValidationResult(null)
    setOutput('Running your code...')

    try {
      const response = await fetch('/api/execute', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          code,
          language: 'python',
          timeout: 30,
        }),
      })

      const result = await response.json()
      
      if (result.status === 'success') {
        setOutput(result.output || 'Code executed successfully (no output)')
      } else if (result.status === 'error') {
        setOutput(`‚ùå Error:\n${result.error}`)
      } else if (result.status === 'timeout') {
        setOutput(`‚è±Ô∏è Timeout: Code execution exceeded 30 seconds`)
      } else {
        setOutput(`Unknown result: ${JSON.stringify(result)}`)
      }
      
      setValidationResult(result.validation || null)
    } catch (error) {
      setOutput(`‚ùå Network Error: ${error instanceof Error ? error.message : 'Unknown error'}\n\nMake sure the API is running.`)
    } finally {
      setIsRunning(false)
    }
  }

  const handleReset = () => {
    setCode(labData.starterCode)
    setOutput('')
    setValidationResult(null)
    setShowHint(false)
  }

  const handleContinueVideo = () => {
    if (!labData.videoId) return
    
    // Open YouTube with timestamp
    const currentTimestamp = labData.timestamp || 0
    const resumeTimestamp = currentTimestamp + 30 // Resume 30 seconds after lab started
    const youtubeUrl = `https://www.youtube.com/watch?v=${labData.videoId}&t=${resumeTimestamp}s`
    
    window.open(youtubeUrl, '_blank')
  }

  return (
    <div className="flex flex-col h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white border-b border-gray-200 px-6 py-4">
        <div className="flex items-center justify-between">
          <div className="flex-1">
            {/* Video Context Banner */}
            {hasVideoContext && (
              <div className="mb-3 flex items-center gap-2 text-sm text-gray-600">
                <Video className="w-4 h-4" />
                <span>From video: {labData.topic || 'Tutorial'}</span>
                {labData.timestamp && (
                  <span className="text-gray-400">‚Ä¢ {formatTimestamp(labData.timestamp)}</span>
                )}
              </div>
            )}

            <h1 className="text-2xl font-bold text-gray-900">{labData.title}</h1>
            
            {/* Section Progress */}
            {labData.sectionNumber && labData.totalSections && (
              <div className="mt-2">
                <div className="flex items-center gap-3">
                  <span className="text-sm font-medium text-gray-600">
                    Section {labData.sectionNumber} of {labData.totalSections}
                  </span>
                  <div className="flex-1 max-w-xs h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div 
                      className="h-full bg-blue-600 transition-all duration-300"
                      style={{ width: `${(labData.sectionNumber / labData.totalSections) * 100}%` }}
                    />
                  </div>
                  <span className="text-sm text-gray-500">
                    {Math.round((labData.sectionNumber / labData.totalSections) * 100)}%
                  </span>
                </div>
              </div>
            )}

            <div className="flex items-center space-x-3 mt-2">
              <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                labData.difficulty === 'beginner' ? 'bg-green-100 text-green-800' :
                labData.difficulty === 'intermediate' ? 'bg-yellow-100 text-yellow-800' :
                'bg-red-100 text-red-800'
              }`}>
                {labData.difficulty.charAt(0).toUpperCase() + labData.difficulty.slice(1)}
              </span>
              <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                labData.platform === 'watsonx' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'
              }`}>
                {labData.platform === 'watsonx' ? 'IBM watsonx.ai' : 'AWS Bedrock'}
              </span>
            </div>
          </div>
          
          <div className="flex items-center space-x-3">
            {hasVideoContext && (
              <button
                onClick={handleContinueVideo}
                className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
              >
                <Video className="w-4 h-4" />
                <span>Continue Video</span>
                <ArrowRight className="w-4 h-4" />
              </button>
            )}
            <button
              onClick={() => setShowHint(!showHint)}
              className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
            >
              <Lightbulb className="w-4 h-4" />
              <span>Hint</span>
            </button>
            <button
              onClick={handleReset}
              className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
            >
              <RotateCcw className="w-4 h-4" />
              <span>Reset</span>
            </button>
            <button
              onClick={handleRunCode}
              disabled={isRunning}
              className="flex items-center space-x-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isRunning ? (
                <>
                  <Loader2 className="w-4 h-4 animate-spin" />
                  <span>Running...</span>
                </>
              ) : (
                <>
                  <Play className="w-4 h-4" />
                  <span>Run Code</span>
                </>
              )}
            </button>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 flex overflow-hidden">
        {/* Instructions Panel */}
        <div className="w-1/3 bg-white border-r border-gray-200 overflow-y-auto p-6">
          <h2 className="text-lg font-semibold mb-4">Instructions</h2>
          <div className="prose prose-sm max-w-none">
            <div className="whitespace-pre-line text-gray-700">{labData.description}</div>
          </div>

          {showHint && (
            <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
              <div className="flex items-start space-x-2">
                <Lightbulb className="w-5 h-5 text-yellow-600 mt-0.5" />
                <div>
                  <h3 className="font-semibold text-yellow-900 mb-1">Hint</h3>
                  <p className="text-sm text-yellow-800">
                    Look for the TODO comments in the code. Each TODO indicates a section you need to complete.
                    Replace the <code className="bg-yellow-100 px-1 rounded">___</code> placeholders with the appropriate code.
                  </p>
                </div>
              </div>
            </div>
          )}

          <div className="mt-8 pt-6 border-t border-gray-200">
            <h3 className="font-semibold mb-3">Lab Resources</h3>
            <div className="space-y-2 text-sm text-gray-600">
              <div className="flex items-center justify-between">
                <span>API Key:</span>
                <code className="bg-gray-100 px-2 py-1 rounded">Provided automatically</code>
              </div>
              <div className="flex items-center justify-between">
                <span>Project ID:</span>
                <code className="bg-gray-100 px-2 py-1 rounded">lab-{labData.id}</code>
              </div>
            </div>
          </div>
        </div>

        {/* Code Editor Panel */}
        <div className="flex-1 flex flex-col">
          <div className="flex-1 border-b border-gray-200">
            <Editor
              height="100%"
              defaultLanguage="python"
              value={code}
              onChange={(value) => setCode(value || '')}
              theme="vs-dark"
              options={{
                minimap: { enabled: false },
                fontSize: 14,
                lineNumbers: 'on',
                scrollBeyondLastLine: false,
                automaticLayout: true,
                tabSize: 2,
              }}
            />
          </div>

          {/* Output Panel */}
          <div className="h-1/3 bg-gray-900 text-white overflow-auto">
            <div className="px-4 py-2 bg-gray-800 border-b border-gray-700 text-sm font-medium">
              Output
            </div>
            <div className="p-4">
              {validationResult && (
                <div className={`mb-4 p-3 rounded-lg flex items-start space-x-2 ${
                  validationResult.passed 
                    ? 'bg-green-500/20 border border-green-500/50' 
                    : 'bg-red-500/20 border border-red-500/50'
                }`}>
                  {validationResult.passed ? (
                    <CheckCircle className="w-5 h-5 text-green-400 mt-0.5" />
                  ) : (
                    <XCircle className="w-5 h-5 text-red-400 mt-0.5" />
                  )}
                  <div>
                    <div className="font-semibold">
                      {validationResult.passed ? 'Success!' : 'Not quite right'}
                    </div>
                    <div className="text-sm mt-1 opacity-90">
                      {validationResult.feedback}
                    </div>
                  </div>
                </div>
              )}
              <pre className="font-mono text-sm whitespace-pre-wrap">
                {output || 'Output will appear here when you run your code.'}
              </pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}

function formatTimestamp(seconds: number): string {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}
</file>

<file path="labs-labId-page-sync.tsx">
/**
 * Timestamp-Aware Lab Page
 * 
 * This component loads lab content based on video timestamp,
 * allowing seamless video-to-lab transitions.
 * 
 * URL: /labs/[labId]?videoId=xyz&timestamp=323&topic=...
 */

import LabRunner from '@/components/LabRunner';
import { notFound } from 'next/navigation';

// Lab content database (in production, load from API/database)
const LABS_DATABASE = {
  'your-first-bedrock-api-call': {
    id: 'your-first-bedrock-api-call',
    title: 'Your First Bedrock API Call',
    difficulty: 'beginner',
    platform: 'bedrock',
    
    // Multiple sections based on timestamps
    sections: [
      {
        timeRange: [0, 400],
        title: 'Section 1: Initialize Bedrock Client',
        description: `Learn how to set up your AWS Bedrock client and prepare for your first API call.
        
**What you'll do:**
- Import the boto3 library
- Initialize the Bedrock runtime client
- Understand the basic setup

**Success criteria:**
- Client initialization completes without errors
- You understand the role of boto3`,
        starterCode: `import boto3

# Step 1: Initialize Bedrock client
# TODO: Create a bedrock-runtime client for the us-east-1 region
bedrock = None

print("‚úÖ Bedrock client initialized!")
print(f"Client type: {type(bedrock)}")
`
      },
      {
        timeRange: [400, 600],
        title: 'Section 2: Make Your First API Call',
        description: `Now that your client is set up, make your first call to a foundation model.
        
**What you'll do:**
- Define the model ID
- Create a request body with a prompt
- Call invoke_model()
- Handle the response

**Success criteria:**
- API call completes successfully
- You receive a response from the model`,
        starterCode: `import boto3
import json

# Client is already set up
bedrock = boto3.client('bedrock-runtime', region_name='us-east-1')

# Step 2: Define model and create request
# TODO: Set the model ID to "anthropic.claude-3-sonnet-20240229-v1:0"
model_id = "___"

# TODO: Create a prompt asking "What is Amazon Bedrock?"
prompt = "___"

# TODO: Create the request body
request_body = json.dumps({
    "anthropic_version": "bedrock-2023-05-31",
    "max_tokens": 1000,
    "messages": [
        {"role": "user", "content": prompt}
    ]
})

# TODO: Call the model
response = bedrock.invoke_model(
    modelId=model_id,
    body=request_body
)

print("‚úÖ API call successful!")
print(f"Response: {response}")
`
      },
      {
        timeRange: [600, 900],
        title: 'Section 3: Parse and Display Response',
        description: `The final step is parsing the JSON response and displaying the generated text.
        
**What you'll do:**
- Read the response body
- Parse the JSON
- Extract the generated text
- Display it nicely

**Success criteria:**
- Response is correctly parsed
- Generated text is displayed
- You understand the response structure`,
        starterCode: `import boto3
import json

# Previous code...
bedrock = boto3.client('bedrock-runtime', region_name='us-east-1')
model_id = "anthropic.claude-3-sonnet-20240229-v1:0"
prompt = "What is Amazon Bedrock?"

request_body = json.dumps({
    "anthropic_version": "bedrock-2023-05-31",
    "max_tokens": 1000,
    "messages": [{"role": "user", "content": prompt}]
})

response = bedrock.invoke_model(modelId=model_id, body=request_body)

# Step 3: Parse the response
# TODO: Read the response body
response_body = json.loads(response['body'].read())

# TODO: Extract the generated text
# Hint: response_body['content'][0]['text']
generated_text = "___"

print("ü§ñ AI Response:")
print(generated_text)
`
      }
    ]
  },
  
  'watsonx-first-call': {
    id: 'watsonx-first-call',
    title: 'Your First watsonx.ai API Call',
    difficulty: 'beginner',
    platform: 'watsonx',
    
    sections: [
      {
        timeRange: [0, 999999], // Single section for now
        title: 'Make Your First watsonx.ai Call',
        description: `Learn how to use IBM watsonx.ai foundation models.
        
**What you'll do:**
- Import the watsonx.ai SDK
- Initialize a model
- Generate text with AI
- Understand the response

**Success criteria:**
- Model initializes successfully
- You receive real AI-generated text`,
        starterCode: `import os
from ibm_watsonx_ai.foundation_models import Model

# Credentials are provided automatically
api_key = os.environ.get('WATSONX_API_KEY')
project_id = os.environ.get('WATSONX_PROJECT_ID')
url = os.environ.get('WATSONX_URL')

# Step 1: Initialize the model
# TODO: Use model_id="ibm/granite-3-8b-instruct"
model = Model(
    model_id="___",
    credentials={"apikey": api_key, "url": url},
    project_id=project_id
)

print("‚úÖ Model initialized!")

# Step 2: Generate text
# TODO: Write a prompt asking about AI
prompt = "___"

response = model.generate_text(prompt=prompt)

print(f"\\nü§ñ AI Response:\\n{response}")
`
      }
    ]
  }
};

interface PageProps {
  params: {
    labId: string;
  };
  searchParams: {
    videoId?: string;
    timestamp?: string;
    topic?: string;
  };
}

export default function LabPage({ params, searchParams }: PageProps) {
  const { labId } = params;
  const { videoId, timestamp, topic } = searchParams;

  // Get lab from database
  const labTemplate = LABS_DATABASE[labId as keyof typeof LABS_DATABASE];
  
  if (!labTemplate) {
    notFound();
  }

  // Determine which section to show based on timestamp
  const currentTimestamp = timestamp ? parseInt(timestamp) : 0;
  const section = getAppropriateSection(labTemplate.sections, currentTimestamp);

  // Build lab data for LabRunner
  const labData = {
    id: labTemplate.id,
    title: section.title,
    fullTitle: labTemplate.title,
    difficulty: labTemplate.difficulty,
    platform: labTemplate.platform,
    description: section.description,
    starterCode: section.starterCode,
    videoId: videoId || null,
    timestamp: currentTimestamp,
    topic: topic || null,
    sectionNumber: labTemplate.sections.indexOf(section) + 1,
    totalSections: labTemplate.sections.length
  };

  return <LabRunner labData={labData} />;
}

/**
 * Get the appropriate lab section based on video timestamp
 */
function getAppropriateSection(sections: any[], timestamp: number) {
  // Find section whose time range includes the timestamp
  const matchingSection = sections.find(section => {
    const [start, end] = section.timeRange;
    return timestamp >= start && timestamp < end;
  });

  // Default to first section if no match
  return matchingSection || sections[0];
}

/**
 * Generate static paths for common labs
 */
export async function generateStaticParams() {
  return Object.keys(LABS_DATABASE).map(labId => ({
    labId
  }));
}
</file>

<file path="overlay-sync.css">
/**
 * GenAI Labs - Video Sync Styles
 * Enhanced overlay and practice notifications
 */

/* ========================================
   PRACTICE NOTIFICATION
   ======================================== */

.genai-practice-notification {
  position: fixed;
  bottom: 100px;
  right: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 16px;
  box-shadow: 
    0 10px 40px rgba(102, 126, 234, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.1);
  max-width: 420px;
  z-index: 10000;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  transform: translateX(500px);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.genai-practice-notification.show {
  transform: translateX(0);
  opacity: 1;
}

.genai-notification-content {
  display: flex;
  gap: 16px;
  padding: 20px;
  align-items: flex-start;
}

.genai-notification-icon {
  font-size: 32px;
  flex-shrink: 0;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.genai-notification-text {
  flex: 1;
}

.genai-notification-text h4 {
  margin: 0 0 8px 0;
  font-size: 18px;
  font-weight: 700;
}

.genai-notification-topic {
  margin: 0 0 8px 0;
  font-size: 15px;
  font-weight: 500;
  opacity: 0.95;
}

.genai-notification-subtitle {
  margin: 0;
  font-size: 13px;
  opacity: 0.8;
  line-height: 1.4;
}

.genai-notification-actions {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 16px;
}

.genai-btn-primary,
.genai-btn-secondary {
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.genai-btn-primary {
  background: white;
  color: #667eea;
}

.genai-btn-primary:hover {
  background: #f7f7f7;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.genai-btn-secondary {
  background: rgba(255, 255, 255, 0.15);
  color: white;
  backdrop-filter: blur(10px);
}

.genai-btn-secondary:hover {
  background: rgba(255, 255, 255, 0.25);
}

/* ========================================
   ENHANCED OVERLAY
   ======================================== */

.genai-practice-badge {
  background: rgba(255, 255, 255, 0.2);
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
}

.genai-loading {
  text-align: center;
  padding: 40px 20px;
  opacity: 0.7;
  font-style: italic;
}

.genai-lab-card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 12px;
  transition: all 0.2s;
}

.genai-lab-card:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

.genai-lab-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.genai-lab-number {
  background: white;
  color: #667eea;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
}

.genai-lab-badge {
  padding: 4px 10px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.genai-lab-badge-beginner {
  background: rgba(52, 211, 153, 0.2);
  color: #10b981;
  border: 1px solid rgba(52, 211, 153, 0.3);
}

.genai-lab-badge-intermediate {
  background: rgba(251, 191, 36, 0.2);
  color: #f59e0b;
  border: 1px solid rgba(251, 191, 36, 0.3);
}

.genai-lab-badge-advanced {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.genai-lab-title {
  font-size: 15px;
  font-weight: 600;
  margin: 0 0 8px 0;
  color: white;
}

.genai-lab-topic {
  font-size: 13px;
  opacity: 0.85;
  margin: 0 0 12px 0;
  line-height: 1.4;
}

.genai-lab-time {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
  font-size: 12px;
}

.genai-time-badge,
.genai-timestamp-badge {
  background: rgba(255, 255, 255, 0.15);
  padding: 4px 8px;
  border-radius: 6px;
  font-weight: 500;
}

.genai-lab-start-btn {
  width: 100%;
  background: white;
  color: #667eea;
  border: none;
  padding: 10px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}

.genai-lab-start-btn:hover {
  background: #f7f7f7;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* ========================================
   RESPONSIVE
   ======================================== */

@media (max-width: 768px) {
  .genai-practice-notification {
    bottom: 20px;
    right: 10px;
    left: 10px;
    max-width: none;
  }

  .genai-notification-actions {
    flex-direction: row;
  }

  .genai-btn-primary,
  .genai-btn-secondary {
    flex: 1;
  }
}

/* ========================================
   ANIMATIONS
   ======================================== */

@keyframes slideInRight {
  from {
    transform: translateX(500px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.genai-lab-card {
  animation: fadeIn 0.3s ease-out;
}

.genai-lab-card:nth-child(1) { animation-delay: 0.1s; }
.genai-lab-card:nth-child(2) { animation-delay: 0.2s; }
.genai-lab-card:nth-child(3) { animation-delay: 0.3s; }
.genai-lab-card:nth-child(4) { animation-delay: 0.4s; }
.genai-lab-card:nth-child(5) { animation-delay: 0.5s; }
</file>

<file path="VIDEO_SYNC_DEPLOYMENT_GUIDE.md">
# Video-Lab Sync Feature - Deployment Guide

## üéØ What We're Adding

This guide will help you deploy the **video-lab synchronization feature** - the killer feature that makes GenAI Labs truly magical!

**What it does:**
- Extracts YouTube transcripts with timestamps
- Uses AI to identify practice moments
- Shows notifications at perfect times
- Opens labs with context from the video
- Tracks section progress
- Allows resuming video after practice

---

## üì¶ Files to Add

### 1. Backend API Routes

**Location:** `app/api/`

```bash
cd ~/Code/work/star-edtech/watsonx-learning-platform

# Create API directories
mkdir -p app/api/extract-transcript
mkdir -p app/api/analyze-video
mkdir -p app/api/practice-points/[videoId]

# Copy API route files
cp ~/Downloads/api-extract-transcript-route.ts app/api/extract-transcript/route.ts
cp ~/Downloads/api-analyze-video-route.ts app/api/analyze-video/route.ts
cp ~/Downloads/api-practice-points-route.ts app/api/practice-points/[videoId]/route.ts
```

---

### 2. Updated Lab Page

**Location:** `app/labs/[labId]/page.tsx`

```bash
# Backup current lab page
cp app/labs/[labId]/page.tsx app/labs/[labId]/page-backup.tsx

# Copy new timestamp-aware lab page
cp ~/Downloads/labs-labId-page-sync.tsx app/labs/[labId]/page.tsx
```

---

### 3. Enhanced LabRunner Component

**Location:** `components/LabRunner.tsx`

```bash
# Backup current LabRunner
cp components/LabRunner.tsx components/LabRunner-backup.tsx

# Copy enhanced LabRunner
cp ~/Downloads/LabRunner-sync.tsx components/LabRunner.tsx
```

---

### 4. Chrome Extension Updates

**Location:** `../genai-labs-extension/`

```bash
cd ../genai-labs-extension

# Backup current files
cp content-youtube.js content-youtube-backup.js
cp overlay.css overlay-backup.css

# Copy updated files
cp ~/Downloads/content-youtube-sync.js content-youtube.js
cp ~/Downloads/overlay-sync.css overlay.css
```

---

## üìö Required Dependencies

### Next.js Platform

Add these packages:

```bash
cd ~/Code/work/star-edtech/watsonx-learning-platform

# Install YouTube transcript API
npm install youtube-transcript

# Anthropic SDK (for AI analysis)
npm install @anthropic-ai/sdk
```

Update `package.json`:
```json
{
  "dependencies": {
    "youtube-transcript": "^1.0.6",
    "@anthropic-ai/sdk": "^0.10.2",
    ...existing dependencies
  }
}
```

---

## üîê Environment Variables

Add to `.env.local`:

```bash
# Anthropic API key for video analysis
ANTHROPIC_API_KEY=your-anthropic-api-key

# Platform URL for API calls
NEXT_PUBLIC_API_URL=https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud
```

**Get Anthropic API Key:**
1. Go to: https://console.anthropic.com/
2. Create API key
3. Copy to `.env.local`

---

## üöÄ Deployment Steps

### Step 1: Test Locally

```bash
cd ~/Code/work/star-edtech/watsonx-learning-platform

# Install dependencies
npm install

# Run locally
npm run dev

# Test in browser: http://localhost:3000
```

**Test the APIs:**

```bash
# Test transcript extraction
curl -X POST http://localhost:3000/api/extract-transcript \
  -H 'Content-Type: application/json' \
  -d '{"videoId": "iOdFUJiB0Zc"}'

# Should return transcript with timestamps
```

---

### Step 2: Deploy to IBM Cloud

```bash
# Build production image
docker build --platform linux/amd64 -f Dockerfile.prod -t genai-learning-platform:latest .

# Tag for IBM Cloud
docker tag genai-learning-platform:latest icr.io/ranga/genai-learning-platform:latest

# Push to registry
docker push icr.io/ranga/genai-learning-platform:latest

# Update app with environment variables
ibmcloud ce project select -n genai-learning-platform

ibmcloud ce app update \
  --name genai-learning-platform \
  --image icr.io/ranga/genai-learning-platform:latest \
  --env ANTHROPIC_API_KEY="your-key-here" \
  --env NEXT_PUBLIC_API_URL="https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud"
```

---

### Step 3: Update Chrome Extension

```bash
cd ../genai-labs-extension

# Extension is ready to test locally
# Go to chrome://extensions
# Click "Reload" on GenAI Labs extension
```

**Test extension:**
1. Go to YouTube: https://www.youtube.com/watch?v=iOdFUJiB0Zc
2. Wait for overlay to load
3. Should see "Analyzing video..." then practice count
4. Play video and wait for notifications

---

## üß™ Testing Checklist

### Backend APIs

- [ ] GET `/api/practice-points/iOdFUJiB0Zc` returns practice points
- [ ] POST `/api/extract-transcript` returns transcript
- [ ] POST `/api/analyze-video` returns AI analysis
- [ ] APIs return cached results on second call

### Extension

- [ ] Overlay appears on AI/ML videos
- [ ] Practice count displays correctly
- [ ] Video monitoring starts automatically
- [ ] Notifications appear at timestamps
- [ ] "Start Lab" button opens correct lab

### Lab Pages

- [ ] Labs open with timestamp parameter
- [ ] Correct section loads based on timestamp
- [ ] Progress bar shows section number
- [ ] "Continue Video" button works
- [ ] Code execution still works

---

## üêõ Troubleshooting

### Issue: "youtube-transcript" fails

**Cause:** YouTube blocking transcript API

**Solution 1:** Use fallback static practice points
```javascript
// In content-youtube-sync.js
function getStaticPracticePoints() {
  return [
    {
      timestamp: 300,
      topic: "Getting Started",
      suggestedLab: { title: "Your First API Call", difficulty: "beginner" }
    }
  ];
}
```

**Solution 2:** Pre-extract transcripts and store in database

---

### Issue: Anthropic API rate limits

**Cause:** Too many analysis requests

**Solution:** Cache results aggressively
```typescript
// Already implemented in api-practice-points-route.ts
const cache = new Map<string, PracticePointsResponse>();
```

---

### Issue: Extension notifications not appearing

**Debug:**
1. Open browser console (F12)
2. Check for errors
3. Verify `practicePoints` array loaded
4. Check video element exists

**Fix:**
```javascript
// In console:
console.log(practicePoints); // Should show array
console.log(document.querySelector('video')); // Should show video element
```

---

## üìä Monitoring & Analytics

### Add Event Tracking (Optional)

```typescript
// In content-youtube-sync.js
function trackEvent(eventName: string, data: any) {
  // Send to your analytics
  fetch('https://your-analytics.com/track', {
    method: 'POST',
    body: JSON.stringify({ event: eventName, ...data })
  });
}

// Track notification shown
trackEvent('practice_notification_shown', {
  videoId,
  timestamp: point.timestamp,
  topic: point.topic
});

// Track lab started
trackEvent('lab_started', {
  videoId,
  labId,
  timestamp
});
```

---

## üéØ Success Metrics

After deployment, track:

**Engagement:**
- % of users who click "Start Lab" from notification
- Average time from notification to lab start
- Completion rate per section

**Usage:**
- Videos analyzed per day
- Practice points generated
- Labs opened from video context

**Performance:**
- API response times
- Cache hit rate
- Extension load time

---

## üöÄ Going Live

### Pre-Launch Checklist

- [ ] Test on 5+ different videos
- [ ] Verify all practice notifications work
- [ ] Confirm labs load with correct sections
- [ ] Check API performance under load
- [ ] Test extension on different browsers
- [ ] Prepare demo video for launch

### Launch Day

1. **Social Media Posts:**
   - "We just made learning AI 10x more effective"
   - Share demo video showing video ‚Üí notification ‚Üí lab flow
   - Highlight the "aha moment"

2. **Product Hunt:**
   - Title: "GenAI Labs - Practice While You Watch AI Tutorials"
   - Tagline: "Interactive coding labs that appear at the perfect moment in YouTube tutorials"
   - Demo video showing seamless sync

3. **Hacker News:**
   - Show HN: Real-time practice labs for AI/ML YouTube tutorials
   - Explain the technical challenge of video-lab sync

---

## üìà Future Enhancements

**Week 3 Ideas:**

1. **Bi-Directional Sync**
   - Lab completion triggers video resume
   - Video pause triggers lab suggestion

2. **Multi-Video Paths**
   - Create learning paths across multiple videos
   - Track progress across entire course

3. **Collaborative Features**
   - See how many people are on same section
   - Share code snippets
   - Ask questions to AI tutor

4. **Mobile Support**
   - iOS/Android apps
   - Practice on phone while watching on TV

---

## üéâ You're Ready!

Once deployed, you'll have the **killer feature** that makes GenAI Labs unique!

**The flow:**
```
User watches YouTube ‚Üí 
Notification at 5:23 ‚Üí 
Click "Start Lab" ‚Üí 
Lab opens with exact code from video ‚Üí 
User practices ‚Üí 
Click "Continue Video" ‚Üí 
Seamless learning! üöÄ
```

---

**Questions?** Review the code files or test each component individually!
</file>

<file path="VIDEO_SYNC_SUMMARY.md">
# üéâ Video-Lab Sync Feature - Complete Build Summary

## ‚úÖ What We Just Built

You now have **ALL the code** for the killer video-lab synchronization feature!

---

## üì¶ Files Created (9 files total)

### **Backend APIs (3 files)**

1. **api-extract-transcript-route.ts**
   - Extracts YouTube transcripts with timestamps
   - Uses youtube-transcript package
   - Returns structured transcript data

2. **api-analyze-video-route.ts**
   - Uses Claude AI to analyze transcripts
   - Identifies practice moments
   - Generates lab suggestions with starter code

3. **api-practice-points-route.ts**
   - Combines extraction + analysis
   - Caches results for performance
   - Main endpoint extension calls

### **Frontend Components (2 files)**

4. **labs-labId-page-sync.tsx**
   - Timestamp-aware lab page
   - Multi-section support
   - Video context display

5. **LabRunner-sync.tsx**
   - Enhanced lab interface
   - Section progress tracking
   - "Continue Video" button
   - Video context banner

### **Chrome Extension (2 files)**

6. **content-youtube-sync.js**
   - Video playback monitoring
   - Practice point notifications
   - Timestamp-based lab opening
   - Picture-in-Picture support

7. **overlay-sync.css**
   - Beautiful notification UI
   - Enhanced overlay design
   - Animated practice cards
   - Responsive layout

### **Documentation & Deployment (2 files)**

8. **VIDEO_SYNC_DEPLOYMENT_GUIDE.md**
   - Complete deployment instructions
   - Testing checklist
   - Troubleshooting guide
   - Success metrics

9. **deploy-video-sync.sh**
   - Automated deployment script
   - Backups existing files
   - Installs dependencies
   - Tests locally before deploy

---

## üéØ The User Experience

### Before (What we had):
```
1. User watches YouTube video
2. Extension shows generic labs
3. User might open a lab... or not
4. Lab is disconnected from video
```

### After (What we built):
```
1. User watches YouTube video
2. Extension analyzes video in background
3. At 5:23, notification pops up: "Ready to practice!"
4. User clicks "Start Lab"
5. Lab opens with EXACT code from that timestamp
6. User practices immediately
7. Clicks "Continue Video" ‚Üí Resumes at 5:53
8. Seamless learning experience! üéâ
```

---

## üìä Technical Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  YouTube Video      ‚îÇ
‚îÇ  Playing at 5:23    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Chrome Extension   ‚îÇ
‚îÇ  - Monitors video   ‚îÇ
‚îÇ  - Loads practice   ‚îÇ
‚îÇ    points from API  ‚îÇ
‚îÇ  - Shows at 5:23    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Practice Point API ‚îÇ
‚îÇ  GET /api/practice- ‚îÇ
‚îÇ       points/xyz    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> Transcript API
           ‚îÇ       (YouTube data)
           ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> AI Analysis
                   (Claude identifies
                    practice moments)
           
           v
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Lab Page           ‚îÇ
‚îÇ  ?timestamp=323     ‚îÇ
‚îÇ  - Section 2 of 5   ‚îÇ
‚îÇ  - Code from video  ‚îÇ
‚îÇ  - Progress bar     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ Deployment Steps (Quick Reference)

### 1. Download All Files (Above ‚¨ÜÔ∏è)

### 2. Run Deployment Script

```bash
cd ~/Code/work/star-edtech/watsonx-learning-platform

# Make script executable
chmod +x ~/Downloads/deploy-video-sync.sh

# Run it!
~/Downloads/deploy-video-sync.sh
```

The script will:
- ‚úÖ Create backups of existing files
- ‚úÖ Copy all new files to correct locations
- ‚úÖ Install npm dependencies
- ‚úÖ Check environment variables
- ‚úÖ Start local dev server for testing

### 3. Add Environment Variables

Create/update `.env.local`:

```bash
# Get Anthropic API key from: https://console.anthropic.com/
ANTHROPIC_API_KEY=sk-ant-...

# Your deployed platform URL
NEXT_PUBLIC_API_URL=https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud
```

### 4. Test Locally

```bash
npm run dev

# Visit http://localhost:3000
# Test /api/practice-points/iOdFUJiB0Zc
```

### 5. Deploy to Production

```bash
# Build
docker build --platform linux/amd64 -f Dockerfile.prod -t genai-learning-platform:latest .

# Tag
docker tag genai-learning-platform:latest icr.io/ranga/genai-learning-platform:latest

# Push
docker push icr.io/ranga/genai-learning-platform:latest

# Deploy
ibmcloud ce project select -n genai-learning-platform
ibmcloud ce app update \
  --name genai-learning-platform \
  --image icr.io/ranga/genai-learning-platform:latest \
  --env ANTHROPIC_API_KEY="your-key" \
  --env NEXT_PUBLIC_API_URL="https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud"
```

### 6. Update Chrome Extension

```bash
# Extension files already updated by script
# Just reload in Chrome:
# 1. Go to chrome://extensions
# 2. Find "GenAI Labs"
# 3. Click "Reload"
```

---

## üß™ Testing the Feature

### Test 1: Video Analysis

```bash
# Test transcript extraction
curl -X POST http://localhost:3000/api/extract-transcript \
  -H 'Content-Type: application/json' \
  -d '{"videoId": "iOdFUJiB0Zc"}'

# Should return transcript with timestamps
```

### Test 2: Practice Points

```bash
# Test practice point generation
curl http://localhost:3000/api/practice-points/iOdFUJiB0Zc

# Should return:
# {
#   "videoId": "iOdFUJiB0Zc",
#   "title": "Getting Started with AWS Bedrock",
#   "practicePoints": [
#     {
#       "timestamp": 323,
#       "topic": "Making your first API call",
#       ...
#     }
#   ]
# }
```

### Test 3: Extension

1. Go to: https://www.youtube.com/watch?v=iOdFUJiB0Zc
2. Overlay should appear: "3 practice opportunities"
3. Play video
4. At ~5:23, notification should pop up
5. Click "Start Lab"
6. Lab should open with timestamp context

### Test 4: Lab Page

Visit:
```
http://localhost:3000/labs/your-first-bedrock-api-call?videoId=iOdFUJiB0Zc&timestamp=323
```

Should show:
- ‚úÖ "From video" banner
- ‚úÖ Section progress (Section X of Y)
- ‚úÖ "Continue Video" button
- ‚úÖ Code matching that timestamp

---

## üìà Success Metrics to Track

After deployment, measure:

**Engagement:**
- How many users click "Start Lab" from notifications
- Average time from notification to lab start
- Completion rate per section

**Performance:**
- API response times (should be <2s)
- Cache hit rate (should be >80%)
- Extension load time

**Learning:**
- Users who complete labs from video vs. standalone
- Time spent per section
- Error rates in code submissions

---

## üé¨ Demo Script (for Investors/Users)

**The 60-Second Pitch:**

> "Watch this. I'm watching an AWS Bedrock tutorial on YouTube.
> 
> *[Video plays to 5:23]*
> 
> See that? A notification just appeared saying 'Ready to practice!'
> 
> *[Click Start Lab]*
> 
> The lab opens instantly with the EXACT code the instructor just showed.
> I can practice immediately without losing context.
> 
> *[Write code, click Run]*
> 
> Real output! Now I click 'Continue Video' and I'm right back where I left off.
> 
> That's GenAI Labs. Learn by doing, at the perfect moment."

---

## üêõ Known Limitations & Future Work

### Current Limitations:

1. **YouTube API Restrictions**
   - YouTube may rate-limit transcript requests
   - Some videos don't have transcripts
   - **Solution:** Pre-cache popular videos

2. **AI Analysis Cost**
   - Claude API calls cost money
   - ~$0.01 per video analysis
   - **Solution:** Cache aggressively (already implemented)

3. **Practice Point Accuracy**
   - AI might miss some good moments
   - Might suggest labs at wrong timestamps
   - **Solution:** Manual curation for popular videos

### Future Enhancements:

1. **Week 3: Bi-Directional Sync**
   - Lab completion triggers video resume
   - Video pause suggests lab

2. **Week 4: Multi-Platform**
   - Udemy integration
   - Coursera integration
   - Custom video uploads

3. **Week 5: Social Features**
   - See peers on same section
   - Share code snippets
   - Ask AI tutor for help

---

## üí∞ Cost Analysis

**New Costs:**

- **Anthropic API:** ~$0.01 per video analysis
  - With caching: ~$10/month for 1000 videos
  - First 1000 videos analyzed: $10 total
  
- **Everything else:** Still FREE! (IBM Cloud free tier)

**Total:** ~$10/month (still incredibly cheap!)

---

## üèÜ What Makes This Special

### Competitors:

- **Codecademy:** Labs, but no video sync
- **YouTube:** Videos, but no practice
- **Coursera:** Both, but locked to their platform
- **Replit:** Code execution, but no video

### GenAI Labs:

- ‚úÖ Works on ANY YouTube video
- ‚úÖ Syncs video + lab in real-time
- ‚úÖ AI-powered practice detection
- ‚úÖ Seamless transitions
- ‚úÖ Free to use
- ‚úÖ Chrome extension (no account needed)

**This is the killer feature that makes us unique!** üöÄ

---

## üìû Support

### If Something Breaks:

1. Check deployment guide troubleshooting section
2. Review browser console for errors
3. Test each API endpoint individually
4. Verify environment variables are set

### Common Issues:

**Issue:** "youtube-transcript fails"
**Fix:** Use static practice points as fallback

**Issue:** "Notifications don't appear"
**Fix:** Check video element exists, verify practicePoints loaded

**Issue:** "API returns 500"
**Fix:** Check Anthropic API key is set, verify .env.local

---

## üéâ You're Ready to Launch!

You now have:

- ‚úÖ Complete video-lab sync feature
- ‚úÖ All code files ready to deploy
- ‚úÖ Automated deployment script
- ‚úÖ Comprehensive documentation
- ‚úÖ Testing checklist
- ‚úÖ Demo script

**Next steps:**

1. Download all 9 files
2. Run `deploy-video-sync.sh`
3. Test locally
4. Deploy to production
5. Update Chrome extension
6. Launch on Product Hunt!

---

**You've built something AMAZING!** üöÄ

The "aha moment" feature that makes GenAI Labs go from "useful" to "must-have."

**Good luck with the launch!** üéä
</file>

<file path="app/api/execute/route.ts">
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    const { code } = await req.json();
    
    // YOUR UNIQUE LIVE IBM URL
    const IBM_EXECUTOR_URL = "https://executor-app.24rtt3srkwax.us-south.codeengine.appdomain.cloud/execute";

    console.log("üöÄ Bridge: Forwarding code to IBM Cloud...");

    const response = await fetch(IBM_EXECUTOR_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code, timeout: 30 })
    });

    const result = await response.json();
    return NextResponse.json(result);
  } catch (error) {
    console.error("‚ùå Bridge Error:", error);
    return NextResponse.json({ status: 'error', error: 'Could not reach IBM' }, { status: 500 });
  }
}
</file>

<file path="app/labs/[labId]/page.tsx">
/**
 * Timestamp-Aware Lab Page
 * 
 * This component loads lab content based on video timestamp,
 * allowing seamless video-to-lab transitions.
 * 
 * URL: /labs/[labId]?videoId=xyz&timestamp=323&topic=...
 */

import LabRunner from '@/components/LabRunner';
import { notFound } from 'next/navigation';

// Lab content database (in production, load from API/database)
const LABS_DATABASE = {
  'your-first-bedrock-api-call': {
    id: 'your-first-bedrock-api-call',
    title: 'Your First Bedrock API Call',
    difficulty: 'beginner',
    platform: 'bedrock',
    
    // Multiple sections based on timestamps
    sections: [
      {
        timeRange: [0, 400],
        title: 'Section 1: Initialize Bedrock Client',
        description: `Learn how to set up your AWS Bedrock client and prepare for your first API call.
        
**What you'll do:**
- Import the boto3 library
- Initialize the Bedrock runtime client
- Understand the basic setup

**Success criteria:**
- Client initialization completes without errors
- You understand the role of boto3`,
        starterCode: `import boto3

# Step 1: Initialize Bedrock client
# TODO: Create a bedrock-runtime client for the us-east-1 region
bedrock = None

print("‚úÖ Bedrock client initialized!")
print(f"Client type: {type(bedrock)}")
`
      },
      {
        timeRange: [400, 600],
        title: 'Section 2: Make Your First API Call',
        description: `Now that your client is set up, make your first call to a foundation model.
        
**What you'll do:**
- Define the model ID
- Create a request body with a prompt
- Call invoke_model()
- Handle the response

**Success criteria:**
- API call completes successfully
- You receive a response from the model`,
        starterCode: `import boto3
import json

# Client is already set up
bedrock = boto3.client('bedrock-runtime', region_name='us-east-1')

# Step 2: Define model and create request
# TODO: Set the model ID to "anthropic.claude-3-sonnet-20240229-v1:0"
model_id = "___"

# TODO: Create a prompt asking "What is Amazon Bedrock?"
prompt = "___"

# TODO: Create the request body
request_body = json.dumps({
    "anthropic_version": "bedrock-2023-05-31",
    "max_tokens": 1000,
    "messages": [
        {"role": "user", "content": prompt}
    ]
})

# TODO: Call the model
response = bedrock.invoke_model(
    modelId=model_id,
    body=request_body
)

print("‚úÖ API call successful!")
print(f"Response: {response}")
`
      },
      {
        timeRange: [600, 900],
        title: 'Section 3: Parse and Display Response',
        description: `The final step is parsing the JSON response and displaying the generated text.
        
**What you'll do:**
- Read the response body
- Parse the JSON
- Extract the generated text
- Display it nicely

**Success criteria:**
- Response is correctly parsed
- Generated text is displayed
- You understand the response structure`,
        starterCode: `import boto3
import json

# Previous code...
bedrock = boto3.client('bedrock-runtime', region_name='us-east-1')
model_id = "anthropic.claude-3-sonnet-20240229-v1:0"
prompt = "What is Amazon Bedrock?"

request_body = json.dumps({
    "anthropic_version": "bedrock-2023-05-31",
    "max_tokens": 1000,
    "messages": [{"role": "user", "content": prompt}]
})

response = bedrock.invoke_model(modelId=model_id, body=request_body)

# Step 3: Parse the response
# TODO: Read the response body
response_body = json.loads(response['body'].read())

# TODO: Extract the generated text
# Hint: response_body['content'][0]['text']
generated_text = "___"

print("ü§ñ AI Response:")
print(generated_text)
`
      }
    ]
  },
  
  'watsonx-first-call': {
    id: 'watsonx-first-call',
    title: 'Your First watsonx.ai API Call',
    difficulty: 'beginner',
    platform: 'watsonx',
    
    sections: [
      {
        timeRange: [0, 999999], // Single section for now
        title: 'Make Your First watsonx.ai Call',
        description: `Learn how to use IBM watsonx.ai foundation models.
        
**What you'll do:**
- Import the watsonx.ai SDK
- Initialize a model
- Generate text with AI
- Understand the response

**Success criteria:**
- Model initializes successfully
- You receive real AI-generated text`,
        starterCode: `import os
from ibm_watsonx_ai.foundation_models import Model

# Credentials are provided automatically
api_key = os.environ.get('WATSONX_API_KEY')
project_id = os.environ.get('WATSONX_PROJECT_ID')
url = os.environ.get('WATSONX_URL')

# Step 1: Initialize the model
# TODO: Use model_id="ibm/granite-3-8b-instruct"
model = Model(
    model_id="___",
    credentials={"apikey": api_key, "url": url},
    project_id=project_id
)

print("‚úÖ Model initialized!")

# Step 2: Generate text
# TODO: Write a prompt asking about AI
prompt = "___"

response = model.generate_text(prompt=prompt)

print(f"\\nü§ñ AI Response:\\n{response}")
`
      }
    ]
  }
};

interface PageProps {
  params: {
    labId: string;
  };
  searchParams: {
    videoId?: string;
    timestamp?: string;
    topic?: string;
  };
}

export default function LabPage({ params, searchParams }: PageProps) {
  const { labId } = params;
  const { videoId, timestamp, topic } = searchParams;

  // Get lab from database
  const labTemplate = LABS_DATABASE[labId as keyof typeof LABS_DATABASE];
  
  if (!labTemplate) {
    notFound();
  }

  // Determine which section to show based on timestamp
  const currentTimestamp = timestamp ? parseInt(timestamp) : 0;
  const section = getAppropriateSection(labTemplate.sections, currentTimestamp);

  // Build lab data for LabRunner
  const labData = {
    id: labTemplate.id,
    title: section.title,
    fullTitle: labTemplate.title,
    difficulty: labTemplate.difficulty,
    platform: labTemplate.platform,
    description: section.description,
    starterCode: section.starterCode,
    videoId: videoId || null,
    timestamp: currentTimestamp,
    topic: topic || null,
    sectionNumber: labTemplate.sections.indexOf(section) + 1,
    totalSections: labTemplate.sections.length
  };

  return <LabRunner labData={labData} />;
}

/**
 * Get the appropriate lab section based on video timestamp
 */
function getAppropriateSection(sections: any[], timestamp: number) {
  // Find section whose time range includes the timestamp
  const matchingSection = sections.find(section => {
    const [start, end] = section.timeRange;
    return timestamp >= start && timestamp < end;
  });

  // Default to first section if no match
  return matchingSection || sections[0];
}

/**
 * Generate static paths for common labs
 */
export async function generateStaticParams() {
  return Object.keys(LABS_DATABASE).map(labId => ({
    labId
  }));
}
</file>

<file path="app/labs/watsonx-first-call/page.tsx">
import LabRunner from '@/components/LabRunner'

const labData = {
  id: 'watsonx-first-call',
  title: 'Your First watsonx.ai API Call',
  difficulty: 'beginner',
  platform: 'watsonx' as const,
  description: `
Welcome to your first hands-on lab with IBM watsonx.ai!

In this lab, you'll learn how to:
1. Import the watsonx.ai SDK
2. Initialize a foundation model (IBM Granite)
3. Make your first text generation API call
4. Understand the response structure

**Steps:**
1. Complete the TODO sections in the code
2. Click "Run Code" to execute
3. Check the output matches expected results

**Success Criteria:**
- Model initialization successful
- API call returns generated text
- No errors in output

**Resources:**
- API Key and Project ID are provided below
- watsonx.ai documentation: https://ibm.com/docs/watsonx
`,
  starterCode: `from ibm_watsonx_ai.foundation_models import Model

# Step 1: Setup your credentials
# These are provided in the Lab Resources panel
api_key = "YOUR_API_KEY_HERE"
project_id = "lab-watsonx-first-call"

# Step 2: Initialize the model
# TODO: Complete the model initialization
model = Model(
    model_id="___",  # Hint: Use "ibm/granite-13b-chat-v2"
    credentials={
        "apikey": api_key,
        "url": "https://us-south.ml.cloud.ibm.com"
    },
    project_id=project_id
)

# Step 3: Create your first prompt
# TODO: Write a prompt asking "What is artificial intelligence?"
prompt = "___"

# Step 4: Generate text
# TODO: Call the generate_text method
response = model.___(___)

# Step 5: Print the result
print("AI Response:", response)
`,
}

export default function WatsonxFirstCallLab() {
  return <LabRunner labData={labData} />
}
</file>

<file path="app/labs/page.tsx">
import Link from 'next/link'
import { Clock, Award, Code2, Filter } from 'lucide-react'

const labs = [
  {
    id: 'watsonx-first-call',
    title: 'Your First watsonx.ai API Call',
    platform: 'watsonx',
    difficulty: 'beginner',
    duration: '15 min',
    description: 'Learn the basics of calling IBM watsonx.ai foundation models with a simple text generation example.',
    tier: 'free',
    completed: false,
  },
  {
    id: 'watsonx-parameters',
    title: 'Understanding Model Parameters',
    platform: 'watsonx',
    difficulty: 'beginner',
    duration: '20 min',
    description: 'Explore temperature, max_tokens, and other parameters that control model behavior.',
    tier: 'free',
    completed: false,
  },
  {
    id: 'watsonx-chatbot',
    title: 'Build a Simple Chatbot',
    platform: 'watsonx',
    difficulty: 'intermediate',
    duration: '30 min',
    description: 'Create a multi-turn conversational agent using IBM Granite models.',
    tier: 'standard',
    completed: false,
  },
  {
    id: 'bedrock-first-call',
    title: 'Your First AWS Bedrock API Call',
    platform: 'bedrock',
    difficulty: 'beginner',
    duration: '15 min',
    description: 'Learn how to call AWS Bedrock foundation models and compare with watsonx.ai.',
    tier: 'standard',
    completed: false,
  },
  {
    id: 'watsonx-rag',
    title: 'RAG Implementation with watsonx.ai',
    platform: 'watsonx',
    difficulty: 'advanced',
    duration: '45 min',
    description: 'Build a Retrieval-Augmented Generation pipeline with Watson Discovery.',
    tier: 'pro',
    completed: false,
  },
  {
    id: 'bedrock-rag',
    title: 'RAG Implementation with Bedrock',
    platform: 'bedrock',
    difficulty: 'advanced',
    duration: '45 min',
    description: 'Build a RAG pipeline using AWS Bedrock Knowledge Bases and S3.',
    tier: 'pro',
    completed: false,
  },
]

export default function LabsPage() {
  return (
    <div className="min-h-screen bg-gray-50 py-12">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="mb-12">
          <h1 className="text-4xl font-bold text-gray-900 mb-4">
            Hands-On Labs
          </h1>
          <p className="text-xl text-gray-600">
            Learn by doing with interactive coding environments. Choose from IBM watsonx.ai or AWS Bedrock labs.
          </p>
        </div>

        {/* Filters */}
        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <Filter className="w-5 h-5 text-gray-500" />
              <div className="flex space-x-2">
                <button className="px-4 py-2 bg-ibm-blue text-white rounded-lg text-sm font-medium">
                  All
                </button>
                <button className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200">
                  watsonx.ai
                </button>
                <button className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200">
                  AWS Bedrock
                </button>
              </div>
            </div>
            <div className="flex space-x-2">
              <button className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200">
                Beginner
              </button>
              <button className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200">
                Intermediate
              </button>
              <button className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200">
                Advanced
              </button>
            </div>
          </div>
        </div>

        {/* Labs Grid */}
        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {labs.map((lab) => (
            <Link
              key={lab.id}
              href={`/labs/${lab.id}`}
              className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition group"
            >
              {/* Lab Card Header */}
              <div className={`h-2 ${
                lab.platform === 'watsonx' ? 'bg-ibm-blue' : 'bg-orange-500'
              }`}></div>
              
              <div className="p-6">
                {/* Badges */}
                <div className="flex items-center justify-between mb-4">
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    lab.difficulty === 'beginner' ? 'bg-green-100 text-green-800' :
                    lab.difficulty === 'intermediate' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-red-100 text-red-800'
                  }`}>
                    {lab.difficulty.charAt(0).toUpperCase() + lab.difficulty.slice(1)}
                  </span>
                  {lab.tier === 'free' ? (
                    <span className="px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      Free
                    </span>
                  ) : lab.tier === 'standard' ? (
                    <span className="px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                      Standard
                    </span>
                  ) : (
                    <span className="px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                      Pro
                    </span>
                  )}
                </div>

                {/* Title */}
                <h3 className="text-xl font-bold text-gray-900 mb-2 group-hover:text-ibm-blue transition">
                  {lab.title}
                </h3>

                {/* Description */}
                <p className="text-gray-600 text-sm mb-4 line-clamp-2">
                  {lab.description}
                </p>

                {/* Meta Info */}
                <div className="flex items-center justify-between text-sm text-gray-500">
                  <div className="flex items-center space-x-4">
                    <div className="flex items-center space-x-1">
                      <Clock className="w-4 h-4" />
                      <span>{lab.duration}</span>
                    </div>
                    <div className="flex items-center space-x-1">
                      <Code2 className="w-4 h-4" />
                      <span>{lab.platform === 'watsonx' ? 'watsonx.ai' : 'Bedrock'}</span>
                    </div>
                  </div>
                  {lab.completed && (
                    <div className="flex items-center space-x-1 text-green-600">
                      <Award className="w-4 h-4" />
                      <span className="text-xs font-medium">Completed</span>
                    </div>
                  )}
                </div>
              </div>

              {/* Start Button */}
              <div className="px-6 pb-6">
                <button className="w-full bg-gray-50 text-gray-900 py-2 rounded-lg font-medium hover:bg-gray-100 transition group-hover:bg-ibm-blue group-hover:text-white">
                  {lab.completed ? 'Review Lab' : 'Start Lab'}
                </button>
              </div>
            </Link>
          ))}
        </div>

        {/* CTA Section */}
        <div className="mt-16 bg-gradient-to-r from-ibm-blue to-ibm-purple rounded-2xl p-8 text-center">
          <h2 className="text-3xl font-bold text-white mb-4">
            Want Access to All Labs?
          </h2>
          <p className="text-lg text-blue-100 mb-6">
            Upgrade to Standard or Pro to unlock advanced labs and certification prep.
          </p>
          <Link
            href="/pricing"
            className="inline-block bg-white text-ibm-blue px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition"
          >
            View Pricing
          </Link>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/pricing/page.tsx">
import Link from 'next/link'
import { Check, Zap, Star, Building } from 'lucide-react'

const tiers = [
  {
    name: 'Free',
    price: '$0',
    period: 'forever',
    description: 'Perfect for getting started with GenAI',
    icon: Zap,
    color: 'gray',
    cta: 'Start Free',
    href: '/signup',
    features: [
      'IBM watsonx.ai labs (3 labs)',
      'Knowledge articles',
      'Community Discord access',
      'Basic quizzes',
      'Learn at your own pace',
    ],
  },
  {
    name: 'Standard',
    price: '$29',
    period: 'per month',
    description: 'Full access to certification prep',
    icon: Star,
    color: 'blue',
    popular: true,
    cta: 'Start Standard',
    href: '/signup?tier=standard',
    features: [
      'Everything in Free',
      '15 watsonx.ai labs',
      '10 AWS Bedrock labs',
      'Skill assessments',
      'Certification prep (AWS AIF-C01)',
      'Progress tracking',
      'Lab completion certificates',
    ],
  },
  {
    name: 'Pro',
    price: '$79',
    period: 'per month',
    description: 'Advanced labs and AI assistance',
    icon: Star,
    color: 'purple',
    cta: 'Start Pro',
    href: '/signup?tier=pro',
    features: [
      'Everything in Standard',
      'All 50+ hands-on labs',
      'Advanced challenge labs',
      'Mock examinations (full-length)',
      'AI-assisted coding (real-time)',
      'Unlimited AWS sandbox access',
      'Priority support',
      '1 user license transfer/year',
    ],
  },
  {
    name: 'Business',
    price: '$299',
    period: 'per seat/year',
    description: 'For teams and enterprises',
    icon: Building,
    color: 'indigo',
    cta: 'Contact Sales',
    href: '/contact',
    features: [
      'Everything in Pro',
      'Enterprise dashboard',
      'Team progress reporting',
      'Centralized billing',
      'SSO integration',
      'Custom learning paths',
      'Dedicated account support',
      'Guided team onboarding',
      'Exclusive enterprise resources',
    ],
  },
]

export default function PricingPage() {
  return (
    <div className="min-h-screen bg-gray-50 py-12">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {/* Header */}
        <div className="text-center mb-16">
          <h1 className="text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
            Choose Your Learning Path
          </h1>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Start free and upgrade as you grow. All plans include hands-on labs with instant validation.
          </p>
        </div>

        {/* Pricing Cards */}
        <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mb-16">
          {tiers.map((tier) => {
            const Icon = tier.icon
            return (
              <div
                key={tier.name}
                className={`bg-white rounded-2xl shadow-sm border-2 ${
                  tier.popular ? 'border-ibm-blue' : 'border-gray-200'
                } overflow-hidden relative`}
              >
                {tier.popular && (
                  <div className="bg-ibm-blue text-white text-center py-2 text-sm font-semibold">
                    Most Popular
                  </div>
                )}

                <div className="p-6">
                  {/* Icon */}
                  <div className={`w-12 h-12 rounded-lg flex items-center justify-center mb-4 ${
                    tier.color === 'blue' ? 'bg-blue-100' :
                    tier.color === 'purple' ? 'bg-purple-100' :
                    tier.color === 'indigo' ? 'bg-indigo-100' :
                    'bg-gray-100'
                  }`}>
                    <Icon className={`w-6 h-6 ${
                      tier.color === 'blue' ? 'text-ibm-blue' :
                      tier.color === 'purple' ? 'text-ibm-purple' :
                      tier.color === 'indigo' ? 'text-indigo-600' :
                      'text-gray-600'
                    }`} />
                  </div>

                  {/* Name & Price */}
                  <h3 className="text-2xl font-bold text-gray-900 mb-2">
                    {tier.name}
                  </h3>
                  <div className="mb-4">
                    <span className="text-4xl font-bold text-gray-900">{tier.price}</span>
                    <span className="text-gray-600 ml-2">{tier.period}</span>
                  </div>
                  <p className="text-gray-600 mb-6">
                    {tier.description}
                  </p>

                  {/* CTA Button */}
                  <Link
                    href={tier.href}
                    className={`block w-full text-center py-3 rounded-lg font-semibold transition mb-6 ${
                      tier.popular
                        ? 'bg-ibm-blue text-white hover:bg-ibm-blue-dark'
                        : 'bg-gray-100 text-gray-900 hover:bg-gray-200'
                    }`}
                  >
                    {tier.cta}
                  </Link>

                  {/* Features */}
                  <ul className="space-y-3">
                    {tier.features.map((feature, idx) => (
                      <li key={idx} className="flex items-start space-x-3">
                        <Check className="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" />
                        <span className="text-sm text-gray-700">{feature}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            )
          })}
        </div>

        {/* Feature Comparison Table */}
        <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden mb-16">
          <div className="px-6 py-4 bg-gray-50 border-b border-gray-200">
            <h2 className="text-2xl font-bold text-gray-900">
              Detailed Feature Comparison
            </h2>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="bg-gray-50 border-b border-gray-200">
                  <th className="px-6 py-3 text-left text-sm font-semibold text-gray-900">
                    Feature
                  </th>
                  <th className="px-6 py-3 text-center text-sm font-semibold text-gray-900">
                    Free
                  </th>
                  <th className="px-6 py-3 text-center text-sm font-semibold text-gray-900">
                    Standard
                  </th>
                  <th className="px-6 py-3 text-center text-sm font-semibold text-gray-900">
                    Pro
                  </th>
                  <th className="px-6 py-3 text-center text-sm font-semibold text-gray-900">
                    Business
                  </th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                <tr>
                  <td className="px-6 py-4 text-sm text-gray-700">
                    IBM watsonx.ai Labs
                  </td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">3</td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">15</td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">50+</td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">50+</td>
                </tr>
                <tr>
                  <td className="px-6 py-4 text-sm text-gray-700">
                    AWS Bedrock Labs
                  </td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">-</td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">10</td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">20+</td>
                  <td className="px-6 py-4 text-center text-sm text-gray-700">20+</td>
                </tr>
                <tr>
                  <td className="px-6 py-4 text-sm text-gray-700">
                    Mock Examinations
                  </td>
                  <td className="px-6 py-4 text-center">
                    <span className="text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-4 text-center">
                    <Check className="w-5 h-5 text-green-500 mx-auto" />
                  </td>
                  <td className="px-6 py-4 text-center">
                    <Check className="w-5 h-5 text-green-500 mx-auto" />
                  </td>
                  <td className="px-6 py-4 text-center">
                    <Check className="w-5 h-5 text-green-500 mx-auto" />
                  </td>
                </tr>
                <tr>
                  <td className="px-6 py-4 text-sm text-gray-700">
                    AI Tutor Assistance
                  </td>
                  <td className="px-6 py-4 text-center">
                    <span className="text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-4 text-center">
                    <span className="text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-4 text-center">
                    <Check className="w-5 h-5 text-green-500 mx-auto" />
                  </td>
                  <td className="px-6 py-4 text-center">
                    <Check className="w-5 h-5 text-green-500 mx-auto" />
                  </td>
                </tr>
                <tr>
                  <td className="px-6 py-4 text-sm text-gray-700">
                    Team Dashboard
                  </td>
                  <td className="px-6 py-4 text-center">
                    <span className="text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-4 text-center">
                    <span className="text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-4 text-center">
                    <span className="text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-4 text-center">
                    <Check className="w-5 h-5 text-green-500 mx-auto" />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        {/* FAQ Section */}
        <div className="max-w-3xl mx-auto">
          <h2 className="text-3xl font-bold text-gray-900 text-center mb-12">
            Frequently Asked Questions
          </h2>
          <div className="space-y-6">
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Can I switch plans anytime?
              </h3>
              <p className="text-gray-600">
                Yes! You can upgrade or downgrade your plan at any time. Changes take effect immediately.
              </p>
            </div>
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Do you offer student discounts?
              </h3>
              <p className="text-gray-600">
                Yes, we offer 50% off Standard and Pro plans for verified students. Contact us for details.
              </p>
            </div>
            <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                What's included in the Free tier?
              </h3>
              <p className="text-gray-600">
                The Free tier includes 3 hands-on labs with IBM watsonx.ai, knowledge articles, and community access. 
                No credit card required.
              </p>
            </div>
          </div>
        </div>

        {/* CTA Section */}
        <div className="mt-20 bg-gradient-to-r from-ibm-blue to-ibm-purple rounded-2xl p-12 text-center">
          <h2 className="text-3xl font-bold text-white mb-4">
            Ready to Start Learning?
          </h2>
          <p className="text-lg text-blue-100 mb-8 max-w-2xl mx-auto">
            Join thousands of developers mastering GenAI. Start with free labs today, no credit card required.
          </p>
          <Link
            href="/signup"
            className="inline-block bg-white text-ibm-blue px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition"
          >
            Create Free Account
          </Link>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --foreground-rgb: 0, 0, 0;
  --background-start-rgb: 255, 255, 255;
  --background-end-rgb: 255, 255, 255;
}

@media (prefers-color-scheme: dark) {
  :root {
    --foreground-rgb: 255, 255, 255;
    --background-start-rgb: 10, 10, 10;
    --background-end-rgb: 10, 10, 10;
  }
}

body {
  color: rgb(var(--foreground-rgb));
  background: linear-gradient(
      to bottom,
      transparent,
      rgb(var(--background-end-rgb))
    )
    rgb(var(--background-start-rgb));
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* Lab editor styles */
.lab-editor {
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  overflow: hidden;
}

/* Code output terminal */
.terminal-output {
  font-family: 'Courier New', monospace;
  background: #1e1e1e;
  color: #d4d4d4;
  padding: 1rem;
  border-radius: 4px;
  overflow-x: auto;
}

/* Success/Error states */
.validation-success {
  background: #10b981;
  color: white;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  animation: slideUp 0.3s ease-out;
}

.validation-error {
  background: #ef4444;
  color: white;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  animation: slideUp 0.3s ease-out;
}

/* Loading spinner */
.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #3b82f6;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</file>

<file path="app/layout.tsx">
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import Navigation from "@/components/Navigation";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Multi-Cloud GenAI Academy | Learn IBM watsonx.ai & AWS Bedrock",
  description: "Master generative AI with hands-on labs. Learn IBM watsonx.ai and AWS Bedrock side-by-side with interactive coding environments.",
  keywords: ["IBM watsonx.ai", "AWS Bedrock", "GenAI", "AI training", "machine learning"],
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <Navigation />
        <main className="min-h-screen">
          {children}
        </main>
        <footer className="bg-gray-900 text-white py-12 mt-20">
          <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
              <div>
                <h3 className="text-xl font-bold mb-4">Multi-Cloud GenAI Academy</h3>
                <p className="text-gray-400">Learn GenAI concepts once, use them everywhere.</p>
              </div>
              <div>
                <h4 className="font-semibold mb-3">Platform</h4>
                <ul className="space-y-2 text-gray-400">
                  <li><a href="/labs" className="hover:text-white">Labs</a></li>
                  <li><a href="/learning-paths" className="hover:text-white">Learning Paths</a></li>
                  <li><a href="/pricing" className="hover:text-white">Pricing</a></li>
                </ul>
              </div>
              <div>
                <h4 className="font-semibold mb-3">Resources</h4>
                <ul className="space-y-2 text-gray-400">
                  <li><a href="/docs" className="hover:text-white">Documentation</a></li>
                  <li><a href="/blog" className="hover:text-white">Blog</a></li>
                  <li><a href="/community" className="hover:text-white">Community</a></li>
                </ul>
              </div>
              <div>
                <h4 className="font-semibold mb-3">Company</h4>
                <ul className="space-y-2 text-gray-400">
                  <li><a href="/about" className="hover:text-white">About</a></li>
                  <li><a href="/contact" className="hover:text-white">Contact</a></li>
                  <li><a href="/partners" className="hover:text-white">Partners</a></li>
                </ul>
              </div>
            </div>
            <div className="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
              <p>&copy; 2025 Multi-Cloud GenAI Academy. All rights reserved.</p>
              <p className="mt-2 text-sm">Powered by IBM watsonx.ai and AWS Bedrock</p>
            </div>
          </div>
        </footer>
      </body>
    </html>
  );
}
</file>

<file path="app/page.tsx">
import Link from 'next/link'
import { ArrowRight, Code, Zap, Trophy, Globe, CheckCircle, Users } from 'lucide-react'

export default function Home() {
  return (
    <div className="bg-white">
      {/* Hero Section */}
      <section className="relative overflow-hidden bg-gradient-to-br from-blue-50 via-white to-purple-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 lg:py-28">
          <div className="text-center max-w-4xl mx-auto">
            <div className="inline-flex items-center space-x-2 bg-ibm-blue/10 text-ibm-blue px-4 py-2 rounded-full text-sm font-medium mb-8">
              <Zap className="w-4 h-4" />
              <span>Learn by Doing, Not Just Watching</span>
            </div>
            
            <h1 className="text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
              Master GenAI with
              <span className="block mt-2 bg-gradient-to-r from-ibm-blue to-ibm-purple bg-clip-text text-transparent">
                Multi-Cloud Hands-On Labs
              </span>
            </h1>
            
            <p className="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
              Learn IBM watsonx.ai and AWS Bedrock side-by-side. Build real GenAI applications with 
              interactive coding environments, automated validation, and AI-powered tutoring.
            </p>
            
            <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
              <Link 
                href="/signup" 
                className="bg-ibm-blue text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-ibm-blue-dark transition flex items-center space-x-2 w-full sm:w-auto justify-center"
              >
                <span>Start Free Labs</span>
                <ArrowRight className="w-5 h-5" />
              </Link>
              <Link 
                href="/demo" 
                className="border-2 border-gray-300 text-gray-700 px-8 py-4 rounded-lg text-lg font-semibold hover:border-ibm-blue hover:text-ibm-blue transition w-full sm:w-auto text-center"
              >
                Watch Demo
              </Link>
            </div>

            <div className="mt-12 flex items-center justify-center space-x-8 text-sm text-gray-600">
              <div className="flex items-center space-x-2">
                <CheckCircle className="w-5 h-5 text-green-500" />
                <span>No setup required</span>
              </div>
              <div className="flex items-center space-x-2">
                <CheckCircle className="w-5 h-5 text-green-500" />
                <span>Instant validation</span>
              </div>
              <div className="flex items-center space-x-2">
                <CheckCircle className="w-5 h-5 text-green-500" />
                <span>AI tutor included</span>
              </div>
            </div>
          </div>
        </div>

        {/* Decorative elements */}
        <div className="absolute top-0 right-0 -mt-20 -mr-20 w-64 h-64 bg-ibm-blue/5 rounded-full blur-3xl"></div>
        <div className="absolute bottom-0 left-0 -mb-20 -ml-20 w-64 h-64 bg-ibm-purple/5 rounded-full blur-3xl"></div>
      </section>

      {/* Platform Comparison */}
      <section className="py-20 bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-16">
            <h2 className="text-4xl font-bold text-gray-900 mb-4">
              Why Multi-Cloud GenAI Training?
            </h2>
            <p className="text-xl text-gray-600 max-w-3xl mx-auto">
              Real-world developers work with multiple cloud providers. Learn once, deploy anywhere.
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-8">
            <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
              <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-6">
                <Code className="w-6 h-6 text-ibm-blue" />
              </div>
              <h3 className="text-2xl font-bold mb-4">Learn IBM watsonx.ai</h3>
              <p className="text-gray-600 mb-6">
                Master IBM's enterprise-grade GenAI platform with hands-on labs using Granite models, 
                Watson Studio, and AutoAI.
              </p>
              <ul className="space-y-3">
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Granite foundation models</span>
                </li>
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Enterprise AI workflows</span>
                </li>
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Regulated industry focus</span>
                </li>
              </ul>
            </div>

            <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
              <div className="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mb-6">
                <Globe className="w-6 h-6 text-orange-600" />
              </div>
              <h3 className="text-2xl font-bold mb-4">Compare AWS Bedrock</h3>
              <p className="text-gray-600 mb-6">
                See how the same concepts work on AWS. Understand platform differences and make 
                informed cloud decisions.
              </p>
              <ul className="space-y-3">
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Claude, Titan, and more</span>
                </li>
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Side-by-side code comparison</span>
                </li>
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Certification prep (AIF-C01)</span>
                </li>
              </ul>
            </div>

            <div className="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
              <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-6">
                <Trophy className="w-6 h-6 text-ibm-purple" />
              </div>
              <h3 className="text-2xl font-bold mb-4">Build Real Skills</h3>
              <p className="text-gray-600 mb-6">
                Go beyond tutorials with production-ready patterns, multi-cloud architectures, and 
                vendor-neutral expertise.
              </p>
              <ul className="space-y-3">
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Avoid vendor lock-in</span>
                </li>
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Enterprise-ready patterns</span>
                </li>
                <li className="flex items-start space-x-2">
                  <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                  <span className="text-gray-700">Dual certification paths</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      {/* How It Works */}
      <section className="py-20 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-16">
            <h2 className="text-4xl font-bold text-gray-900 mb-4">
              How It Works
            </h2>
            <p className="text-xl text-gray-600 max-w-3xl mx-auto">
              From zero to GenAI expert in three simple steps
            </p>
          </div>

          <div className="grid md:grid-cols-3 gap-12">
            <div className="text-center">
              <div className="w-16 h-16 bg-ibm-blue text-white rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-6">
                1
              </div>
              <h3 className="text-xl font-bold mb-3">Choose Your Lab</h3>
              <p className="text-gray-600">
                Pick from watsonx.ai or AWS Bedrock labs. Start with beginner-friendly tutorials 
                or jump to advanced challenges.
              </p>
            </div>

            <div className="text-center">
              <div className="w-16 h-16 bg-ibm-blue text-white rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-6">
                2
              </div>
              <h3 className="text-xl font-bold mb-3">Code in Browser</h3>
              <p className="text-gray-600">
                Write code in our interactive editor with syntax highlighting, autocomplete, 
                and real-time AI assistance.
              </p>
            </div>

            <div className="text-center">
              <div className="w-16 h-16 bg-ibm-blue text-white rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-6">
                3
              </div>
              <h3 className="text-xl font-bold mb-3">Get Instant Feedback</h3>
              <p className="text-gray-600">
                Run your code and see results immediately. Our automated validation confirms 
                you're on the right track.
              </p>
            </div>
          </div>

          <div className="mt-12 text-center">
            <Link 
              href="/labs" 
              className="inline-flex items-center space-x-2 bg-ibm-blue text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-ibm-blue-dark transition"
            >
              <span>Browse All Labs</span>
              <ArrowRight className="w-5 h-5" />
            </Link>
          </div>
        </div>
      </section>

      {/* Social Proof */}
      <section className="py-20 bg-gray-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="grid md:grid-cols-3 gap-8 text-center">
            <div>
              <div className="text-5xl font-bold text-ibm-blue mb-2">1,000+</div>
              <div className="text-gray-600">Active Learners</div>
            </div>
            <div>
              <div className="text-5xl font-bold text-ibm-blue mb-2">50+</div>
              <div className="text-gray-600">Hands-On Labs</div>
            </div>
            <div>
              <div className="text-5xl font-bold text-ibm-blue mb-2">95%</div>
              <div className="text-gray-600">Completion Rate</div>
            </div>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-20 bg-gradient-to-r from-ibm-blue to-ibm-purple">
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <h2 className="text-4xl font-bold text-white mb-6">
            Ready to Master Multi-Cloud GenAI?
          </h2>
          <p className="text-xl text-blue-100 mb-8">
            Join thousands of developers learning the future of AI. Start with free labs today.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <Link 
              href="/signup" 
              className="bg-white text-ibm-blue px-8 py-4 rounded-lg text-lg font-semibold hover:bg-gray-100 transition"
            >
              Create Free Account
            </Link>
            <Link 
              href="/pricing" 
              className="border-2 border-white text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-white/10 transition"
            >
              View Pricing
            </Link>
          </div>
        </div>
      </section>
    </div>
  )
}
</file>

<file path="code-executor/deploy-app.sh">
#!/bin/bash
set -e

echo "üöÄ Deploying Code Execution Backend to IBM Cloud (as App)"
echo "=========================================================="

# Configuration
PROJECT_NAME="genai-learning-platform"
EXECUTOR_IMAGE="code-executor"
REGISTRY="icr.io/ranga"

# Step 1: Build Docker image
echo ""
echo "üì¶ Step 1: Building Docker image..."
docker build --platform linux/amd64 -t ${EXECUTOR_IMAGE}:latest .

# Step 2: Tag for IBM Cloud Registry
echo ""
echo "üè∑Ô∏è  Step 2: Tagging image for IBM Cloud..."
docker tag ${EXECUTOR_IMAGE}:latest ${REGISTRY}/${EXECUTOR_IMAGE}:latest

# Step 3: Push to IBM Cloud Registry
echo ""
echo "‚òÅÔ∏è  Step 3: Pushing to IBM Cloud Registry..."
docker push ${REGISTRY}/${EXECUTOR_IMAGE}:latest

# Step 4: Create registry secret if it doesn't exist
echo ""
echo "üîê Step 4: Setting up registry access..."

# Check if secret exists
if ! ibmcloud ce secret get --name icr-secret &>/dev/null; then
    echo "   Creating registry secret..."
    echo "   NOTE: You'll need to create an IBM Cloud API key if you don't have one"
    
    # Try to get existing API key from environment or create new one
    if [ -z "$IBMCLOUD_API_KEY" ]; then
        echo "   Creating new API key..."
        API_KEY=$(ibmcloud iam api-key-create ce-registry-$(date +%s) -d "Code Engine registry access" --output json 2>/dev/null | grep '"apikey"' | cut -d'"' -f4)
    else
        API_KEY="$IBMCLOUD_API_KEY"
    fi
    
    ibmcloud ce secret create \
        --name icr-secret \
        --format registry \
        --server icr.io \
        --username iamapikey \
        --password "$API_KEY"
else
    echo "   Registry secret already exists ‚úì"
fi

# Step 5: Deploy to Code Engine as APP (not Job)
echo ""
echo "üö¢ Step 5: Deploying to IBM Cloud Code Engine (as App)..."

# Select project
ibmcloud ce project select -n ${PROJECT_NAME}

# Check if app exists
if ibmcloud ce app get --name code-executor &>/dev/null; then
    echo "   Updating existing app..."
    ibmcloud ce app update \
        --name code-executor \
        --image ${REGISTRY}/${EXECUTOR_IMAGE}:latest \
        --registry-secret icr-secret \
        --cpu 1 \
        --memory 2G \
        --min-scale 0 \
        --max-scale 5 \
        --port 8080
else
    echo "   Creating new app..."
    ibmcloud ce app create \
        --name code-executor \
        --image ${REGISTRY}/${EXECUTOR_IMAGE}:latest \
        --registry-secret icr-secret \
        --cpu 1 \
        --memory 2G \
        --min-scale 0 \
        --max-scale 5 \
        --port 8080
fi

# Step 6: Get the app URL
echo ""
echo "üåê Step 6: Getting app URL..."
APP_URL=$(ibmcloud ce app get --name code-executor --output json | grep -o '"url":"[^"]*' | cut -d'"' -f4)

echo ""
echo "‚úÖ Deployment complete!"
echo ""
echo "üìã App Details:"
echo "   Name: code-executor"
echo "   URL: ${APP_URL}"
echo ""
echo "üß™ Test the API:"
echo "   Health check:"
echo "   curl ${APP_URL}/health"
echo ""
echo "   Execute code:"
echo "   curl -X POST ${APP_URL}/execute \\"
echo "     -H 'Content-Type: application/json' \\"
echo "     -d '{\"code\": \"print(\\\"Hello from IBM Cloud!\\\")\", \"timeout\": 5}'"
echo ""
echo "üí° Usage from Next.js:"
echo "   Update API_ENDPOINT in your app to: ${APP_URL}"
echo ""
</file>

<file path="code-executor/deploy.sh">
#!/bin/bash
set -e

echo "üöÄ Deploying Code Execution Backend to IBM Cloud"
echo "================================================"

# Configuration
PROJECT_NAME="genai-learning-platform"
EXECUTOR_IMAGE="code-executor"
REGISTRY="icr.io/ranga"

# Step 1: Build Docker image
echo ""
echo "üì¶ Step 1: Building Docker image..."
docker build --platform linux/amd64 -t ${EXECUTOR_IMAGE}:latest .

# Step 2: Tag for IBM Cloud Registry
echo ""
echo "üè∑Ô∏è  Step 2: Tagging image for IBM Cloud..."
docker tag ${EXECUTOR_IMAGE}:latest ${REGISTRY}/${EXECUTOR_IMAGE}:latest

# Step 3: Push to IBM Cloud Registry
echo ""
echo "‚òÅÔ∏è  Step 3: Pushing to IBM Cloud Registry..."
docker push ${REGISTRY}/${EXECUTOR_IMAGE}:latest

# Step 4: Deploy to Code Engine
echo ""
echo "üö¢ Step 4: Deploying to IBM Cloud Code Engine..."

# Select project
ibmcloud ce project select -n ${PROJECT_NAME}

# Check if job exists
if ibmcloud ce job get --name code-executor &>/dev/null; then
    echo "   Updating existing job..."
    ibmcloud ce job update \
        --name code-executor \
        --image ${REGISTRY}/${EXECUTOR_IMAGE}:latest \
        --cpu 1 \
        --memory 2G \
        --maxexecutiontime 30 \
        --retrylimit 0
else
    echo "   Creating new job..."
    ibmcloud ce job create \
        --name code-executor \
        --image ${REGISTRY}/${EXECUTOR_IMAGE}:latest \
        --cpu 1 \
        --memory 2G \
        --maxexecutiontime 30 \
        --retrylimit 0
fi

# Step 5: Test the deployment
echo ""
echo "üß™ Step 5: Testing deployment..."
TEST_CODE='{"code": "print(\"Hello from Code Executor!\")", "timeout": 5}'

echo "   Submitting test job..."
JOB_RUN_NAME="test-$(date +%s)"
ibmcloud ce jobrun submit \
    --name ${JOB_RUN_NAME} \
    --job code-executor \
    --wait \
    --quiet

echo "   Checking logs..."
ibmcloud ce jobrun logs --name ${JOB_RUN_NAME}

echo ""
echo "‚úÖ Deployment complete!"
echo ""
echo "üìã Next steps:"
echo "   1. Update API route in Next.js app"
echo "   2. Test from frontend"
echo "   3. Monitor usage and costs"
echo ""
echo "üí° Usage:"
echo "   ibmcloud ce jobrun submit --name exec-test --job code-executor"
echo "   ibmcloud ce job get --name code-executor"
echo "   ibmcloud ce jobrun logs --name exec-test"
echo ""
</file>

<file path="code-executor/Dockerfile">
FROM python:3.11-slim

# Install common data science and AI packages
RUN pip install --no-cache-dir \
    boto3==1.34.* \
    requests==2.31.* \
    numpy==1.26.* \
    pandas==2.1.* \
    matplotlib==3.8.* \
    pillow==10.1.* \
    python-dotenv==1.0.* \
    openai==1.6.* \
    anthropic==0.8.* \
    ibm-watsonx-ai==1.0.* \
    ibm-watson-machine-learning==1.0.*

# Create execution directory
WORKDIR /code

# Copy execution scripts
COPY execute.py /code/
COPY server.py /code/
COPY requirements.txt /code/

# Set up non-root user for security
RUN useradd -m -u 1000 coderunner && \
    chown -R coderunner:coderunner /code

USER coderunner

# Expose port for HTTP server
EXPOSE 8080

# Run HTTP server (not batch script)
CMD ["python", "server.py", "8080"]
</file>

<file path="code-executor/execute.py">
#!/usr/bin/env python3
"""
Secure Python Code Executor
Runs user code in isolated environment with timeout and resource limits
"""

import sys
import io
import contextlib
import json
import traceback
import signal
import resource
from typing import Dict, Any
import time

class TimeoutException(Exception):
    """Raised when code execution times out"""
    pass

def timeout_handler(signum, frame):
    """Handle execution timeout"""
    raise TimeoutException("Code execution timed out")

def set_resource_limits():
    """Set resource limits to prevent abuse"""
    # Limit memory to 2GB (increased for watsonx.ai/pandas)
    resource.setrlimit(resource.RLIMIT_AS, (2 * 1024 * 1024 * 1024, 2 * 1024 * 1024 * 1024))
    
    # Limit CPU time to 30 seconds
    resource.setrlimit(resource.RLIMIT_CPU, (30, 30))
    
    # Limit number of processes (increased for numpy/pandas multi-threading)
    resource.setrlimit(resource.RLIMIT_NPROC, (50, 50))

def execute_code(code: str, timeout: int = 30) -> Dict[str, Any]:
    """
    Execute Python code and capture output/errors
    
    Args:
        code: Python code to execute
        timeout: Maximum execution time in seconds
    
    Returns:
        Dict with status, output, error, execution_time
    """
    stdout_capture = io.StringIO()
    stderr_capture = io.StringIO()
    
    result = {
        "status": "success",
        "output": "",
        "error": "",
        "execution_time": 0
    }
    
    start_time = time.time()
    
    try:
        # Set timeout alarm
        signal.signal(signal.SIGALRM, timeout_handler)
        signal.alarm(timeout)
        
        # Redirect stdout/stderr
        with contextlib.redirect_stdout(stdout_capture), \
             contextlib.redirect_stderr(stderr_capture):
            
            # Create restricted globals (security)
            # Allow most built-ins but block dangerous ones
            safe_builtins = {
                k: v for k, v in __builtins__.__dict__.items()
                if k not in ['open', 'eval', 'exec', 'compile']
            }
            
            # Create safe import function that allows specific modules
            original_import = __builtins__.__import__
            
            ALLOWED_MODULES = {
                'json', 'math', 'random', 'datetime', 'time', 'collections',
                'itertools', 'functools', 'operator', 're', 'string', 'os',
                'boto3', 'botocore', 'requests', 'numpy', 'pandas', 'matplotlib', 
                'pillow', 'typing', 'anthropic', 'openai',
                'ibm_watsonx_ai', 'ibm_watson_machine_learning'
            }
            
            def safe_import(name, *args, **kwargs):
                # Allow imports from allowed list
                base_module = name.split('.')[0]
                if base_module in ALLOWED_MODULES:
                    return original_import(name, *args, **kwargs)
                # Block dangerous modules
                raise ImportError(f"Import of '{name}' is not allowed for security reasons")
            
            safe_builtins['__import__'] = safe_import
            
            restricted_globals = {
                "__builtins__": safe_builtins,
                "__name__": "__main__",
                "__doc__": None,
            }
            
            # Execute code
            exec(code, restricted_globals)
        
        # Cancel alarm
        signal.alarm(0)
        
        # Capture output
        result["output"] = stdout_capture.getvalue()
        
        # Limit output size to 1MB
        if len(result["output"]) > 1024 * 1024:
            result["output"] = result["output"][:1024*1024] + "\n... (output truncated)"
        
    except TimeoutException:
        signal.alarm(0)
        result["status"] = "timeout"
        result["error"] = f"Execution exceeded {timeout} second timeout"
        result["output"] = stdout_capture.getvalue()
        
    except MemoryError:
        signal.alarm(0)
        result["status"] = "error"
        result["error"] = "MemoryError: Code exceeded 512MB memory limit"
        result["output"] = stdout_capture.getvalue()
        
    except Exception as e:
        signal.alarm(0)
        result["status"] = "error"
        result["error"] = traceback.format_exc()
        result["output"] = stdout_capture.getvalue()
    
    finally:
        result["execution_time"] = int((time.time() - start_time) * 1000)  # milliseconds
    
    return result

def main():
    """Main entry point - read from stdin and execute"""
    try:
        # Read input JSON
        input_data = json.loads(sys.stdin.read())
        code = input_data.get('code', '')
        timeout = input_data.get('timeout', 30)
        
        # Validate code length
        if len(code) > 100000:  # 100KB max
            print(json.dumps({
                "status": "error",
                "error": "Code exceeds maximum length of 100KB",
                "output": "",
                "execution_time": 0
            }))
            return
        
        # Set resource limits (Linux only)
        try:
            set_resource_limits()
        except:
            pass  # Skip on non-Linux systems
        
        # Execute code
        result = execute_code(code, timeout)
        
        # Output JSON result
        print(json.dumps(result))
        
    except json.JSONDecodeError:
        print(json.dumps({
            "status": "error",
            "error": "Invalid JSON input",
            "output": "",
            "execution_time": 0
        }))
    except Exception as e:
        print(json.dumps({
            "status": "error",
            "error": f"Executor error: {str(e)}",
            "output": "",
            "execution_time": 0
        }))

if __name__ == "__main__":
    main()
</file>

<file path="code-executor/README.md">
# Week 1: Code Execution Backend - README

## üéØ Goal
Build a secure, scalable code execution backend that runs Python code in isolated Docker containers.

---

## üìÇ File Structure

```
code-executor/
‚îú‚îÄ‚îÄ Dockerfile              # Docker image for code execution
‚îú‚îÄ‚îÄ execute.py              # Python script that runs user code
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ deploy.sh               # Deployment script for IBM Cloud
‚îî‚îÄ‚îÄ test-local.sh          # Local testing script

app/api/execute/
‚îî‚îÄ‚îÄ route.ts                # Next.js API endpoint
```

---

## üöÄ Quick Start

### Prerequisites
- Docker installed and running
- IBM Cloud CLI installed and logged in
- Node.js 20+ for Next.js app

### Step 1: Build Docker Image Locally

```bash
cd code-executor
docker build -t code-executor:latest .
```

### Step 2: Test Locally

```bash
# Test the Docker container
echo '{"code": "print(\"Hello World!\")", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

# Expected output:
# {"status": "success", "output": "Hello World!\n", "error": "", "execution_time": 15}
```

### Step 3: Deploy to IBM Cloud

```bash
# Make script executable
chmod +x deploy.sh

# Run deployment
./deploy.sh
```

### Step 4: Add API Route to Next.js

```bash
# Copy the API route file
cp app-api-execute-route.ts \
   ~/Code/work/star-edtech/watsonx-learning-platform/app/api/execute/route.ts

# Redeploy Next.js app
cd ~/Code/work/star-edtech/watsonx-learning-platform
./deploy-learning-platform.sh
```

---

## üß™ Testing

### Test 1: Basic Execution

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "print(\"Hello from API!\")",
    "language": "python"
  }'
```

Expected:
```json
{
  "status": "success",
  "output": "Hello from API!\n",
  "executionTime": 234
}
```

### Test 2: Error Handling

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "raise ValueError(\"Test error\")",
    "language": "python"
  }'
```

Expected:
```json
{
  "status": "error",
  "output": "",
  "error": "Traceback...\nValueError: Test error",
  "executionTime": 125
}
```

### Test 3: Timeout

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type": application/json" \
  -d '{
    "code": "import time\ntime.sleep(35)",
    "language": "python",
    "timeout": 5
  }'
```

Expected:
```json
{
  "status": "timeout",
  "error": "Execution exceeded 5 second timeout",
  "executionTime": 5000
}
```

### Test 4: With Libraries

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "import json\ndata = {\"test\": 123}\nprint(json.dumps(data))",
    "language": "python"
  }'
```

Expected:
```json
{
  "status": "success",
  "output": "{\"test\": 123}\n",
  "executionTime": 180
}
```

---

## üîí Security Features

### 1. Resource Limits
- **Memory:** 512MB max
- **CPU:** 0.5 cores
- **Time:** 30 seconds max
- **Output:** 1MB max

### 2. Code Validation
Blocks dangerous operations:
- `import os`
- `import subprocess`
- `eval()`, `exec()`, `compile()`
- `open()` (file access)
- `__import__`

### 3. Network Isolation
- Docker containers run with `--network=none`
- No internet access
- No localhost access

### 4. Rate Limiting
- 10 requests per minute per IP
- Prevents DOS attacks

### 5. User Isolation
- Code runs as non-root user `coderunner`
- Limited process creation (10 max)

---

## üí∞ Cost Estimation

### IBM Cloud Code Engine Pricing

**Free Tier:**
- 100,000 vCPU-seconds/month
- At 0.5 vCPU √ó 3 seconds average = 66,666 executions/month FREE

**Paid Tier:**
- $0.00003417 per vCPU-second
- 3 second execution = $0.0001025
- 1,000 executions = $0.10
- 10,000 executions = $1.00
- 100,000 executions = $10.00

**Very affordable for MVP!**

---

## üìä Monitoring

### Check Job Status

```bash
# List all jobs
ibmcloud ce job list

# Get job details
ibmcloud ce job get --name code-executor

# List recent job runs
ibmcloud ce jobrun list

# View logs
ibmcloud ce jobrun logs --name <jobrun-name>
```

### Metrics to Track

1. **Success Rate:** % of successful executions
2. **Average Time:** Mean execution time
3. **Error Rate:** % of errors vs timeouts
4. **Cost:** Monthly spend on Code Engine

---

## üêõ Troubleshooting

### Issue: Docker container won't build

**Solution:**
```bash
# Clear Docker cache
docker system prune -a

# Rebuild with no cache
docker build --no-cache -t code-executor:latest .
```

### Issue: IBM Cloud push fails

**Solution:**
```bash
# Re-authenticate to Container Registry
ibmcloud cr login

# Check namespace
ibmcloud cr namespace-list

# If namespace doesn't exist
ibmcloud cr namespace-add ranga
```

### Issue: Job runs but times out

**Solution:**
```bash
# Increase timeout in job definition
ibmcloud ce job update --name code-executor --maxexecutiontime 60
```

### Issue: "Rate limit exceeded" error

**Solution:**
- Wait 1 minute
- Or increase rate limit in `route.ts`

---

## üîÑ Alternative: Cloud Functions

If Code Engine is too slow due to cold starts, switch to Cloud Functions:

```bash
# Create function
ibmcloud fn action create code-executor \
  execute.py \
  --kind python:3.11 \
  --memory 512 \
  --timeout 30000

# Invoke
ibmcloud fn action invoke code-executor \
  --param code "print('Hello!')" \
  --result
```

---

## üìà Next Steps (Week 2)

1. **Video-Lab Sync**
   - YouTube transcript API
   - AI matching algorithm
   - Timestamp-based suggestions

2. **Lab Content Generation**
   - AI-powered lab generator
   - Auto-create from video transcripts

3. **Progress Tracking**
   - Save user code
   - Track completions
   - Analytics dashboard

---

## ‚úÖ Success Criteria

Week 1 is complete when:
- [x] Docker image builds successfully
- [x] Code executes in container
- [x] API endpoint works
- [x] Security measures in place
- [x] Rate limiting works
- [x] Deployed to IBM Cloud
- [ ] Frontend "Run Code" button works
- [ ] Tests pass
- [ ] Production ready

---

## üìû Support

Questions? Issues?
- Check logs: `ibmcloud ce jobrun logs --name <name>`
- Review API errors in Next.js console
- Test Docker locally first before deploying

---

**Ready to deploy? Run `./deploy.sh`!** üöÄ
</file>

<file path="code-executor/requirements.txt">
boto3==1.34.34
requests==2.31.0
numpy==1.26.3
pandas==2.1.4
matplotlib==3.8.2
pillow==10.1.0
python-dotenv==1.0.0
openai==1.6.1
anthropic==0.8.1
ibm-watsonx-ai==1.0.0
ibm-watson-machine-learning==1.0.335
</file>

<file path="code-executor/server.py">
#!/usr/bin/env python3
"""
HTTP Server for Code Execution
Accepts POST requests with JSON body containing code to execute
"""

from http.server import HTTPServer, BaseHTTPRequestHandler
import json
import sys
import io
import contextlib
import traceback
import signal
import resource
import time

class TimeoutException(Exception):
    pass

def timeout_handler(signum, frame):
    raise TimeoutException("Code execution timed out")

def set_resource_limits():
    """Set resource limits to prevent abuse"""
    try:
        # Limit memory to 2GB (increased for watsonx.ai/pandas)
        resource.setrlimit(resource.RLIMIT_AS, (2 * 1024 * 1024 * 1024, 2 * 1024 * 1024 * 1024))
        # Limit CPU time to 30 seconds
        resource.setrlimit(resource.RLIMIT_CPU, (30, 30))
        # Limit number of processes
        resource.setrlimit(resource.RLIMIT_NPROC, (50, 50))
    except:
        pass  # Skip on systems that don't support resource limits

def execute_code(code: str, timeout: int = 30) -> dict:
    """Execute Python code and return results"""
    stdout_capture = io.StringIO()
    stderr_capture = io.StringIO()
    
    result = {
        "status": "success",
        "output": "",
        "error": "",
        "execution_time": 0
    }
    
    start_time = time.time()
    
    try:
        # Set timeout alarm
        signal.signal(signal.SIGALRM, timeout_handler)
        signal.alarm(timeout)
        
        with contextlib.redirect_stdout(stdout_capture), \
             contextlib.redirect_stderr(stderr_capture):
            
            # Create safe builtins
            safe_builtins = {
                k: v for k, v in __builtins__.__dict__.items()
                if k not in ['open', 'eval', 'exec', 'compile']
            }
            
            # Safe import function
            original_import = __builtins__.__import__
            
            ALLOWED_MODULES = {
                'json', 'math', 'random', 'datetime', 'time', 'collections',
                'itertools', 'functools', 'operator', 're', 'string', 'os',
                'boto3', 'botocore', 'requests', 'numpy', 'pandas', 'matplotlib', 
                'pillow', 'typing', 'anthropic', 'openai',
                'ibm_watsonx_ai', 'ibm_watson_machine_learning'
            }
            
            def safe_import(name, *args, **kwargs):
                base_module = name.split('.')[0]
                if base_module in ALLOWED_MODULES:
                    return original_import(name, *args, **kwargs)
                raise ImportError(f"Import of '{name}' is not allowed for security reasons")
            
            safe_builtins['__import__'] = safe_import
            
            restricted_globals = {
                "__builtins__": safe_builtins,
                "__name__": "__main__",
                "__doc__": None,
            }
            
            exec(code, restricted_globals)
        
        signal.alarm(0)
        result["output"] = stdout_capture.getvalue()
        
        if len(result["output"]) > 1024 * 1024:
            result["output"] = result["output"][:1024*1024] + "\n... (output truncated)"
        
    except TimeoutException:
        signal.alarm(0)
        result["status"] = "timeout"
        result["error"] = f"Execution exceeded {timeout} second timeout"
        result["output"] = stdout_capture.getvalue()
        
    except Exception as e:
        signal.alarm(0)
        result["status"] = "error"
        result["error"] = traceback.format_exc()
        result["output"] = stdout_capture.getvalue()
    
    finally:
        result["execution_time"] = int((time.time() - start_time) * 1000)
    
    return result

class CodeExecutorHandler(BaseHTTPRequestHandler):
    """HTTP request handler for code execution"""
    
    def do_GET(self):
        """Health check endpoint"""
        if self.path == '/health':
            self.send_response(200)
            self.send_header('Content-Type', 'application/json')
            self.end_headers()
            response = {
                "status": "ok",
                "service": "code-executor",
                "version": "1.0.0"
            }
            self.wfile.write(json.dumps(response).encode())
        else:
            self.send_response(404)
            self.end_headers()
    
    def do_POST(self):
        """Execute code endpoint"""
        if self.path == '/execute':
            try:
                # Read request body
                content_length = int(self.headers['Content-Length'])
                body = self.rfile.read(content_length)
                data = json.loads(body)
                
                code = data.get('code', '')
                timeout = data.get('timeout', 30)
                
                # Validate
                if not code:
                    self.send_response(400)
                    self.send_header('Content-Type', 'application/json')
                    self.end_headers()
                    self.wfile.write(json.dumps({"error": "Code is required"}).encode())
                    return
                
                if len(code) > 100000:
                    self.send_response(400)
                    self.send_header('Content-Type', 'application/json')
                    self.end_headers()
                    self.wfile.write(json.dumps({"error": "Code exceeds maximum length"}).encode())
                    return
                
                # Execute code
                result = execute_code(code, timeout)
                
                # Send response
                self.send_response(200)
                self.send_header('Content-Type', 'application/json')
                self.end_headers()
                self.wfile.write(json.dumps(result).encode())
                
            except json.JSONDecodeError:
                self.send_response(400)
                self.send_header('Content-Type', 'application/json')
                self.end_headers()
                self.wfile.write(json.dumps({"error": "Invalid JSON"}).encode())
            except Exception as e:
                self.send_response(500)
                self.send_header('Content-Type', 'application/json')
                self.end_headers()
                self.wfile.write(json.dumps({"error": str(e)}).encode())
        else:
            self.send_response(404)
            self.end_headers()
    
    def log_message(self, format, *args):
        """Custom logging"""
        print(f"[{self.log_date_time_string()}] {format % args}")

def main():
    """Start HTTP server"""
    set_resource_limits()
    
    port = int(sys.argv[1]) if len(sys.argv) > 1 else 8080
    server = HTTPServer(('0.0.0.0', port), CodeExecutorHandler)
    
    print(f"Code Executor Server running on port {port}")
    print("Endpoints:")
    print("  GET  /health  - Health check")
    print("  POST /execute - Execute code")
    
    try:
        server.serve_forever()
    except KeyboardInterrupt:
        print("\nShutting down server...")
        server.shutdown()

if __name__ == "__main__":
    main()
</file>

<file path="code-executor/test-input.json">
{"code": "print(\"Hello from IBM Cloud!\")", "timeout": 5}
</file>

<file path="code-executor/test-local.sh">
#!/bin/bash
# Local testing script for code executor

echo "üß™ Testing Code Executor Locally"
echo "================================="

# Test 1: Basic execution
echo ""
echo "Test 1: Basic print statement"
echo '{"code": "print(\"Hello, World!\")", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

# Test 2: With variables
echo ""
echo "Test 2: Variables and math"
echo '{"code": "x = 10\ny = 20\nprint(f\"Sum: {x + y}\")", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

# Test 3: With imports
echo ""
echo "Test 3: Using json library"
echo '{"code": "import json\ndata = {\"name\": \"test\", \"value\": 123}\nprint(json.dumps(data, indent=2))", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

# Test 4: Error handling
echo ""
echo "Test 4: Error handling"
echo '{"code": "raise ValueError(\"This is a test error\")", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

# Test 5: Long output
echo ""
echo "Test 5: Multiple lines of output"
echo '{"code": "for i in range(5):\n    print(f\"Line {i}\")", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

# Test 6: Numpy test
echo ""
echo "Test 6: Using numpy"
echo '{"code": "import numpy as np\narr = np.array([1, 2, 3, 4, 5])\nprint(f\"Array: {arr}\")\nprint(f\"Mean: {arr.mean()}\")", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

echo ""
echo "‚úÖ All tests complete!"
</file>

<file path="components/LabRunner-backup.tsx">
'use client'

import { useState } from 'react'
import Editor from '@monaco-editor/react'
import { Play, RotateCcw, Lightbulb, CheckCircle, XCircle, Loader2 } from 'lucide-react'

interface LabRunnerProps {
  labData: {
    id: string
    title: string
    difficulty: string
    description: string
    starterCode: string
    platform: 'watsonx' | 'bedrock'
  }
}

export default function LabRunner({ labData }: LabRunnerProps) {
  const [code, setCode] = useState(labData.starterCode)
  const [output, setOutput] = useState('')
  const [validationResult, setValidationResult] = useState<any>(null)
  const [isRunning, setIsRunning] = useState(false)
  const [showHint, setShowHint] = useState(false)

  const handleRunCode = async () => {
    setIsRunning(true)
    setValidationResult(null)
    setOutput('')

    try {
      const response = await fetch('/api/execute', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          code,
          labId: labData.id,
          platform: labData.platform,
        }),
      })

      const result = await response.json()
      
      setOutput(result.output || '')
      setValidationResult(result.validation || null)
    } catch (error) {
      setOutput(`Error: ${error instanceof Error ? error.message : 'Unknown error'}`)
    } finally {
      setIsRunning(false)
    }
  }

  const handleReset = () => {
    setCode(labData.starterCode)
    setOutput('')
    setValidationResult(null)
    setShowHint(false)
  }

  return (
    <div className="flex flex-col h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white border-b border-gray-200 px-6 py-4">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">{labData.title}</h1>
            <div className="flex items-center space-x-3 mt-2">
              <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                labData.difficulty === 'beginner' ? 'bg-green-100 text-green-800' :
                labData.difficulty === 'intermediate' ? 'bg-yellow-100 text-yellow-800' :
                'bg-red-100 text-red-800'
              }`}>
                {labData.difficulty.charAt(0).toUpperCase() + labData.difficulty.slice(1)}
              </span>
              <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                labData.platform === 'watsonx' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'
              }`}>
                {labData.platform === 'watsonx' ? 'IBM watsonx.ai' : 'AWS Bedrock'}
              </span>
            </div>
          </div>
          <div className="flex items-center space-x-3">
            <button
              onClick={() => setShowHint(!showHint)}
              className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
            >
              <Lightbulb className="w-4 h-4" />
              <span>Hint</span>
            </button>
            <button
              onClick={handleReset}
              className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
            >
              <RotateCcw className="w-4 h-4" />
              <span>Reset</span>
            </button>
            <button
              onClick={handleRunCode}
              disabled={isRunning}
              className="flex items-center space-x-2 px-6 py-2 bg-ibm-blue text-white rounded-lg hover:bg-ibm-blue-dark transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isRunning ? (
                <>
                  <Loader2 className="w-4 h-4 animate-spin" />
                  <span>Running...</span>
                </>
              ) : (
                <>
                  <Play className="w-4 h-4" />
                  <span>Run Code</span>
                </>
              )}
            </button>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 flex overflow-hidden">
        {/* Instructions Panel */}
        <div className="w-1/3 bg-white border-r border-gray-200 overflow-y-auto p-6">
          <h2 className="text-lg font-semibold mb-4">Instructions</h2>
          <div className="prose prose-sm max-w-none">
            <p className="text-gray-700">{labData.description}</p>
          </div>

          {showHint && (
            <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
              <div className="flex items-start space-x-2">
                <Lightbulb className="w-5 h-5 text-yellow-600 mt-0.5" />
                <div>
                  <h3 className="font-semibold text-yellow-900 mb-1">Hint</h3>
                  <p className="text-sm text-yellow-800">
                    Try using the <code className="bg-yellow-100 px-1 rounded">generate_text()</code> method 
                    with your prompt. Make sure to initialize the model first.
                  </p>
                </div>
              </div>
            </div>
          )}

          <div className="mt-8 pt-6 border-t border-gray-200">
            <h3 className="font-semibold mb-3">Lab Resources</h3>
            <div className="space-y-2 text-sm text-gray-600">
              <div className="flex items-center justify-between">
                <span>API Key:</span>
                <code className="bg-gray-100 px-2 py-1 rounded">***********</code>
              </div>
              <div className="flex items-center justify-between">
                <span>Project ID:</span>
                <code className="bg-gray-100 px-2 py-1 rounded">lab-{labData.id}</code>
              </div>
            </div>
          </div>
        </div>

        {/* Code Editor Panel */}
        <div className="flex-1 flex flex-col">
          <div className="flex-1 border-b border-gray-200">
            <Editor
              height="100%"
              defaultLanguage="python"
              value={code}
              onChange={(value) => setCode(value || '')}
              theme="vs-dark"
              options={{
                minimap: { enabled: false },
                fontSize: 14,
                lineNumbers: 'on',
                scrollBeyondLastLine: false,
                automaticLayout: true,
                tabSize: 2,
              }}
            />
          </div>

          {/* Output Panel */}
          <div className="h-1/3 bg-gray-900 text-white overflow-auto">
            <div className="px-4 py-2 bg-gray-800 border-b border-gray-700 text-sm font-medium">
              Output
            </div>
            <div className="p-4">
              {validationResult && (
                <div className={`mb-4 p-3 rounded-lg flex items-start space-x-2 ${
                  validationResult.passed 
                    ? 'bg-green-500/20 border border-green-500/50' 
                    : 'bg-red-500/20 border border-red-500/50'
                }`}>
                  {validationResult.passed ? (
                    <CheckCircle className="w-5 h-5 text-green-400 mt-0.5" />
                  ) : (
                    <XCircle className="w-5 h-5 text-red-400 mt-0.5" />
                  )}
                  <div>
                    <div className="font-semibold">
                      {validationResult.passed ? 'Success!' : 'Not quite right'}
                    </div>
                    <div className="text-sm mt-1 opacity-90">
                      {validationResult.feedback}
                    </div>
                  </div>
                </div>
              )}
              <pre className="font-mono text-sm whitespace-pre-wrap">
                {output || (isRunning ? 'Running your code...' : 'Output will appear here when you run your code.')}
              </pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
</file>

<file path="components/LabRunner.tsx">
/**
 * Enhanced LabRunner Component
 * 
 * Includes:
 * - Video context display
 * - Section progress
 * - Continue video button
 * - Timestamp awareness
 */

'use client'

import { useState } from 'react'
import Editor from '@monaco-editor/react'
import { Play, RotateCcw, Lightbulb, CheckCircle, XCircle, Loader2, Video, ArrowRight } from 'lucide-react'

interface LabRunnerProps {
  labData: {
    id: string
    title: string
    fullTitle?: string
    difficulty: string
    description: string
    starterCode: string
    platform: 'watsonx' | 'bedrock'
    videoId?: string | null
    timestamp?: number
    topic?: string | null
    sectionNumber?: number
    totalSections?: number
  }
}

export default function LabRunner({ labData }: LabRunnerProps) {
  const [code, setCode] = useState(labData.starterCode)
  const [output, setOutput] = useState('')
  const [validationResult, setValidationResult] = useState<any>(null)
  const [isRunning, setIsRunning] = useState(false)
  const [showHint, setShowHint] = useState(false)

  const hasVideoContext = !!labData.videoId

  const handleRunCode = async () => {
    setIsRunning(true)
    setValidationResult(null)
    setOutput('Running your code...')

    try {
      const response = await fetch('/api/execute', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          code,
          language: 'python',
          timeout: 30,
        }),
      })

      const result = await response.json()
      
      if (result.status === 'success') {
        setOutput(result.output || 'Code executed successfully (no output)')
      } else if (result.status === 'error') {
        setOutput(`‚ùå Error:\n${result.error}`)
      } else if (result.status === 'timeout') {
        setOutput(`‚è±Ô∏è Timeout: Code execution exceeded 30 seconds`)
      } else {
        setOutput(`Unknown result: ${JSON.stringify(result)}`)
      }
      
      setValidationResult(result.validation || null)
    } catch (error) {
      setOutput(`‚ùå Network Error: ${error instanceof Error ? error.message : 'Unknown error'}\n\nMake sure the API is running.`)
    } finally {
      setIsRunning(false)
    }
  }

  const handleReset = () => {
    setCode(labData.starterCode)
    setOutput('')
    setValidationResult(null)
    setShowHint(false)
  }

  const handleContinueVideo = () => {
    if (!labData.videoId) return
    
    // Open YouTube with timestamp
    const currentTimestamp = labData.timestamp || 0
    const resumeTimestamp = currentTimestamp + 30 // Resume 30 seconds after lab started
    const youtubeUrl = `https://www.youtube.com/watch?v=${labData.videoId}&t=${resumeTimestamp}s`
    
    window.open(youtubeUrl, '_blank')
  }

  return (
    <div className="flex flex-col h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white border-b border-gray-200 px-6 py-4">
        <div className="flex items-center justify-between">
          <div className="flex-1">
            {/* Video Context Banner */}
            {hasVideoContext && (
              <div className="mb-3 flex items-center gap-2 text-sm text-gray-600">
                <Video className="w-4 h-4" />
                <span>From video: {labData.topic || 'Tutorial'}</span>
                {labData.timestamp && (
                  <span className="text-gray-400">‚Ä¢ {formatTimestamp(labData.timestamp)}</span>
                )}
              </div>
            )}

            <h1 className="text-2xl font-bold text-gray-900">{labData.title}</h1>
            
            {/* Section Progress */}
            {labData.sectionNumber && labData.totalSections && (
              <div className="mt-2">
                <div className="flex items-center gap-3">
                  <span className="text-sm font-medium text-gray-600">
                    Section {labData.sectionNumber} of {labData.totalSections}
                  </span>
                  <div className="flex-1 max-w-xs h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div 
                      className="h-full bg-blue-600 transition-all duration-300"
                      style={{ width: `${(labData.sectionNumber / labData.totalSections) * 100}%` }}
                    />
                  </div>
                  <span className="text-sm text-gray-500">
                    {Math.round((labData.sectionNumber / labData.totalSections) * 100)}%
                  </span>
                </div>
              </div>
            )}

            <div className="flex items-center space-x-3 mt-2">
              <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                labData.difficulty === 'beginner' ? 'bg-green-100 text-green-800' :
                labData.difficulty === 'intermediate' ? 'bg-yellow-100 text-yellow-800' :
                'bg-red-100 text-red-800'
              }`}>
                {labData.difficulty.charAt(0).toUpperCase() + labData.difficulty.slice(1)}
              </span>
              <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                labData.platform === 'watsonx' ? 'bg-blue-100 text-blue-800' : 'bg-orange-100 text-orange-800'
              }`}>
                {labData.platform === 'watsonx' ? 'IBM watsonx.ai' : 'AWS Bedrock'}
              </span>
            </div>
          </div>
          
          <div className="flex items-center space-x-3">
            {hasVideoContext && (
              <button
                onClick={handleContinueVideo}
                className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
              >
                <Video className="w-4 h-4" />
                <span>Continue Video</span>
                <ArrowRight className="w-4 h-4" />
              </button>
            )}
            <button
              onClick={() => setShowHint(!showHint)}
              className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
            >
              <Lightbulb className="w-4 h-4" />
              <span>Hint</span>
            </button>
            <button
              onClick={handleReset}
              className="flex items-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition"
            >
              <RotateCcw className="w-4 h-4" />
              <span>Reset</span>
            </button>
            <button
              onClick={handleRunCode}
              disabled={isRunning}
              className="flex items-center space-x-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isRunning ? (
                <>
                  <Loader2 className="w-4 h-4 animate-spin" />
                  <span>Running...</span>
                </>
              ) : (
                <>
                  <Play className="w-4 h-4" />
                  <span>Run Code</span>
                </>
              )}
            </button>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="flex-1 flex overflow-hidden">
        {/* Instructions Panel */}
        <div className="w-1/3 bg-white border-r border-gray-200 overflow-y-auto p-6">
          <h2 className="text-lg font-semibold mb-4">Instructions</h2>
          <div className="prose prose-sm max-w-none">
            <div className="whitespace-pre-line text-gray-700">{labData.description}</div>
          </div>

          {showHint && (
            <div className="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
              <div className="flex items-start space-x-2">
                <Lightbulb className="w-5 h-5 text-yellow-600 mt-0.5" />
                <div>
                  <h3 className="font-semibold text-yellow-900 mb-1">Hint</h3>
                  <p className="text-sm text-yellow-800">
                    Look for the TODO comments in the code. Each TODO indicates a section you need to complete.
                    Replace the <code className="bg-yellow-100 px-1 rounded">___</code> placeholders with the appropriate code.
                  </p>
                </div>
              </div>
            </div>
          )}

          <div className="mt-8 pt-6 border-t border-gray-200">
            <h3 className="font-semibold mb-3">Lab Resources</h3>
            <div className="space-y-2 text-sm text-gray-600">
              <div className="flex items-center justify-between">
                <span>API Key:</span>
                <code className="bg-gray-100 px-2 py-1 rounded">Provided automatically</code>
              </div>
              <div className="flex items-center justify-between">
                <span>Project ID:</span>
                <code className="bg-gray-100 px-2 py-1 rounded">lab-{labData.id}</code>
              </div>
            </div>
          </div>
        </div>

        {/* Code Editor Panel */}
        <div className="flex-1 flex flex-col">
          <div className="flex-1 border-b border-gray-200">
            <Editor
              height="100%"
              defaultLanguage="python"
              value={code}
              onChange={(value) => setCode(value || '')}
              theme="vs-dark"
              options={{
                minimap: { enabled: false },
                fontSize: 14,
                lineNumbers: 'on',
                scrollBeyondLastLine: false,
                automaticLayout: true,
                tabSize: 2,
              }}
            />
          </div>

          {/* Output Panel */}
          <div className="h-1/3 bg-gray-900 text-white overflow-auto">
            <div className="px-4 py-2 bg-gray-800 border-b border-gray-700 text-sm font-medium">
              Output
            </div>
            <div className="p-4">
              {validationResult && (
                <div className={`mb-4 p-3 rounded-lg flex items-start space-x-2 ${
                  validationResult.passed 
                    ? 'bg-green-500/20 border border-green-500/50' 
                    : 'bg-red-500/20 border border-red-500/50'
                }`}>
                  {validationResult.passed ? (
                    <CheckCircle className="w-5 h-5 text-green-400 mt-0.5" />
                  ) : (
                    <XCircle className="w-5 h-5 text-red-400 mt-0.5" />
                  )}
                  <div>
                    <div className="font-semibold">
                      {validationResult.passed ? 'Success!' : 'Not quite right'}
                    </div>
                    <div className="text-sm mt-1 opacity-90">
                      {validationResult.feedback}
                    </div>
                  </div>
                </div>
              )}
              <pre className="font-mono text-sm whitespace-pre-wrap">
                {output || 'Output will appear here when you run your code.'}
              </pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}

function formatTimestamp(seconds: number): string {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}
</file>

<file path="components/Navigation.tsx">
'use client'

import Link from 'next/link'
import { useState } from 'react'
import { Menu, X, BookOpen, Code, Award, Users } from 'lucide-react'

export default function Navigation() {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false)

  return (
    <nav className="bg-white border-b border-gray-200 sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          {/* Logo */}
          <Link href="/" className="flex items-center space-x-3">
            <div className="w-10 h-10 bg-gradient-to-br from-ibm-blue to-ibm-purple rounded-lg flex items-center justify-center">
              <Code className="w-6 h-6 text-white" />
            </div>
            <span className="text-xl font-bold text-gray-900">
              GenAI Academy
            </span>
          </Link>

          {/* Desktop Navigation */}
          <div className="hidden md:flex items-center space-x-8">
            <Link 
              href="/labs" 
              className="flex items-center space-x-2 text-gray-700 hover:text-ibm-blue transition"
            >
              <BookOpen className="w-4 h-4" />
              <span>Labs</span>
            </Link>
            <Link 
              href="/learning-paths" 
              className="flex items-center space-x-2 text-gray-700 hover:text-ibm-blue transition"
            >
              <Award className="w-4 h-4" />
              <span>Learning Paths</span>
            </Link>
            <Link 
              href="/community" 
              className="flex items-center space-x-2 text-gray-700 hover:text-ibm-blue transition"
            >
              <Users className="w-4 h-4" />
              <span>Community</span>
            </Link>
            <Link 
              href="/pricing" 
              className="text-gray-700 hover:text-ibm-blue transition"
            >
              Pricing
            </Link>
          </div>

          {/* CTA Buttons */}
          <div className="hidden md:flex items-center space-x-4">
            <Link 
              href="/login" 
              className="text-gray-700 hover:text-ibm-blue transition"
            >
              Sign In
            </Link>
            <Link 
              href="/signup" 
              className="bg-ibm-blue text-white px-4 py-2 rounded-lg hover:bg-ibm-blue-dark transition"
            >
              Start Learning
            </Link>
          </div>

          {/* Mobile menu button */}
          <button
            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            className="md:hidden text-gray-700"
          >
            {mobileMenuOpen ? <X className="w-6 h-6" /> : <Menu className="w-6 h-6" />}
          </button>
        </div>
      </div>

      {/* Mobile Menu */}
      {mobileMenuOpen && (
        <div className="md:hidden bg-white border-t border-gray-200">
          <div className="px-4 py-3 space-y-3">
            <Link 
              href="/labs" 
              className="block text-gray-700 hover:text-ibm-blue py-2"
              onClick={() => setMobileMenuOpen(false)}
            >
              Labs
            </Link>
            <Link 
              href="/learning-paths" 
              className="block text-gray-700 hover:text-ibm-blue py-2"
              onClick={() => setMobileMenuOpen(false)}
            >
              Learning Paths
            </Link>
            <Link 
              href="/community" 
              className="block text-gray-700 hover:text-ibm-blue py-2"
              onClick={() => setMobileMenuOpen(false)}
            >
              Community
            </Link>
            <Link 
              href="/pricing" 
              className="block text-gray-700 hover:text-ibm-blue py-2"
              onClick={() => setMobileMenuOpen(false)}
            >
              Pricing
            </Link>
            <div className="pt-3 border-t border-gray-200">
              <Link 
                href="/login" 
                className="block text-gray-700 hover:text-ibm-blue py-2"
                onClick={() => setMobileMenuOpen(false)}
              >
                Sign In
              </Link>
              <Link 
                href="/signup" 
                className="block bg-ibm-blue text-white px-4 py-2 rounded-lg text-center mt-2"
                onClick={() => setMobileMenuOpen(false)}
              >
                Start Learning
              </Link>
            </div>
          </div>
        </div>
      )}
    </nav>
  )
}
</file>

<file path=".env.example">
# Application
NEXT_PUBLIC_APP_URL=http://localhost:3000

# IBM Cloud
IBM_CLOUD_API_KEY=your_ibm_cloud_api_key_here
IBM_CLOUD_PROJECT_ID=your_project_id_here
IBM_CLOUD_REGION=us-south

# AWS (for Bedrock comparison labs)
AWS_ACCESS_KEY_ID=your_aws_access_key_here
AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here
AWS_REGION=us-east-1

# Database (Supabase example)
DATABASE_URL=your_supabase_database_url_here
SUPABASE_ANON_KEY=your_supabase_anon_key_here

# Authentication (Clerk example)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_clerk_publishable_key_here
CLERK_SECRET_KEY=your_clerk_secret_key_here

# Payments (Stripe)
STRIPE_PUBLISHABLE_KEY=your_stripe_publishable_key_here
STRIPE_SECRET_KEY=your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=your_stripe_webhook_secret_here

# AI Tutor (Claude API for fallback)
ANTHROPIC_API_KEY=your_anthropic_api_key_here
</file>

<file path=".gitignore">
node_modules/
.next/
.env
.env.local
*.log
.DS_Store
backups/
*.backup
*.tar.gz
</file>

<file path="deploy-final.sh">
#!/usr/bin/env bash
set -euo pipefail

# Final Working Deployment for GenAI Learning Platform

: "${IBM_CLOUD_API_KEY:?Set IBM_CLOUD_API_KEY}"

PROJECT_NAME="genai-learning-platform"
NAMESPACE="ranga"
REGISTRY_SERVER="icr.io"
APP_IMAGE="${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"

echo "=================================================="
echo "  Deploying GenAI Learning Platform"
echo "=================================================="
echo ""
echo "Using image: ${APP_IMAGE}"
echo ""

# 1. Select Code Engine project
echo "==> 1. Selecting Code Engine project"
ibmcloud ce project select -n "${PROJECT_NAME}"

# 2. Delete existing registry secret and recreate
echo ""
echo "==> 2. Recreating registry credentials"
ibmcloud ce registry delete --name icr-global --force 2>/dev/null || true

ibmcloud ce registry create \
  --name icr-global \
  --server "${REGISTRY_SERVER}" \
  --username iamapikey \
  --password "${IBM_CLOUD_API_KEY}"

echo "‚úÖ Registry secret created"

# 3. Delete old application if exists
echo ""
echo "==> 3. Removing old application"
ibmcloud ce app delete --name "genai-learning-platform" --force --ignore-not-found
sleep 5

# 4. Create new application
echo ""
echo "==> 4. Creating application"
ibmcloud ce app create \
  --name "genai-learning-platform" \
  --image "${APP_IMAGE}" \
  --registry-secret icr-global \
  --port 3000 \
  --cpu 1 \
  --memory 2G \
  --min-scale 1 \
  --max-scale 5 \
  --env NODE_ENV=production

# 5. Wait for deployment
echo ""
echo "==> 5. Waiting for application to be ready..."
sleep 30

# 6. Get application details
echo ""
echo "==> 6. Application Status:"
ibmcloud ce app get --name "genai-learning-platform"

# 7. Get URL
APP_URL=$(ibmcloud ce app get --name "genai-learning-platform" 2>/dev/null | grep "URL:" | awk '{print $2}')

echo ""
echo "=================================================="
echo "‚úÖ DEPLOYMENT SUCCESSFUL!"
echo "=================================================="
echo ""
echo "üéØ Your Platform is Live:"
echo "   ${APP_URL}"
echo ""
echo "üß™ Test it now:"
echo "   curl ${APP_URL}"
echo ""
echo "Or open in browser:"
echo "   open ${APP_URL}"
echo ""
echo "=================================================="
echo ""
echo "üìä View real-time logs:"
echo "   ibmcloud ce app logs --name genai-learning-platform --follow"
echo ""
echo "üîÑ Check application status:"
echo "   ibmcloud ce app get --name genai-learning-platform"
echo ""
echo "üóëÔ∏è  To delete:"
echo "   ibmcloud ce app delete --name genai-learning-platform --force"
echo ""
</file>

<file path="deploy-learning-platform.sh">
#!/usr/bin/env bash
set -euo pipefail

# Multi-Cloud GenAI Learning Platform - IBM Code Engine Deployment

# ----- Config (env) -----
: "${IBM_CLOUD_API_KEY:?Set IBM_CLOUD_API_KEY}"
: "${NAMESPACE:?Set NAMESPACE (your icr.io namespace)}"

REGION="${REGION:-us-south}"
RESOURCE_GROUP="${RESOURCE_GROUP:-Default}"
REGISTRY_SERVER="icr.io"
PROJECT_NAME="genai-learning-platform"

echo "=================================================="
echo "  GenAI Learning Platform - IBM Code Engine Deploy"
echo "=================================================="
echo ""

# ----- 1. Login -----
echo "==> 1. IBM Cloud Login"
ibmcloud login -a https://cloud.ibm.com \
  --apikey "$IBM_CLOUD_API_KEY" \
  -g "$RESOURCE_GROUP" \
  -r "$REGION"

# ----- 2. Ensure Plugins -----
echo "==> 2. Installing Plugins (idempotent)"
ibmcloud plugin install container-registry -q || true
ibmcloud plugin install code-engine -q || true

# ----- 3. Registry Setup -----
echo "==> 3. Setting up Registry Namespace"
ibmcloud cr region-set global >/dev/null
if ! ibmcloud cr namespaces | awk '{print $1}' | grep -qx "$NAMESPACE"; then
  echo "Creating namespace: $NAMESPACE"
  ibmcloud cr namespace-add "$NAMESPACE"
fi

echo "==> 4. Authenticating Docker with IBM Container Registry"
ibmcloud cr login

# ----- 4. Build & Push Next.js App -----
echo ""
echo "==> 5. Building GenAI Learning Platform"

# Create production Dockerfile for Next.js
cat > Dockerfile.prod << 'EOF'
# Build stage
FROM node:20-alpine AS builder

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy source code
COPY . .

# Build Next.js app
ENV NEXT_TELEMETRY_DISABLED 1
RUN npm run build

# Production stage
FROM node:20-alpine AS runner

WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

# Create non-root user
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# Copy necessary files from builder
COPY --from=builder /app/public ./public
COPY --from=builder /app/package*.json ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
EOF

# Update next.config.js for standalone build
cat > next.config.js << 'EOF'
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone',
  images: {
    domains: ['images.unsplash.com'],
  },
}

module.exports = nextConfig
EOF

echo "Building Docker image..."
docker build --platform linux/amd64 -f Dockerfile.prod -t "genai-learning-platform:latest" .
docker tag "genai-learning-platform:latest" "${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"
docker push "${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"

# ----- 5. Create/Select Code Engine Project -----
echo ""
echo "==> 6. Configuring Code Engine Project"

if ! ibmcloud ce project get --name "${PROJECT_NAME}" >/dev/null 2>&1; then
  echo "Creating project '${PROJECT_NAME}'..."
  ibmcloud ce project create --name "${PROJECT_NAME}"
else
  echo "Project '${PROJECT_NAME}' already exists."
fi

ibmcloud ce project select -n "${PROJECT_NAME}"

# ----- 6. Create Registry Secret -----
echo ""
echo "==> 7. Creating/Updating Registry Secret 'icr-global'"
if ! ibmcloud ce registry get --name icr-global >/dev/null 2>&1; then
  ibmcloud ce registry create --name icr-global \
    --server "${REGISTRY_SERVER}" \
    --username iamapikey \
    --password "$IBM_CLOUD_API_KEY"
else
  ibmcloud ce registry update --name icr-global \
    --server "${REGISTRY_SERVER}" \
    --username iamapikey \
    --password "$IBM_CLOUD_API_KEY" >/dev/null
fi

# ----- 7. Deploy Application -----
echo ""
echo "==> 8. Deploying GenAI Learning Platform"
APP_IMAGE="${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"

if ! ibmcloud ce app get --name "genai-learning-platform" >/dev/null 2>&1; then
  ibmcloud ce app create --name "genai-learning-platform" \
    --image "${APP_IMAGE}" \
    --registry-secret icr-global \
    --port 3000 \
    --cpu 1 \
    --memory 2G \
    --min-scale 1 \
    --max-scale 5 \
    --env NODE_ENV=production \
    --env IBM_CLOUD_API_KEY="${IBM_CLOUD_API_KEY}"
else
  ibmcloud ce app update --name "genai-learning-platform" \
    --image "${APP_IMAGE}" \
    --registry-secret icr-global \
    --port 3000 \
    --cpu 1 \
    --memory 2G \
    --env IBM_CLOUD_API_KEY="${IBM_CLOUD_API_KEY}"
fi

APP_URL=$(ibmcloud ce app get --name "genai-learning-platform" | sed -n 's/^ *URL: *//p')

# ----- Summary -----
echo ""
echo "=================================================="
echo "‚úÖ DEPLOYMENT SUCCESSFUL!"
echo "=================================================="
echo ""
echo "üîó Your Learning Platform is Live:"
echo ""
echo "üéØ Platform URL:"
echo "   ${APP_URL}"
echo ""
echo "=================================================="
echo ""
echo "üìã What You Can Do Now:"
echo ""
echo "1. Visit Platform: ${APP_URL}"
echo "   ‚úÖ Homepage with hero section"
echo "   ‚úÖ Labs listing at /labs"
echo "   ‚úÖ Interactive lab at /labs/watsonx-first-call"
echo "   ‚úÖ Pricing page at /pricing"
echo ""
echo "2. Test the UI:"
echo "   - All pages are responsive"
echo "   - Monaco editor loads in lab environment"
echo "   - Navigation works across all pages"
echo ""
echo "3. Next Steps to Make Labs Functional:"
echo "   - Add /app/api/execute/route.ts endpoint"
echo "   - Connect to watsonx.ai API"
echo "   - Add authentication (Clerk)"
echo "   - Add database (Supabase)"
echo ""
echo "=================================================="
echo ""
echo "üß™ Test Endpoints:"
echo "   curl ${APP_URL}"
echo "   curl ${APP_URL}/labs"
echo ""
echo "üìä Monitor Application:"
echo "   ibmcloud ce app logs --name genai-learning-platform --follow"
echo ""
echo "üîÑ Update Deployment:"
echo "   # Make code changes, then run:"
echo "   docker build --platform linux/amd64 -f Dockerfile.prod -t genai-learning-platform:latest ."
echo "   docker tag genai-learning-platform:latest ${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"
echo "   docker push ${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"
echo "   ibmcloud ce app update --name genai-learning-platform --image ${APP_IMAGE}"
echo ""
echo "üóëÔ∏è  To delete when done:"
echo "   ibmcloud ce project delete --name ${PROJECT_NAME} --force"
echo ""
echo "=================================================="
echo ""
echo "üí∞ Estimated Cost:"
echo "   ~\$15-30/month for demo (with auto-scaling)"
echo "   Free tier: 100,000 vCPU-seconds/month"
echo ""
echo "üìù Important Notes:"
echo ""
echo "‚úÖ What's Working:"
echo "   - Complete UI (all pages render)"
echo "   - Responsive design"
echo "   - Navigation"
echo "   - Lab interface with Monaco editor"
echo ""
echo "‚ö†Ô∏è  What Needs Backend Integration:"
echo "   - Code execution (needs watsonx.ai API)"
echo "   - User authentication"
echo "   - Progress tracking"
echo "   - Payments"
echo ""
echo "üîß Next Development Step:"
echo "   Create app/api/execute/route.ts to handle"
echo "   code execution via watsonx.ai"
echo ""
echo "=================================================="
</file>

<file path="deploy-production.sh">
#!/usr/bin/env bash
set -euo pipefail

# Multi-Cloud GenAI Learning Platform - Production Deployment Script
# This script handles the complete deployment including IAM setup

# ----- Config (env) -----
: "${IBM_CLOUD_API_KEY:?Set IBM_CLOUD_API_KEY}"
: "${NAMESPACE:?Set NAMESPACE (your icr.io namespace)}"

REGION="${REGION:-us-south}"
RESOURCE_GROUP="${RESOURCE_GROUP:-Default}"
REGISTRY_SERVER="icr.io"
PROJECT_NAME="genai-learning-platform"
SERVICE_ID_NAME="ce-registry-access"
SERVICE_API_KEY_NAME="ce-registry-key"

echo "=================================================="
echo "  GenAI Learning Platform - Production Deploy"
echo "=================================================="
echo ""

# ----- 1. Login -----
echo "==> 1. IBM Cloud Login"
ibmcloud login -a https://cloud.ibm.com \
  --apikey "$IBM_CLOUD_API_KEY" \
  -g "$RESOURCE_GROUP" \
  -r "$REGION"

# ----- 2. Ensure Plugins -----
echo ""
echo "==> 2. Installing Plugins"
ibmcloud plugin install container-registry -f -q || true
ibmcloud plugin install code-engine -f -q || true

# ----- 3. Registry Setup -----
echo ""
echo "==> 3. Setting up Registry Namespace"
ibmcloud cr region-set global >/dev/null
if ! ibmcloud cr namespaces | awk '{print $1}' | grep -qx "$NAMESPACE"; then
  echo "Creating namespace: $NAMESPACE"
  ibmcloud cr namespace-add "$NAMESPACE"
else
  echo "Namespace '${NAMESPACE}' already exists"
fi

echo ""
echo "==> 4. Authenticating Docker with IBM Container Registry"
ibmcloud cr login

# ----- 4. IAM Service ID Setup (One-time, idempotent) -----
echo ""
echo "==> 5. Setting up IAM Service ID for Code Engine"

# Check if service ID exists
if ibmcloud iam service-id "${SERVICE_ID_NAME}" >/dev/null 2>&1; then
  echo "Service ID '${SERVICE_ID_NAME}' already exists"
  
  # Check if API key exists
  if ibmcloud iam service-api-keys "${SERVICE_ID_NAME}" | grep -q "${SERVICE_API_KEY_NAME}"; then
    echo "API key '${SERVICE_API_KEY_NAME}' already exists"
    echo ""
    echo "‚ö†Ô∏è  Using existing Service ID and API key"
    echo "   If you need to regenerate, run:"
    echo "   ibmcloud iam service-api-key-delete ${SERVICE_ID_NAME} ${SERVICE_API_KEY_NAME} -f"
    echo "   Then re-run this script"
    echo ""
    
    # For existing setup, we'll need the API key
    # User should have it saved, or they need to regenerate
    if [ -z "${SERVICE_API_KEY:-}" ]; then
      echo "‚ùå ERROR: Existing Service ID found but SERVICE_API_KEY not set"
      echo ""
      echo "Options:"
      echo "1. Set the existing key: export SERVICE_API_KEY='your-saved-key'"
      echo "2. Or delete and regenerate:"
      echo "   ibmcloud iam service-api-key-delete ${SERVICE_ID_NAME} ${SERVICE_API_KEY_NAME} -f"
      echo "   Then re-run this script"
      exit 1
    fi
    
    REGISTRY_API_KEY="${SERVICE_API_KEY}"
  else
    echo "Creating new API key for existing Service ID"
    REGISTRY_API_KEY=$(ibmcloud iam service-api-key-create "${SERVICE_API_KEY_NAME}" "${SERVICE_ID_NAME}" \
      --description "API key for Code Engine container registry access" \
      --output json | grep -o '"apikey":"[^"]*' | cut -d'"' -f4)
    
    echo ""
    echo "‚úÖ Created new API key"
    echo "‚ö†Ô∏è  SAVE THIS KEY (it won't be shown again):"
    echo "   ${REGISTRY_API_KEY}"
    echo ""
  fi
else
  echo "Creating new Service ID: ${SERVICE_ID_NAME}"
  ibmcloud iam service-id-create "${SERVICE_ID_NAME}" \
    --description "Service ID for Code Engine to access Container Registry"
  
  echo "Creating API key for Service ID"
  REGISTRY_API_KEY=$(ibmcloud iam service-api-key-create "${SERVICE_API_KEY_NAME}" "${SERVICE_ID_NAME}" \
    --description "API key for Code Engine container registry access" \
    --output json | grep -o '"apikey":"[^"]*' | cut -d'"' -f4)
  
  echo ""
  echo "‚úÖ Created Service ID and API key"
  echo "‚ö†Ô∏è  SAVE THIS KEY (it won't be shown again):"
  echo "   ${REGISTRY_API_KEY}"
  echo ""
  
  echo "Granting Container Registry Reader access to Service ID"
  ibmcloud iam service-policy-create "${SERVICE_ID_NAME}" \
    --roles Reader \
    --service-name container-registry
  
  echo "‚úÖ IAM policies configured"
fi

# ----- 5. Prepare Build -----
echo ""
echo "==> 6. Preparing Build Environment"

# Ensure public directory exists
mkdir -p public
touch public/.gitkeep

# Create optimized Dockerfile
cat > Dockerfile.prod << 'EOF'
# Build stage
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN mkdir -p public
ENV NEXT_TELEMETRY_DISABLED=1
RUN npm run build

# Production stage
FROM node:20-alpine AS runner
WORKDIR /app
ENV NODE_ENV=production
ENV NEXT_TELEMETRY_DISABLED=1
RUN addgroup --system --gid 1001 nodejs && \
    adduser --system --uid 1001 nextjs
COPY --from=builder /app/package*.json ./
COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static
USER nextjs
EXPOSE 3000
ENV PORT=3000
ENV HOSTNAME="0.0.0.0"
CMD ["node", "server.js"]
EOF

# Update next.config.js for standalone build
cat > next.config.js << 'EOF'
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone',
  images: {
    unoptimized: true,
    domains: ['images.unsplash.com'],
  },
}

module.exports = nextConfig
EOF

echo "==> 7. Building Docker Image"
docker build --platform linux/amd64 -f Dockerfile.prod -t "genai-learning-platform:latest" .

if [ $? -ne 0 ]; then
  echo "‚ùå Docker build failed!"
  exit 1
fi

echo ""
echo "==> 8. Tagging and Pushing Image"
docker tag "genai-learning-platform:latest" "${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"
docker push "${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"

if [ $? -ne 0 ]; then
  echo "‚ùå Docker push failed!"
  exit 1
fi

echo "‚úÖ Image pushed successfully"

# ----- 6. Create/Select Code Engine Project -----
echo ""
echo "==> 9. Configuring Code Engine Project"

if ! ibmcloud ce project get --name "${PROJECT_NAME}" >/dev/null 2>&1; then
  echo "Creating project '${PROJECT_NAME}'..."
  ibmcloud ce project create --name "${PROJECT_NAME}"
else
  echo "Project '${PROJECT_NAME}' already exists"
fi

ibmcloud ce project select -n "${PROJECT_NAME}"

# ----- 7. Create Registry Secret with Service ID API Key -----
echo ""
echo "==> 10. Creating/Updating Registry Secret"
ibmcloud ce registry delete --name icr-global --force 2>/dev/null || true

ibmcloud ce registry create \
  --name icr-global \
  --server "${REGISTRY_SERVER}" \
  --username iamapikey \
  --password "${REGISTRY_API_KEY}"

echo "‚úÖ Registry secret created with Service ID credentials"

# ----- 8. Deploy Application -----
echo ""
echo "==> 11. Deploying Application"
APP_IMAGE="${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"

# Delete old app for clean deployment
ibmcloud ce app delete --name "genai-learning-platform" --force --ignore-not-found
sleep 5

# Create new application
ibmcloud ce app create \
  --name "genai-learning-platform" \
  --image "${APP_IMAGE}" \
  --registry-secret icr-global \
  --port 3000 \
  --cpu 1 \
  --memory 2G \
  --min-scale 1 \
  --max-scale 5 \
  --env NODE_ENV=production

# ----- 9. Wait and Verify -----
echo ""
echo "==> 12. Waiting for application to be ready..."
sleep 30

# Get application details
ibmcloud ce app get --name "genai-learning-platform"

APP_URL=$(ibmcloud ce app get --name "genai-learning-platform" 2>/dev/null | grep "URL:" | awk '{print $2}')

# ----- Summary -----
echo ""
echo "=================================================="
echo "‚úÖ DEPLOYMENT SUCCESSFUL!"
echo "=================================================="
echo ""
echo "üéØ Your Platform is Live:"
echo "   ${APP_URL}"
echo ""
echo "üìã What's Working:"
echo "   ‚úÖ Homepage with hero section"
echo "   ‚úÖ Labs listing with filters"
echo "   ‚úÖ Interactive lab environment"
echo "   ‚úÖ Monaco code editor"
echo "   ‚úÖ Pricing page"
echo "   ‚úÖ Responsive navigation"
echo ""
echo "‚ö†Ô∏è  What Needs Backend:"
echo "   - Code execution (create /api/execute endpoint)"
echo "   - Authentication (Clerk integration)"
echo "   - Database (Supabase setup)"
echo "   - Payments (Stripe integration)"
echo ""
echo "=================================================="
echo ""
echo "üß™ Test Your Platform:"
echo "   curl ${APP_URL}"
echo "   open ${APP_URL}"
echo ""
echo "üìä Monitor Logs:"
echo "   ibmcloud ce app logs --name genai-learning-platform --follow"
echo ""
echo "üîÑ Redeploy After Changes:"
echo "   Just run this script again!"
echo ""
echo "üóëÔ∏è  Delete Everything:"
echo "   ibmcloud ce project delete --name ${PROJECT_NAME} --force"
echo "   ibmcloud iam service-id-delete ${SERVICE_ID_NAME} -f"
echo ""
echo "üí∞ Estimated Cost:"
echo "   ~\$15-30/month for demo usage"
echo "   Free tier: 100,000 vCPU-seconds/month"
echo ""
echo "=================================================="
echo ""
echo "üéâ Next Steps:"
echo ""
echo "1. Share your URL with testers"
echo "2. Build the backend API (app/api/execute/route.ts)"
echo "3. Connect watsonx.ai for code execution"
echo "4. Add authentication and database"
echo ""
echo "Want help building the backend? Let's do it! üöÄ"
echo ""
</file>

<file path="deploy.sh">
#!/bin/bash
set -e

echo "üöÄ Deploying Code Execution Backend to IBM Cloud"
echo "================================================"

# Configuration
PROJECT_NAME="genai-learning-platform"
EXECUTOR_IMAGE="code-executor"
REGISTRY="icr.io/ranga"

# Step 1: Build Docker image
echo ""
echo "üì¶ Step 1: Building Docker image..."
cd code-executor
docker build --platform linux/amd64 -t ${EXECUTOR_IMAGE}:latest .

# Step 2: Tag for IBM Cloud Registry
echo ""
echo "üè∑Ô∏è  Step 2: Tagging image for IBM Cloud..."
docker tag ${EXECUTOR_IMAGE}:latest ${REGISTRY}/${EXECUTOR_IMAGE}:latest

# Step 3: Push to IBM Cloud Registry
echo ""
echo "‚òÅÔ∏è  Step 3: Pushing to IBM Cloud Registry..."
docker push ${REGISTRY}/${EXECUTOR_IMAGE}:latest

# Step 4: Deploy to Code Engine
echo ""
echo "üö¢ Step 4: Deploying to IBM Cloud Code Engine..."

# Select project
ibmcloud ce project select -n ${PROJECT_NAME}

# Check if job exists
if ibmcloud ce job get --name code-executor &>/dev/null; then
    echo "   Updating existing job..."
    ibmcloud ce job update \
        --name code-executor \
        --image ${REGISTRY}/${EXECUTOR_IMAGE}:latest \
        --cpu 0.25 \
        --memory 512M \
        --maxexecutiontime 30 \
        --retrylimit 0
else
    echo "   Creating new job..."
    ibmcloud ce job create \
        --name code-executor \
        --image ${REGISTRY}/${EXECUTOR_IMAGE}:latest \
        --cpu 0.25 \
        --memory 512M \
        --maxexecutiontime 30 \
        --retrylimit 0
fi

# Step 5: Test the deployment
echo ""
echo "üß™ Step 5: Testing deployment..."
TEST_CODE='{"code": "print(\"Hello from Code Executor!\")", "timeout": 5}'

echo "   Submitting test job..."
JOB_RUN_NAME="test-$(date +%s)"
ibmcloud ce jobrun submit \
    --name ${JOB_RUN_NAME} \
    --job code-executor \
    --wait \
    --quiet

echo "   Checking logs..."
ibmcloud ce jobrun logs --name ${JOB_RUN_NAME}

echo ""
echo "‚úÖ Deployment complete!"
echo ""
echo "üìã Next steps:"
echo "   1. Update API route in Next.js app"
echo "   2. Test from frontend"
echo "   3. Monitor usage and costs"
echo ""
echo "üí° Usage:"
echo "   ibmcloud ce jobrun submit --name exec-test --job code-executor"
echo "   ibmcloud ce job get --name code-executor"
echo "   ibmcloud ce jobrun logs --name exec-test"
echo ""
</file>

<file path="DEPLOYMENT_GUIDE.md">
# Complete Deployment Guide - GenAI Learning Platform

## üöÄ Deploy to IBM Cloud Code Engine

This guide walks you through deploying your learning platform to IBM Cloud using the proven deployment pattern from WAR Machine.

---

## Prerequisites

### 1. IBM Cloud Account
- Sign up at https://cloud.ibm.com
- Verify your email
- Add payment method (free tier available)

### 2. IBM Cloud CLI
```bash
# macOS
brew install ibmcloud-cli

# Linux/Windows
# Download from: https://cloud.ibm.com/docs/cli?topic=cli-install-ibmcloud-cli
```

### 3. Docker
```bash
# macOS
brew install docker

# Verify installation
docker --version
```

### 4. Get Your IBM Cloud API Key
1. Log in to https://cloud.ibm.com
2. Go to: Manage ‚Üí Access (IAM) ‚Üí API keys
3. Click "Create an IBM Cloud API key"
4. Name it: `learning-platform-deploy`
5. Copy the API key (save it securely!)

### 5. Create Container Registry Namespace
1. Go to: https://cloud.ibm.com/registry/namespaces
2. Click "Create"
3. Enter a unique name (e.g., `your-name-genai`)
4. Select region: `Dallas` or `global`
5. Copy the namespace name

---

## üéØ Quick Deploy (3 Steps)

### Step 1: Set Environment Variables

```bash
# Set your IBM Cloud API key
export IBM_CLOUD_API_KEY="your-api-key-here"

# Set your container registry namespace
export NAMESPACE="your-namespace-here"

# Optional: Set region (default is us-south)
export REGION="us-south"
```

### Step 2: Make Deploy Script Executable

```bash
cd watsonx-learning-platform
chmod +x ../deploy-learning-platform.sh
```

### Step 3: Run Deployment

```bash
../deploy-learning-platform.sh
```

**Deployment takes 5-10 minutes.** You'll see progress for:
1. IBM Cloud login ‚úÖ
2. Plugin installation ‚úÖ
3. Registry setup ‚úÖ
4. Docker build ‚úÖ
5. Image push ‚úÖ
6. Code Engine deployment ‚úÖ

---

## üìã What Gets Deployed

### Infrastructure Created:
```
IBM Cloud Code Engine Project: genai-learning-platform
‚îú‚îÄ‚îÄ Application: genai-learning-platform
‚îÇ   ‚îú‚îÄ‚îÄ CPU: 1 vCPU
‚îÇ   ‚îú‚îÄ‚îÄ Memory: 2GB
‚îÇ   ‚îú‚îÄ‚îÄ Min Scale: 1 instance
‚îÇ   ‚îú‚îÄ‚îÄ Max Scale: 5 instances
‚îÇ   ‚îú‚îÄ‚îÄ Port: 3000
‚îÇ   ‚îî‚îÄ‚îÄ Auto-scaling enabled
‚îÇ
‚îî‚îÄ‚îÄ Registry Secret: icr-global
    ‚îî‚îÄ‚îÄ Pulls images from IBM Container Registry
```

### Application Stack:
```
Next.js 14 (App Router)
‚îú‚îÄ‚îÄ Frontend: React + TypeScript
‚îú‚îÄ‚îÄ Styling: Tailwind CSS
‚îú‚îÄ‚îÄ Code Editor: Monaco Editor
‚îú‚îÄ‚îÄ Icons: Lucide React
‚îî‚îÄ‚îÄ Runtime: Node.js 20 (Alpine)
```

---

## üß™ Testing Your Deployment

### 1. Get Your URL
After deployment completes, you'll see:
```
üéØ Platform URL:
   https://genai-learning-platform.xxx.xxx.appdomain.cloud
```

### 2. Test All Pages

**Homepage:**
```bash
curl https://your-url.appdomain.cloud
```
Should return HTML with "Master GenAI with Multi-Cloud Hands-On Labs"

**Labs Listing:**
```bash
curl https://your-url.appdomain.cloud/labs
```
Should return labs page HTML

**Interactive Lab:**
```bash
curl https://your-url.appdomain.cloud/labs/watsonx-first-call
```
Should return lab environment HTML

**Pricing:**
```bash
curl https://your-url.appdomain.cloud/pricing
```
Should return pricing page HTML

### 3. Test in Browser

Open your platform URL and verify:
- ‚úÖ Homepage loads with hero section
- ‚úÖ Navigation works (click Labs, Pricing)
- ‚úÖ Labs page shows all lab cards
- ‚úÖ Click "Start Lab" on first lab
- ‚úÖ Monaco editor loads with code
- ‚úÖ UI is responsive (resize window)
- ‚ö†Ô∏è "Run Code" button won't execute yet (needs backend API)

---

## üîß Next Steps: Add Backend Functionality

### What's Working Now:
‚úÖ Complete UI (all pages)
‚úÖ Responsive design
‚úÖ Navigation
‚úÖ Lab interface
‚úÖ Monaco code editor

### What Needs Backend Integration:

#### 1. Code Execution API
Create `app/api/execute/route.ts`:
```typescript
import { NextRequest, NextResponse } from 'next/server'

export async function POST(request: NextRequest) {
  const { code, labId, platform } = await request.json()
  
  // TODO: Execute code via IBM Cloud Functions
  // Call watsonx.ai API
  // Validate output
  // Return results
  
  return NextResponse.json({
    output: 'Backend API not yet connected',
    validation: {
      passed: false,
      feedback: 'Add IBM Cloud Function integration'
    }
  })
}
```

#### 2. IBM Cloud Function for Code Execution

**Create execution function:**
```python
# functions/execute_lab_code.py
from ibm_watsonx_ai.foundation_models import Model
import sys
from io import StringIO

def main(params):
    code = params.get('code', '')
    lab_id = params.get('lab_id', '')
    
    # Capture output
    old_stdout = sys.stdout
    sys.stdout = StringIO()
    
    try:
        # Execute student code
        exec(code, {
            '__name__': '__main__',
            'Model': Model,
            # Add other safe imports
        })
        
        output = sys.stdout.getvalue()
        sys.stdout = old_stdout
        
        # Validate based on lab
        validation = validate_output(lab_id, output)
        
        return {
            'statusCode': 200,
            'body': {
                'success': True,
                'output': output,
                'validation': validation
            }
        }
    except Exception as e:
        sys.stdout = old_stdout
        return {
            'statusCode': 500,
            'body': {
                'success': False,
                'error': str(e)
            }
        }

def validate_output(lab_id, output):
    if lab_id == 'watsonx-first-call':
        # Check for successful API call
        checks = {
            'has_output': len(output) > 0,
            'no_errors': 'Error' not in output and 'Traceback' not in output,
            'ai_response': any(word in output.lower() for word in ['artificial', 'intelligence', 'ai'])
        }
        
        passed = all(checks.values())
        
        return {
            'passed': passed,
            'checks': checks,
            'feedback': 'Great! Your code works.' if passed else 'Check your code for errors.'
        }
    
    return {'passed': False, 'feedback': 'Unknown lab'}
```

**Deploy function:**
```bash
# Create IBM Cloud Function
ibmcloud fn action create execute-lab \
  --kind python:3.11 \
  execute_lab_code.py \
  --web true
  
# Get function URL
ibmcloud fn action get execute-lab --url
```

**Update Next.js API route:**
```typescript
// app/api/execute/route.ts
const FUNCTION_URL = process.env.IBM_FUNCTION_URL

export async function POST(request: NextRequest) {
  const { code, labId, platform } = await request.json()
  
  const response = await fetch(FUNCTION_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      code,
      lab_id: labId,
      platform
    })
  })
  
  const result = await response.json()
  return NextResponse.json(result.body)
}
```

#### 3. Authentication (Clerk)

```bash
# Install Clerk
npm install @clerk/nextjs

# Get keys from https://clerk.com
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_xxx
CLERK_SECRET_KEY=sk_xxx
```

**Add to layout:**
```typescript
// app/layout.tsx
import { ClerkProvider } from '@clerk/nextjs'

export default function RootLayout({ children }) {
  return (
    <ClerkProvider>
      <html>
        <body>{children}</body>
      </html>
    </ClerkProvider>
  )
}
```

#### 4. Database (Supabase)

```bash
# Get URL from https://supabase.com
DATABASE_URL=postgresql://xxx
SUPABASE_ANON_KEY=xxx
```

**Create tables:**
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY,
  email TEXT UNIQUE,
  tier TEXT DEFAULT 'free',
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE lab_progress (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES users(id),
  lab_id TEXT,
  completed BOOLEAN DEFAULT FALSE,
  attempts INTEGER DEFAULT 0
);
```

#### 5. Payments (Stripe)

```bash
npm install stripe

STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
```

---

## üîÑ Update Your Deployment

After making code changes:

```bash
# 1. Build new image
docker build --platform linux/amd64 -f Dockerfile.prod -t genai-learning-platform:latest .

# 2. Tag for registry
docker tag genai-learning-platform:latest \
  icr.io/${NAMESPACE}/genai-learning-platform:latest

# 3. Push to registry
docker push icr.io/${NAMESPACE}/genai-learning-platform:latest

# 4. Update Code Engine app
ibmcloud ce app update --name genai-learning-platform \
  --image icr.io/${NAMESPACE}/genai-learning-platform:latest
```

Or simply re-run the deploy script:
```bash
./deploy-learning-platform.sh
```

---

## üìä Monitoring

### View Application Logs
```bash
# Real-time logs
ibmcloud ce app logs --name genai-learning-platform --follow

# Recent logs
ibmcloud ce app logs --name genai-learning-platform --tail 100
```

### Check Application Status
```bash
ibmcloud ce app get --name genai-learning-platform
```

### View Metrics
```bash
# CPU/Memory usage
ibmcloud ce app events --name genai-learning-platform
```

---

## üí∞ Cost Management

### Free Tier Includes:
- **100,000 vCPU-seconds/month** (enough for demo)
- **400,000 GB-seconds/month** of memory

### Estimated Costs:
```
Light usage (demo/testing):
  ~$5-10/month

Medium usage (100 users/day):
  ~$20-40/month

Heavy usage (1000 users/day):
  ~$100-200/month
```

### Set Budget Alerts:
1. Go to: https://cloud.ibm.com/billing
2. Click "Manage ‚Üí Billing and usage ‚Üí Spending"
3. Set spending alerts at $20, $50, $100

### Reduce Costs:
```bash
# Scale down when not in use
ibmcloud ce app update --name genai-learning-platform --min-scale 0

# Scale back up
ibmcloud ce app update --name genai-learning-platform --min-scale 1
```

---

## üóëÔ∏è Cleanup

### Delete Everything:
```bash
# Delete the entire project (app + config)
ibmcloud ce project delete --name genai-learning-platform --force

# Delete container images
ibmcloud cr image-rm icr.io/${NAMESPACE}/genai-learning-platform:latest
```

### Keep Project, Delete App Only:
```bash
ibmcloud ce app delete --name genai-learning-platform --force
```

---

## üêõ Troubleshooting

### Issue: "Namespace not found"
**Solution:**
```bash
# List namespaces
ibmcloud cr namespaces

# Create if missing
ibmcloud cr namespace-add your-namespace-name
```

### Issue: "Docker build fails"
**Solution:**
```bash
# Ensure you're in the project directory
cd watsonx-learning-platform

# Check Docker is running
docker ps

# Try building manually first
docker build -f Dockerfile.prod -t test .
```

### Issue: "App won't start"
**Solution:**
```bash
# Check logs
ibmcloud ce app logs --name genai-learning-platform --tail 100

# Common fixes:
# 1. Ensure PORT env var is set
# 2. Check package.json scripts
# 3. Verify next.config.js has output: 'standalone'
```

### Issue: "High costs"
**Solution:**
```bash
# Check current scaling
ibmcloud ce app get --name genai-learning-platform

# Reduce max scale
ibmcloud ce app update --name genai-learning-platform --max-scale 2

# Set min-scale to 0 for demos
ibmcloud ce app update --name genai-learning-platform --min-scale 0
```

---

## üìû Support Resources

### IBM Cloud Documentation:
- Code Engine: https://cloud.ibm.com/docs/codeengine
- Container Registry: https://cloud.ibm.com/docs/Registry
- CLI Reference: https://cloud.ibm.com/docs/cli

### Community:
- IBM Cloud Community: https://community.ibm.com/community/user/cloud
- Stack Overflow: [ibm-cloud] tag
- GitHub Issues: (your repo)

---

## ‚úÖ Deployment Checklist

Before going live:

- [ ] UI tested on desktop, tablet, mobile
- [ ] All pages load correctly
- [ ] Navigation works
- [ ] Lab editor displays properly
- [ ] Backend API integrated
- [ ] Authentication working
- [ ] Database connected
- [ ] Payments configured
- [ ] Error handling added
- [ ] Analytics setup
- [ ] Budget alerts configured
- [ ] Monitoring enabled
- [ ] SSL certificate (automatic with Code Engine)
- [ ] Custom domain configured (optional)

---

## üéâ You're Live!

Once deployed, your platform is:
- ‚úÖ Running on IBM Cloud Code Engine
- ‚úÖ Auto-scaling based on traffic
- ‚úÖ Using IBM Container Registry
- ‚úÖ HTTPS enabled by default
- ‚úÖ Monitoring with IBM Cloud metrics
- ‚úÖ Ready for watsonx.ai integration

**Next:** Connect the backend API so labs can execute code! üöÄ
</file>

<file path="DEPLOYMENT_REFERENCE.md">
# Deployment Quick Reference

## üöÄ First Time Deployment

### Prerequisites
```bash
export IBM_CLOUD_API_KEY="your-api-key-here"
export NAMESPACE="ranga"  # Your container registry namespace
```

### Deploy
```bash
chmod +x deploy-production.sh
./deploy-production.sh
```

**First run will:**
1. Create Service ID: `ce-registry-access`
2. Create API key: `ce-registry-key`
3. Grant Container Registry Reader access
4. Build and push Docker image
5. Deploy to Code Engine

**‚ö†Ô∏è IMPORTANT:** Save the Service API Key that's displayed! You'll need it for subsequent deployments.

---

## üîÑ Subsequent Deployments

### If you have the Service API Key saved:
```bash
export IBM_CLOUD_API_KEY="your-main-api-key"
export NAMESPACE="ranga"
export SERVICE_API_KEY="your-saved-service-api-key"

./deploy-production.sh
```

### If you lost the Service API Key:
```bash
# Delete old key and regenerate
ibmcloud iam service-api-key-delete ce-registry-access ce-registry-key -f

# Then run deploy script (it will create a new one)
./deploy-production.sh
```

---

## üìù What the Script Does

### Phase 1: IAM Setup (One-time)
- Creates Service ID for Code Engine
- Creates API key for that Service ID
- Grants Container Registry Reader access
- **Idempotent:** Safe to run multiple times

### Phase 2: Build & Push
- Creates optimized Docker image
- Pushes to IBM Container Registry
- Uses multi-stage build (small production image)

### Phase 3: Deploy
- Creates/updates Code Engine project
- Creates registry secret with Service ID credentials
- Deploys application with auto-scaling
- Returns live URL

---

## üõ†Ô∏è Common Commands

### Check Deployment Status
```bash
ibmcloud ce project select -n genai-learning-platform
ibmcloud ce app get --name genai-learning-platform
```

### View Logs
```bash
ibmcloud ce app logs --name genai-learning-platform --follow
```

### Update After Code Changes
```bash
# Just re-run the deploy script
./deploy-production.sh
```

### Scale Application
```bash
# Scale up
ibmcloud ce app update --name genai-learning-platform --max-scale 10

# Scale down (save costs)
ibmcloud ce app update --name genai-learning-platform --min-scale 0
```

### Check Costs
```bash
# View current usage
ibmcloud ce project current

# Check billing
ibmcloud billing account-usage
```

---

## üßπ Cleanup

### Delete Application Only
```bash
ibmcloud ce app delete --name genai-learning-platform --force
```

### Delete Entire Project
```bash
ibmcloud ce project delete --name genai-learning-platform --force
```

### Delete Service ID (Complete Cleanup)
```bash
ibmcloud iam service-id-delete ce-registry-access -f
```

### Delete Container Image
```bash
ibmcloud cr image-rm icr.io/ranga/genai-learning-platform:latest
```

---

## üêõ Troubleshooting

### Issue: "Service ID already exists"
**Solution:** Export the existing SERVICE_API_KEY:
```bash
export SERVICE_API_KEY="your-saved-key"
./deploy-production.sh
```

### Issue: "Unable to fetch image"
**Solution:** Recreate registry secret:
```bash
ibmcloud ce project select -n genai-learning-platform
ibmcloud ce registry delete --name icr-global --force
ibmcloud ce registry create \
  --name icr-global \
  --server icr.io \
  --username iamapikey \
  --password "$SERVICE_API_KEY"
```

### Issue: "Build fails"
**Solution:** Check Docker is running and node_modules exists:
```bash
docker ps  # Should not error
npm install  # Ensure dependencies are installed
```

### Issue: "App crashes on startup"
**Solution:** Check logs:
```bash
ibmcloud ce app logs --name genai-learning-platform --tail 100
```

Common causes:
- Missing `next.config.js` with `output: 'standalone'`
- Wrong PORT environment variable
- Node version mismatch

---

## üìä Monitoring & Metrics

### Real-time Status
```bash
ibmcloud ce app get --name genai-learning-platform
```

### Application Events
```bash
ibmcloud ce app events --name genai-learning-platform
```

### Resource Usage
```bash
ibmcloud ce app get --name genai-learning-platform --output json | jq '.status'
```

---

## üí∞ Cost Optimization

### For Development/Demo
```bash
# Scale to zero when not in use
ibmcloud ce app update --name genai-learning-platform --min-scale 0

# Reduce resources
ibmcloud ce app update --name genai-learning-platform \
  --cpu 0.5 \
  --memory 1G
```

### For Production
```bash
# Ensure availability
ibmcloud ce app update --name genai-learning-platform \
  --min-scale 2 \
  --max-scale 10

# Set budget alerts in IBM Cloud Console
```

---

## üîê Security Best Practices

### Rotate API Keys Regularly
```bash
# Delete old key
ibmcloud iam service-api-key-delete ce-registry-access ce-registry-key -f

# Create new key
ibmcloud iam service-api-key-create ce-registry-key ce-registry-access \
  --description "Rotated $(date +%Y-%m-%d)"

# Update registry secret (script does this automatically)
```

### Use Environment Variables for Secrets
```bash
# Add secrets to Code Engine
ibmcloud ce app update --name genai-learning-platform \
  --env IBM_WATSONX_API_KEY=secret:watsonx-key
```

### Enable HTTPS Only
```bash
# Code Engine automatically provides HTTPS
# Your URLs are: https://...appdomain.cloud
```

---

## üéØ Quick Tips

1. **Always save the Service API Key** when it's first created
2. **Set min-scale to 0** during development to save costs
3. **Use `--force` flags** to avoid interactive prompts in scripts
4. **Tag images** with versions for rollback capability:
   ```bash
   docker tag genai-learning-platform:latest icr.io/ranga/genai-learning-platform:v1.0.0
   ```
5. **Monitor logs** during first deployment to catch issues early

---

## üìö Resources

- **IBM Code Engine Docs:** https://cloud.ibm.com/docs/codeengine
- **IBM Container Registry:** https://cloud.ibm.com/docs/Registry
- **Service IDs & API Keys:** https://cloud.ibm.com/docs/account?topic=account-serviceids
- **Your Platform:** https://genai-learning-platform.24rtt3srkwax.us-south.codeengine.appdomain.cloud

---

## ‚úÖ Deployment Checklist

Before deploying:
- [ ] Docker Desktop is running
- [ ] `npm install` completed successfully
- [ ] Environment variables set (IBM_CLOUD_API_KEY, NAMESPACE)
- [ ] IBM Cloud CLI installed and updated
- [ ] You have saved the Service API Key (if exists)

After deploying:
- [ ] Platform URL works in browser
- [ ] All pages load (/, /labs, /pricing)
- [ ] Monaco editor loads in lab environment
- [ ] No console errors (check browser DevTools)
- [ ] Set up monitoring/alerts
- [ ] Share URL with testers

---

**Need Help?** Check the main README.md or create an issue!
</file>

<file path="diagnose-registry.sh">
#!/usr/bin/env bash

# Registry Diagnostic Script

: "${NAMESPACE:?Set NAMESPACE}"

echo "üîç Registry Diagnostic Check"
echo "=================================================="
echo ""

# 1. Login to registry
echo "==> 1. Logging into Container Registry"
ibmcloud cr login
ibmcloud cr region-set global

# 2. List all namespaces
echo ""
echo "==> 2. Your Container Registry Namespaces:"
ibmcloud cr namespaces
echo ""

# 3. List all images in the namespace
echo "==> 3. Images in namespace '${NAMESPACE}':"
ibmcloud cr image-list --restrict "${NAMESPACE}"
echo ""

# 4. Check if namespace exists
echo "==> 4. Verifying namespace '${NAMESPACE}' exists"
if ibmcloud cr namespaces | grep -q "^${NAMESPACE}$"; then
  echo "‚úÖ Namespace '${NAMESPACE}' exists"
else
  echo "‚ùå Namespace '${NAMESPACE}' not found!"
  echo ""
  echo "Available namespaces:"
  ibmcloud cr namespaces
  echo ""
  echo "To create it:"
  echo "  ibmcloud cr namespace-add ${NAMESPACE}"
fi

# 5. Try to inspect the specific image
echo ""
echo "==> 5. Trying to inspect the pushed image"
IMAGE="icr.io/${NAMESPACE}/genai-learning-platform:latest"
echo "Looking for: ${IMAGE}"
ibmcloud cr image-inspect "${IMAGE}" || echo "Image not found at this path"

# 6. List recent images
echo ""
echo "==> 6. Recent images (all namespaces):"
ibmcloud cr image-list | head -20

echo ""
echo "=================================================="
echo "Diagnostic complete"
echo "=================================================="
</file>

<file path="Dockerfile.prod">
# Build stage
FROM node:20-alpine AS builder

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy source code
COPY . .

# Build Next.js app
ENV NEXT_TELEMETRY_DISABLED 1
RUN npm run build

# Production stage
FROM node:20-alpine AS runner

WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

# Create non-root user
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# Copy necessary files from builder
COPY --from=builder /app/public ./public
COPY --from=builder /app/package*.json ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
</file>

<file path="fix-deployment.sh">
#!/usr/bin/env bash
set -euo pipefail

# Comprehensive Fix for Registry Authentication Issue

: "${IBM_CLOUD_API_KEY:?Set IBM_CLOUD_API_KEY}"
: "${NAMESPACE:?Set NAMESPACE}"

PROJECT_NAME="genai-learning-platform"
REGISTRY_SERVER="icr.io"
REGION="us-south"

echo "üîß Comprehensive Registry Authentication Fix"
echo "=================================================="
echo ""

# Step 1: Verify registry access
echo "==> 1. Verifying Container Registry access"
ibmcloud cr login
ibmcloud cr region-set global

# Step 2: Check if image exists
echo ""
echo "==> 2. Checking if image exists in registry"
if ibmcloud cr image-list | grep -q "${NAMESPACE}/genai-learning-platform"; then
  echo "‚úÖ Image found in registry"
else
  echo "‚ùå Image not found!"
  echo "Image should be at: ${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"
  echo "Please verify the NAMESPACE is correct"
  exit 1
fi

# Step 3: Grant public access to image (simplest fix for PoC)
echo ""
echo "==> 3. Making image publicly accessible (for PoC)"
ibmcloud cr image-inspect "${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest" 2>/dev/null || true

# Alternative: Make namespace public
echo ""
echo "==> 4. Setting namespace to public access"
echo "This allows Code Engine to pull without authentication issues"
# Note: This is fine for a demo/PoC, for production use private with proper IAM

# Step 5: Select Code Engine project
echo ""
echo "==> 5. Selecting Code Engine project"
ibmcloud ce project select -n "${PROJECT_NAME}"

# Step 6: Recreate registry secret
echo ""
echo "==> 6. Recreating registry secret with fresh credentials"
ibmcloud ce registry delete --name icr-global --force 2>/dev/null || true

ibmcloud ce registry create \
  --name icr-global \
  --server "${REGISTRY_SERVER}" \
  --username iamapikey \
  --password "${IBM_CLOUD_API_KEY}"

# Step 7: Delete and recreate the application
echo ""
echo "==> 7. Recreating application from scratch"
ibmcloud ce app delete --name "genai-learning-platform" --force --ignore-not-found

sleep 5

APP_IMAGE="${REGISTRY_SERVER}/${NAMESPACE}/genai-learning-platform:latest"

echo "Creating application with image: ${APP_IMAGE}"

ibmcloud ce app create \
  --name "genai-learning-platform" \
  --image "${APP_IMAGE}" \
  --registry-secret icr-global \
  --port 3000 \
  --cpu 1 \
  --memory 2G \
  --min-scale 1 \
  --max-scale 5 \
  --env NODE_ENV=production

# Step 8: Wait and verify
echo ""
echo "==> 8. Waiting for application to start..."
sleep 20

# Check status
echo ""
echo "==> 9. Checking application status"
ibmcloud ce app get --name "genai-learning-platform"

APP_URL=$(ibmcloud ce app get --name "genai-learning-platform" 2>/dev/null | grep "URL:" | awk '{print $2}')

echo ""
echo "=================================================="
echo "‚úÖ Application Deployed!"
echo "=================================================="
echo ""
echo "üéØ Platform URL:"
echo "   ${APP_URL}"
echo ""
echo "üß™ Test it:"
echo "   curl ${APP_URL}"
echo ""
echo "üìä View logs:"
echo "   ibmcloud ce app logs --name genai-learning-platform --follow"
echo ""
echo "=================================================="
</file>

<file path="next-env.d.ts">
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/basic-features/typescript for more information.
</file>

<file path="next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone',
  images: {
    domains: ['images.unsplash.com'],
  },
}

module.exports = nextConfig
</file>

<file path="package.json">
{
  "name": "watsonx-learning-platform",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@anthropic-ai/sdk": "^0.71.2",
    "@monaco-editor/react": "^4.6.0",
    "clsx": "^2.1.0",
    "lucide-react": "^0.316.0",
    "next": "14.1.0",
    "react": "^18",
    "react-dom": "^18",
    "tailwind-merge": "^2.2.1",
    "youtube-transcript": "^1.2.1"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "autoprefixer": "^10.0.1",
    "eslint": "^8",
    "eslint-config-next": "14.1.0",
    "postcss": "^8",
    "tailwindcss": "^3.3.0",
    "typescript": "^5"
  }
}
</file>

<file path="postcss.config.js">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="PROJECT_SUMMARY.md">
# üéâ Project Complete: Multi-Cloud GenAI Learning Platform

## What You Have Built

A **production-ready learning platform** for teaching IBM watsonx.ai and AWS Bedrock, featuring:

‚úÖ **Complete UI** - 5 pages, fully responsive, IBM-branded
‚úÖ **Interactive Labs** - Monaco code editor with syntax highlighting
‚úÖ **Deployment Script** - One-command deploy to IBM Cloud Code Engine
‚úÖ **Proven Architecture** - Based on successful WAR Machine deployment

---

## üì¶ Download Package Contents

### 1. **watsonx-learning-platform.tar.gz** (Main Application)
Complete Next.js application with:
- Homepage with hero + features
- Labs listing with filtering
- Interactive lab environment
- Pricing page with 4 tiers
- Responsive navigation

### 2. **deploy-learning-platform.sh** (Deployment Script)
One-command deployment to IBM Cloud:
```bash
export IBM_CLOUD_API_KEY="your-key"
export NAMESPACE="your-namespace"
./deploy-learning-platform.sh
```

### 3. **Documentation Files**
- `QUICKSTART.md` - Get running in 3 minutes
- `FILE_STRUCTURE.md` - Code locations and patterns
- `VISUAL_GUIDE.md` - UI component reference
- `DEPLOYMENT_GUIDE.md` - Complete IBM Cloud setup
- `README.md` - Full technical docs

---

## üöÄ From Download to Live in 15 Minutes

### Step 1: Extract & Setup (2 minutes)
```bash
tar -xzf watsonx-learning-platform.tar.gz
cd watsonx-learning-platform
npm install
```

### Step 2: Test Locally (1 minute)
```bash
npm run dev
# Visit http://localhost:3000
```

### Step 3: Deploy to IBM Cloud (10 minutes)
```bash
export IBM_CLOUD_API_KEY="your-api-key-here"
export NAMESPACE="your-container-registry-namespace"
chmod +x ../deploy-learning-platform.sh
../deploy-learning-platform.sh
```

### Step 4: You're Live! (2 minutes)
```
‚úÖ Platform URL: https://genai-learning-platform.xxx.appdomain.cloud
```

---

## ‚úÖ Current Status: UI = 100% Complete

### What's Working Right Now:

**‚úÖ Homepage**
- Hero section with CTAs
- Platform comparison (IBM vs AWS)
- How it works section
- Social proof stats
- Final CTA section

**‚úÖ Labs Listing**
- Filter by platform (watsonx.ai, AWS Bedrock)
- Filter by difficulty (Beginner, Intermediate, Advanced)
- Lab cards with metadata (duration, tier, platform)
- Tier badges (Free, Standard, Pro)
- "Start Lab" buttons

**‚úÖ Interactive Lab Environment**
- Monaco code editor (VS Code experience)
- Syntax highlighting for Python
- Instructions panel with hints
- Output console (terminal style)
- Run/Reset/Hint buttons
- Validation feedback display
- API key/Project ID resources

**‚úÖ Pricing Page**
- 4 pricing tiers (Free, Standard, Pro, Business)
- Feature comparison table
- FAQ section
- CTA sections

**‚úÖ Navigation**
- Responsive design (desktop + mobile)
- Hamburger menu for mobile
- Logo with branding
- Main menu links
- Sign In / Start Learning CTAs

---

## ‚ö†Ô∏è What Needs Backend Integration

### Phase 1: Code Execution (Week 1)
**File to Create:** `app/api/execute/route.ts`

**What it does:**
- Receives code from frontend
- Calls IBM Cloud Function
- Executes code via watsonx.ai
- Returns output + validation

**Estimated Work:** 1-2 days

### Phase 2: IBM Cloud Function (Week 1)
**File to Create:** `functions/execute_lab_code.py`

**What it does:**
- Sandboxed Python execution
- Calls watsonx.ai API
- Validates output against expected results
- Returns success/failure feedback

**Estimated Work:** 2-3 days

### Phase 3: Authentication (Week 2)
**Service:** Clerk (https://clerk.com)

**What it does:**
- User sign-up/sign-in
- Session management
- Tier tracking (Free/Standard/Pro)
- Protected routes

**Estimated Work:** 1 day

### Phase 4: Database (Week 2)
**Service:** Supabase (https://supabase.com)

**What it stores:**
- User profiles
- Lab progress
- Code submissions
- Completion certificates

**Estimated Work:** 2 days

### Phase 5: Payments (Week 3)
**Service:** Stripe (https://stripe.com)

**What it handles:**
- Subscription management
- Tier upgrades
- Webhooks
- Receipt generation

**Estimated Work:** 2-3 days

---

## üìä Project Roadmap

### ‚úÖ **Completed (Today)**
- [x] Complete UI design and implementation
- [x] Interactive lab environment with Monaco editor
- [x] Responsive design (mobile, tablet, desktop)
- [x] IBM Cloud deployment script
- [x] Comprehensive documentation

### üîß **Week 1: Make Labs Functional**
- [ ] Create `/api/execute` endpoint
- [ ] Deploy IBM Cloud Function for code execution
- [ ] Connect watsonx.ai API
- [ ] Test full lab execution flow

### üîí **Week 2: Add User Management**
- [ ] Integrate Clerk authentication
- [ ] Setup Supabase database
- [ ] Implement progress tracking
- [ ] Add user dashboard

### üí≥ **Week 3: Monetization**
- [ ] Stripe integration
- [ ] Subscription checkout flow
- [ ] Tier upgrade logic
- [ ] Receipt/invoice system

### üöÄ **Week 4: Launch**
- [ ] Beta testing (50 users)
- [ ] Bug fixes
- [ ] Performance optimization
- [ ] Public launch

---

## üí∞ Cost Breakdown

### Development Costs (If Hiring)
```
UI Development: COMPLETE ($0 - already built)
Backend API: $2,000-4,000 (1-2 weeks)
Authentication: $500-1,000 (integrated service)
Database: $500-1,000 (setup + schema)
Payments: $1,000-2,000 (Stripe integration)
Testing: $1,000-2,000 (QA + bug fixes)
Total: $5,000-10,000
```

### Monthly Operating Costs
```
IBM Cloud Code Engine:
  Light usage (demo): $10-20/month
  Medium usage (100 users/day): $30-50/month
  Heavy usage (1000 users/day): $150-300/month

watsonx.ai API:
  Pay-per-use, ~$0.001 per 1K tokens
  Estimated: $50-200/month depending on usage

Clerk (Auth):
  Free tier: 5,000 MAU (monthly active users)
  Pro: $25/month for 10,000 MAU

Supabase (Database):
  Free tier: Good for PoC
  Pro: $25/month (500GB storage)

Stripe (Payments):
  2.9% + $0.30 per transaction
  No monthly fee

Total Operating Cost:
  PoC/MVP: $100-200/month
  With 500 users: $300-500/month
  With 5000 users: $800-1500/month
```

---

## üìà Revenue Projections

### Conservative Scenario (Year 1)
```
Month 3:  50 users  √ó $29 (Standard) = $1,450/month
Month 6:  200 users √ó $29 = $5,800/month
Month 9:  500 users √ó $29 = $14,500/month
Month 12: 1000 users √ó $29 = $29,000/month

Year 1 ARR: ~$180,000
```

### Optimistic Scenario (Year 1)
```
Month 3:  100 users (80 Standard, 20 Pro) = $3,900/month
Month 6:  500 users (400 Std, 100 Pro) = $19,500/month
Month 9:  1500 users (1200 Std, 300 Pro) = $58,500/month
Month 12: 3000 users (2400 Std, 600 Pro) = $117,000/month

Year 1 ARR: ~$600,000
```

---

## üéØ Go-to-Market Strategy

### Phase 1: Soft Launch (Weeks 1-4)
**Target:** 100 beta users

**Tactics:**
- Post on Reddit (r/aws, r/machinelearning, r/IBM)
- Share on LinkedIn (AI/ML groups)
- Tweet with hashtags (#BuildInPublic, #GenAI)
- Email to Udemy course students (if you have list)

**Goal:** Validate product-market fit

### Phase 2: Partnership Push (Weeks 5-12)
**Target:** IBM partnership + 500 users

**Tactics:**
- Email IBM watsonx.ai partnerships team
- Apply to IBM partner program
- Get featured in IBM marketplace
- Co-marketing webinars

**Goal:** IBM co-marketing deal

### Phase 3: Content Marketing (Weeks 13-26)
**Target:** 2,000 users

**Tactics:**
- Blog posts on Medium/Dev.to
- YouTube tutorials
- Podcast appearances
- LinkedIn influencer partnerships

**Goal:** Organic growth via SEO

### Phase 4: Enterprise Sales (Weeks 27-52)
**Target:** 10 enterprise customers (Business tier)

**Tactics:**
- Direct outreach to Fortune 500 banks, healthcare
- Attend IBM/AWS conferences
- Partner with corporate training firms
- White-label version for resellers

**Goal:** High-value B2B contracts

---

## ü§ù Partnership Opportunities

### IBM Partnership (High Priority)
**Status:** Ready to pitch (have working PoC)

**What to Propose:**
- Featured in IBM Cloud Marketplace
- Co-marketing budget ($50K-200K)
- Enterprise lead referrals
- Early access to new watsonx features

**What They Get:**
- More watsonx.ai adoption
- Training content they don't have to build
- Enterprise customer success stories
- Product feedback loop

**Next Action:** Email template in PoC docs

### AWS Partner Network (Medium Priority)
**Status:** Can apply once AWS Bedrock labs work

**Benefits:**
- AWS credits ($10K-100K)
- Co-marketing opportunities
- Access to AWS enterprise customers
- Featured in AWS training partner directory

### Corporate Training Partners (Medium Priority)
**Examples:** Coursera, Udacity, Pluralsight

**Pitch:** White-label our platform for their enterprise customers

---

## üéì Competitive Advantages

### vs. Traditional Video Courses (Udemy, Coursera)
‚úÖ **Hands-on** - Code in browser, not just watch
‚úÖ **Instant validation** - Know if you're doing it right
‚úÖ **Multi-cloud** - Learn both IBM and AWS
‚úÖ **AI tutor** - Get help when stuck

### vs. Cloud Provider Training (AWS, IBM)
‚úÖ **Neutral** - Not vendor-locked
‚úÖ **Comparative** - See differences between platforms
‚úÖ **Affordable** - $29/mo vs. $300+ for official courses
‚úÖ **Community** - Discord, not just forums

### vs. Coding Bootcamps (Lambda School, etc.)
‚úÖ **Self-paced** - Learn on your schedule
‚úÖ **Specific** - Focus on GenAI, not general coding
‚úÖ **Cheaper** - $29/mo vs. $10K-20K bootcamp
‚úÖ **Certification-focused** - Clear outcome (AWS cert)

---

## üìû Next Steps - Choose Your Path

### Option 1: Deploy & Demo (Recommended First)
**Time:** 1 hour
**Steps:**
1. Run deploy script
2. Get live URL
3. Share with 5 friends for feedback
4. Iterate on UI based on feedback

### Option 2: Build Backend API
**Time:** 1 week
**Steps:**
1. Create `/api/execute` endpoint
2. Setup IBM Cloud Function
3. Connect watsonx.ai API
4. Test with real code execution

### Option 3: Raise Funding
**Time:** 1-2 months
**Steps:**
1. Deploy live demo
2. Get 50 beta users
3. Create pitch deck with metrics
4. Apply to YC, seed funds, or angels

### Option 4: Bootstrap to Revenue
**Time:** 3-6 months
**Steps:**
1. Deploy + backend API (Weeks 1-2)
2. Add auth + database (Weeks 3-4)
3. Soft launch, get 100 users (Weeks 5-8)
4. Add payments, start charging (Week 9)
5. Scale to $10K MRR (Weeks 10-26)

---

## üéâ Congratulations!

You now have:
‚úÖ **Production-ready UI** (5 pages, professional design)
‚úÖ **Deployment script** (one-command deploy)
‚úÖ **Proven architecture** (IBM Code Engine, based on successful project)
‚úÖ **Complete documentation** (setup, deployment, roadmap)
‚úÖ **Clear roadmap** (4-week plan to full functionality)

**This is a REAL product, ready to deploy and demo.**

---

## üöÄ Ready to Launch?

**Choose your next step:**

1. **Deploy Now** ‚Üí Run `deploy-learning-platform.sh`
2. **Build Backend** ‚Üí Create `/api/execute` endpoint
3. **Get Feedback** ‚Üí Share with 10 users
4. **Pitch IBM** ‚Üí Email partnership team

**Or all of the above!** üéØ

---

## üìß Questions?

Check the docs:
- QUICKSTART.md - Get running fast
- DEPLOYMENT_GUIDE.md - IBM Cloud setup
- FILE_STRUCTURE.md - Code locations
- VISUAL_GUIDE.md - UI reference

**You've got this!** üöÄüí™
</file>

<file path="quick-fix.sh">
#!/usr/bin/env bash

# Quick Fix for Docker Build Issue

echo "üîß Fixing Docker Build Issue..."
echo ""

# 1. Create public directory
echo "Creating public directory..."
mkdir -p public
touch public/.gitkeep
echo "‚úÖ Public directory created"

# 2. Fix next.config.js
echo ""
echo "Updating next.config.js for standalone build..."
cat > next.config.js << 'EOF'
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'standalone',
  images: {
    unoptimized: true,
    domains: ['images.unsplash.com'],
  },
}

module.exports = nextConfig
EOF
echo "‚úÖ next.config.js updated"

# 3. Create fixed Dockerfile
echo ""
echo "Creating fixed Dockerfile..."
cat > Dockerfile.prod << 'EOF'
# Build stage
FROM node:20-alpine AS builder

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy source code
COPY . .

# Ensure public directory exists
RUN mkdir -p public

# Build Next.js app
ENV NEXT_TELEMETRY_DISABLED=1
RUN npm run build

# Production stage
FROM node:20-alpine AS runner

WORKDIR /app

ENV NODE_ENV=production
ENV NEXT_TELEMETRY_DISABLED=1

# Create non-root user
RUN addgroup --system --gid 1001 nodejs && \
    adduser --system --uid 1001 nextjs

# Copy package files
COPY --from=builder /app/package*.json ./

# Copy public folder
COPY --from=builder /app/public ./public

# Copy standalone build
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

CMD ["node", "server.js"]
EOF
echo "‚úÖ Dockerfile.prod created"

echo ""
echo "=================================================="
echo "‚úÖ All fixes applied!"
echo "=================================================="
echo ""
echo "Now try building again:"
echo "  docker build -f Dockerfile.prod -t test ."
echo ""
echo "Or run the deployment script:"
echo "  ./deploy-learning-platform.sh"
echo ""
</file>

<file path="README.md">
# Week 1: Code Execution Backend - README

## üéØ Goal
Build a secure, scalable code execution backend that runs Python code in isolated Docker containers.

---

## üìÇ File Structure

```
code-executor/
‚îú‚îÄ‚îÄ Dockerfile              # Docker image for code execution
‚îú‚îÄ‚îÄ execute.py              # Python script that runs user code
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ deploy.sh               # Deployment script for IBM Cloud
‚îî‚îÄ‚îÄ test-local.sh          # Local testing script

app/api/execute/
‚îî‚îÄ‚îÄ route.ts                # Next.js API endpoint
```

---

## üöÄ Quick Start

### Prerequisites
- Docker installed and running
- IBM Cloud CLI installed and logged in
- Node.js 20+ for Next.js app

### Step 1: Build Docker Image Locally

```bash
cd code-executor
docker build -t code-executor:latest .
```

### Step 2: Test Locally

```bash
# Test the Docker container
echo '{"code": "print(\"Hello World!\")", "timeout": 5}' | \
  docker run --rm -i code-executor:latest

# Expected output:
# {"status": "success", "output": "Hello World!\n", "error": "", "execution_time": 15}
```

### Step 3: Deploy to IBM Cloud

```bash
# Make script executable
chmod +x deploy.sh

# Run deployment
./deploy.sh
```

### Step 4: Add API Route to Next.js

```bash
# Copy the API route file
cp app-api-execute-route.ts \
   ~/Code/work/star-edtech/watsonx-learning-platform/app/api/execute/route.ts

# Redeploy Next.js app
cd ~/Code/work/star-edtech/watsonx-learning-platform
./deploy-learning-platform.sh
```

---

## üß™ Testing

### Test 1: Basic Execution

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "print(\"Hello from API!\")",
    "language": "python"
  }'
```

Expected:
```json
{
  "status": "success",
  "output": "Hello from API!\n",
  "executionTime": 234
}
```

### Test 2: Error Handling

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "raise ValueError(\"Test error\")",
    "language": "python"
  }'
```

Expected:
```json
{
  "status": "error",
  "output": "",
  "error": "Traceback...\nValueError: Test error",
  "executionTime": 125
}
```

### Test 3: Timeout

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type": application/json" \
  -d '{
    "code": "import time\ntime.sleep(35)",
    "language": "python",
    "timeout": 5
  }'
```

Expected:
```json
{
  "status": "timeout",
  "error": "Execution exceeded 5 second timeout",
  "executionTime": 5000
}
```

### Test 4: With Libraries

```bash
curl -X POST http://localhost:3000/api/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "import json\ndata = {\"test\": 123}\nprint(json.dumps(data))",
    "language": "python"
  }'
```

Expected:
```json
{
  "status": "success",
  "output": "{\"test\": 123}\n",
  "executionTime": 180
}
```

---

## üîí Security Features

### 1. Resource Limits
- **Memory:** 512MB max
- **CPU:** 0.5 cores
- **Time:** 30 seconds max
- **Output:** 1MB max

### 2. Code Validation
Blocks dangerous operations:
- `import os`
- `import subprocess`
- `eval()`, `exec()`, `compile()`
- `open()` (file access)
- `__import__`

### 3. Network Isolation
- Docker containers run with `--network=none`
- No internet access
- No localhost access

### 4. Rate Limiting
- 10 requests per minute per IP
- Prevents DOS attacks

### 5. User Isolation
- Code runs as non-root user `coderunner`
- Limited process creation (10 max)

---

## üí∞ Cost Estimation

### IBM Cloud Code Engine Pricing

**Free Tier:**
- 100,000 vCPU-seconds/month
- At 0.5 vCPU √ó 3 seconds average = 66,666 executions/month FREE

**Paid Tier:**
- $0.00003417 per vCPU-second
- 3 second execution = $0.0001025
- 1,000 executions = $0.10
- 10,000 executions = $1.00
- 100,000 executions = $10.00

**Very affordable for MVP!**

---

## üìä Monitoring

### Check Job Status

```bash
# List all jobs
ibmcloud ce job list

# Get job details
ibmcloud ce job get --name code-executor

# List recent job runs
ibmcloud ce jobrun list

# View logs
ibmcloud ce jobrun logs --name <jobrun-name>
```

### Metrics to Track

1. **Success Rate:** % of successful executions
2. **Average Time:** Mean execution time
3. **Error Rate:** % of errors vs timeouts
4. **Cost:** Monthly spend on Code Engine

---

## üêõ Troubleshooting

### Issue: Docker container won't build

**Solution:**
```bash
# Clear Docker cache
docker system prune -a

# Rebuild with no cache
docker build --no-cache -t code-executor:latest .
```

### Issue: IBM Cloud push fails

**Solution:**
```bash
# Re-authenticate to Container Registry
ibmcloud cr login

# Check namespace
ibmcloud cr namespace-list

# If namespace doesn't exist
ibmcloud cr namespace-add ranga
```

### Issue: Job runs but times out

**Solution:**
```bash
# Increase timeout in job definition
ibmcloud ce job update --name code-executor --maxexecutiontime 60
```

### Issue: "Rate limit exceeded" error

**Solution:**
- Wait 1 minute
- Or increase rate limit in `route.ts`

---

## üîÑ Alternative: Cloud Functions

If Code Engine is too slow due to cold starts, switch to Cloud Functions:

```bash
# Create function
ibmcloud fn action create code-executor \
  execute.py \
  --kind python:3.11 \
  --memory 512 \
  --timeout 30000

# Invoke
ibmcloud fn action invoke code-executor \
  --param code "print('Hello!')" \
  --result
```

---

## üìà Next Steps (Week 2)

1. **Video-Lab Sync**
   - YouTube transcript API
   - AI matching algorithm
   - Timestamp-based suggestions

2. **Lab Content Generation**
   - AI-powered lab generator
   - Auto-create from video transcripts

3. **Progress Tracking**
   - Save user code
   - Track completions
   - Analytics dashboard

---

## ‚úÖ Success Criteria

Week 1 is complete when:
- [x] Docker image builds successfully
- [x] Code executes in container
- [x] API endpoint works
- [x] Security measures in place
- [x] Rate limiting works
- [x] Deployed to IBM Cloud
- [ ] Frontend "Run Code" button works
- [ ] Tests pass
- [ ] Production ready

---

## üìû Support

Questions? Issues?
- Check logs: `ibmcloud ce jobrun logs --name <name>`
- Review API errors in Next.js console
- Test Docker locally first before deploying

---

**Ready to deploy? Run `./deploy.sh`!** üöÄ
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#eff6ff',
          100: '#dbeafe',
          200: '#bfdbfe',
          300: '#93c5fd',
          400: '#60a5fa',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8',
          800: '#1e40af',
          900: '#1e3a8a',
        },
        ibm: {
          blue: '#0f62fe',
          'blue-dark': '#0043ce',
          purple: '#8a3ffc',
          cyan: '#1192e8',
        }
      },
      animation: {
        'fade-in': 'fadeIn 0.5s ease-in-out',
        'slide-up': 'slideUp 0.3s ease-out',
      },
      keyframes: {
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        slideUp: {
          '0%': { transform: 'translateY(10px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="WEEK1_CODE_EXECUTION_PLAN.md">
# Week 1: Code Execution Backend - Implementation Plan

## Goal
Build a production-ready, secure code execution backend that:
- Executes Python code safely in isolated containers
- Handles timeouts and errors gracefully
- Scales automatically
- Costs near-zero for MVP usage

---

## Architecture Decision: IBM Cloud Code Engine

**Why Code Engine over Cloud Functions:**
1. Runs containers directly (vs Lambda's runtime limits)
2. Built-in auto-scaling
3. Free tier: 100K vCPU-seconds/month
4. Pay-per-use pricing
5. Already familiar from deployment

**Stack:**
- **Container:** Docker with Python 3.11
- **Execution:** IBM Cloud Code Engine
- **API:** Next.js API routes
- **Timeout:** 30 seconds max
- **Memory:** 512MB per execution

---

## Day 1: Build Execution Container

### Step 1: Create Dockerfile for Code Execution

**File:** `code-executor/Dockerfile`

```dockerfile
FROM python:3.11-slim

# Install common packages
RUN pip install --no-cache-dir \
    boto3 \
    requests \
    numpy \
    pandas \
    matplotlib \
    pillow \
    python-dotenv

# Create execution directory
WORKDIR /code

# Copy execution script
COPY execute.py /code/

# Set up non-root user for security
RUN useradd -m -u 1000 coderunner && \
    chown -R coderunner:coderunner /code

USER coderunner

# Run execution server
CMD ["python", "execute.py"]
```

### Step 2: Create Execution Script

**File:** `code-executor/execute.py`

```python
import sys
import io
import contextlib
import json
import traceback
from typing import Dict, Any

def execute_code(code: str, timeout: int = 30) -> Dict[str, Any]:
    """
    Execute Python code and capture output/errors
    
    Args:
        code: Python code to execute
        timeout: Maximum execution time in seconds
    
    Returns:
        Dict with status, output, error
    """
    stdout_capture = io.StringIO()
    stderr_capture = io.StringIO()
    
    result = {
        "status": "success",
        "output": "",
        "error": "",
        "execution_time": 0
    }
    
    try:
        # Redirect stdout/stderr
        with contextlib.redirect_stdout(stdout_capture), \
             contextlib.redirect_stderr(stderr_capture):
            
            # Create restricted globals (security)
            restricted_globals = {
                "__builtins__": __builtins__,
                "__name__": "__main__",
                "__doc__": None,
            }
            
            # Execute code
            exec(code, restricted_globals)
        
        # Capture output
        result["output"] = stdout_capture.getvalue()
        
    except Exception as e:
        result["status"] = "error"
        result["error"] = traceback.format_exc()
        result["output"] = stdout_capture.getvalue()
    
    return result

if __name__ == "__main__":
    # Read code from stdin
    code = sys.stdin.read()
    
    # Execute
    result = execute_code(code)
    
    # Output JSON
    print(json.dumps(result))
```

---

## Day 2: Deploy to IBM Cloud Code Engine

### Build and Push Container

```bash
# Build the executor image
cd code-executor
docker build --platform linux/amd64 -t code-executor:latest .

# Tag for IBM Cloud Registry
docker tag code-executor:latest icr.io/ranga/code-executor:latest

# Push to registry
docker push icr.io/ranga/code-executor:latest

# Deploy as Code Engine Job (not app - we want on-demand execution)
ibmcloud ce job create \
  --name code-executor \
  --image icr.io/ranga/code-executor:latest \
  --cpu 0.5 \
  --memory 512M \
  --maxexecutiontime 30 \
  --retrylimit 0
```

### Test the Job

```bash
# Submit test job
ibmcloud ce jobrun submit \
  --name code-executor-test \
  --job code-executor

# Check logs
ibmcloud ce jobrun logs --name code-executor-test
```

---

## Day 3: Build API Endpoint

### Create Next.js API Route

**File:** `app/api/execute/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { exec } from 'child_process';
import { promisify } from 'util';

const execAsync = promisify(exec);

interface ExecutionRequest {
  code: string;
  language: string;
  timeout?: number;
}

interface ExecutionResult {
  status: 'success' | 'error' | 'timeout';
  output: string;
  error?: string;
  executionTime: number;
}

export async function POST(request: NextRequest) {
  try {
    const { code, language, timeout = 30 } = await request.json() as ExecutionRequest;
    
    // Validate input
    if (!code || !code.trim()) {
      return NextResponse.json(
        { error: 'Code is required' },
        { status: 400 }
      );
    }
    
    if (language !== 'python') {
      return NextResponse.json(
        { error: 'Only Python is supported currently' },
        { status: 400 }
      );
    }
    
    // Execute via IBM Cloud Code Engine Job
    const startTime = Date.now();
    
    try {
      // Submit job run with code as input
      const { stdout, stderr } = await execAsync(
        `echo '${code.replace(/'/g, "'\\''")}' | ` +
        `ibmcloud ce jobrun submit --name exec-${Date.now()} ` +
        `--job code-executor --wait --quiet`,
        { timeout: timeout * 1000 }
      );
      
      const executionTime = Date.now() - startTime;
      
      // Parse result from job output
      const result = JSON.parse(stdout);
      
      return NextResponse.json({
        status: result.status,
        output: result.output,
        error: result.error,
        executionTime
      });
      
    } catch (execError: any) {
      const executionTime = Date.now() - startTime;
      
      // Check if timeout
      if (execError.killed || execError.signal === 'SIGTERM') {
        return NextResponse.json({
          status: 'timeout',
          output: '',
          error: `Execution timeout (${timeout}s limit exceeded)`,
          executionTime
        });
      }
      
      // Other execution error
      return NextResponse.json({
        status: 'error',
        output: '',
        error: execError.message || 'Execution failed',
        executionTime
      });
    }
    
  } catch (error: any) {
    console.error('API Error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

// Health check endpoint
export async function GET() {
  return NextResponse.json({
    status: 'ok',
    service: 'code-executor',
    version: '1.0.0'
  });
}
```

---

## Day 4: Update Frontend to Use API

### Update LabRunner Component

**File:** `components/LabRunner.tsx`

Add the execution logic:

```typescript
const [output, setOutput] = useState('');
const [isRunning, setIsRunning] = useState(false);
const [executionTime, setExecutionTime] = useState(0);

const runCode = async () => {
  setIsRunning(true);
  setOutput('Running code...');
  
  try {
    const response = await fetch('/api/execute', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        code: currentCode,
        language: 'python',
        timeout: 30
      })
    });
    
    const result = await response.json();
    
    if (result.status === 'success') {
      setOutput(result.output || 'Code executed successfully (no output)');
    } else if (result.status === 'timeout') {
      setOutput(`‚è±Ô∏è Timeout: ${result.error}`);
    } else {
      setOutput(`‚ùå Error:\n${result.error}`);
    }
    
    setExecutionTime(result.executionTime);
    
  } catch (error) {
    setOutput(`‚ùå Failed to execute code: ${error.message}`);
  } finally {
    setIsRunning(false);
  }
};
```

---

## Day 5: Add Security & Rate Limiting

### Security Measures

1. **Input Validation:**
```typescript
// Prevent dangerous operations
const BLOCKED_KEYWORDS = [
  'import os',
  'import subprocess',
  'import sys',
  '__import__',
  'eval(',
  'exec(',
  'compile(',
];

function validateCode(code: string): boolean {
  const lowerCode = code.toLowerCase();
  return !BLOCKED_KEYWORDS.some(keyword => lowerCode.includes(keyword));
}
```

2. **Rate Limiting:**
```typescript
// Simple in-memory rate limiter
const rateLimiter = new Map<string, number[]>();

function checkRateLimit(userId: string): boolean {
  const now = Date.now();
  const userRequests = rateLimiter.get(userId) || [];
  
  // Remove requests older than 1 minute
  const recentRequests = userRequests.filter(time => now - time < 60000);
  
  // Allow max 10 requests per minute
  if (recentRequests.length >= 10) {
    return false;
  }
  
  recentRequests.push(now);
  rateLimiter.set(userId, recentRequests);
  return true;
}
```

3. **Resource Limits:**
- Max code length: 10,000 characters
- Max execution time: 30 seconds
- Max memory: 512MB
- Max output size: 1MB

---

## Day 6-7: Testing & Optimization

### Test Cases

1. **Basic Execution:**
```python
print("Hello, World!")
```
Expected: "Hello, World!"

2. **With Libraries:**
```python
import json
data = {"test": "value"}
print(json.dumps(data))
```
Expected: {"test": "value"}

3. **Error Handling:**
```python
raise ValueError("Test error")
```
Expected: Traceback with error

4. **Timeout:**
```python
import time
time.sleep(35)
```
Expected: Timeout error

5. **Large Output:**
```python
for i in range(1000):
    print(f"Line {i}")
```
Expected: Output with 1000 lines

### Performance Metrics

Track:
- Average execution time
- Success rate
- Error rate
- Timeout rate
- Cost per execution

---

## Alternative: Serverless Function Approach

If Code Engine Jobs are too slow (cold start), use Cloud Functions:

**File:** `cloud-function/executor.py`

```python
def main(params):
    """IBM Cloud Function to execute code"""
    import sys
    import io
    import contextlib
    import traceback
    
    code = params.get('code', '')
    
    stdout_capture = io.StringIO()
    stderr_capture = io.StringIO()
    
    try:
        with contextlib.redirect_stdout(stdout_capture), \
             contextlib.redirect_stderr(stderr_capture):
            exec(code, {"__builtins__": __builtins__})
        
        return {
            'status': 'success',
            'output': stdout_capture.getvalue()
        }
    except Exception as e:
        return {
            'status': 'error',
            'error': traceback.format_exc(),
            'output': stdout_capture.getvalue()
        }
```

Deploy:
```bash
ibmcloud fn action create code-executor \
  executor.py \
  --kind python:3.11 \
  --memory 512 \
  --timeout 30000
```

---

## Cost Estimation

**IBM Cloud Code Engine Free Tier:**
- 100,000 vCPU-seconds/month
- At 0.5 vCPU per execution √ó 5 seconds average
- = 40,000 free executions/month

**Paid Tier (if exceeded):**
- $0.00003417 per vCPU-second
- 5 second execution = $0.0001708
- 1,000 executions = $0.17
- 10,000 executions = $1.70

**Very affordable!**

---

## Success Criteria

Week 1 is complete when:
- ‚úÖ User clicks "Run Code"
- ‚úÖ Code executes in Docker sandbox
- ‚úÖ Output appears in console
- ‚úÖ Errors are caught and displayed
- ‚úÖ Timeout works (30s limit)
- ‚úÖ Rate limiting prevents abuse
- ‚úÖ Average execution < 3 seconds
- ‚úÖ 99% uptime

---

## Next Week Preview

**Week 2: Video-Lab Sync**
- YouTube transcript API integration
- AI matching of sections to labs
- Timestamp-based lab suggestions
- Dynamic lab generation

**Ready to start building?** üöÄ
</file>

</files>
